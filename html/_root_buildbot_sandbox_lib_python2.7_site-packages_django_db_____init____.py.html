source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/db/__init__.py</b><br>


file stats: <b>30 lines, 22 executed: 73.3% covered</b>
<pre>
<font color="green">   1. from django.core import signals</font>
<font color="green">   2. from django.db.utils import (</font>
<font color="black">   3.     DEFAULT_DB_ALIAS, DJANGO_VERSION_PICKLE_KEY, ConnectionHandler,</font>
<font color="black">   4.     ConnectionRouter, DatabaseError, DataError, Error, IntegrityError,</font>
<font color="black">   5.     InterfaceError, InternalError, NotSupportedError, OperationalError,</font>
<font color="black">   6.     ProgrammingError,</font>
<font color="black">   7. )</font>
<font color="black">   8. </font>
<font color="black">   9. __all__ = [</font>
<font color="green">  10.     'backend', 'connection', 'connections', 'router', 'DatabaseError',</font>
<font color="green">  11.     'IntegrityError', 'InternalError', 'ProgrammingError', 'DataError',</font>
<font color="green">  12.     'NotSupportedError', 'Error', 'InterfaceError', 'OperationalError',</font>
<font color="green">  13.     'DEFAULT_DB_ALIAS', 'DJANGO_VERSION_PICKLE_KEY'</font>
<font color="black">  14. ]</font>
<font color="black">  15. </font>
<font color="green">  16. connections = ConnectionHandler()</font>
<font color="black">  17. </font>
<font color="green">  18. router = ConnectionRouter()</font>
<font color="black">  19. </font>
<font color="black">  20. </font>
<font color="black">  21. # `connection`, `DatabaseError` and `IntegrityError` are convenient aliases</font>
<font color="black">  22. # for backend bits.</font>
<font color="black">  23. </font>
<font color="black">  24. # DatabaseWrapper.__init__() takes a dictionary, not a settings module, so we</font>
<font color="black">  25. # manually create the dictionary from the settings, passing only the settings</font>
<font color="black">  26. # that the database backends care about.</font>
<font color="black">  27. # We load all these up for backwards compatibility, you should use</font>
<font color="black">  28. # connections['default'] instead.</font>
<font color="green">  29. class DefaultConnectionProxy(object):</font>
<font color="black">  30.     &quot;&quot;&quot;</font>
<font color="black">  31.     Proxy for accessing the default DatabaseWrapper object's attributes. If you</font>
<font color="black">  32.     need to access the DatabaseWrapper object itself, use</font>
<font color="black">  33.     connections[DEFAULT_DB_ALIAS] instead.</font>
<font color="green">  34.     &quot;&quot;&quot;</font>
<font color="green">  35.     def __getattr__(self, item):</font>
<font color="green">  36.         return getattr(connections[DEFAULT_DB_ALIAS], item)</font>
<font color="black">  37. </font>
<font color="green">  38.     def __setattr__(self, name, value):</font>
<font color="red">  39.         return setattr(connections[DEFAULT_DB_ALIAS], name, value)</font>
<font color="black">  40. </font>
<font color="green">  41.     def __delattr__(self, name):</font>
<font color="red">  42.         return delattr(connections[DEFAULT_DB_ALIAS], name)</font>
<font color="black">  43. </font>
<font color="green">  44.     def __eq__(self, other):</font>
<font color="red">  45.         return connections[DEFAULT_DB_ALIAS] == other</font>
<font color="black">  46. </font>
<font color="green">  47.     def __ne__(self, other):</font>
<font color="red">  48.         return connections[DEFAULT_DB_ALIAS] != other</font>
<font color="black">  49. </font>
<font color="green">  50. connection = DefaultConnectionProxy()</font>
<font color="black">  51. </font>
<font color="black">  52. </font>
<font color="black">  53. # Register an event to reset saved queries when a Django request is started.</font>
<font color="green">  54. def reset_queries(**kwargs):</font>
<font color="red">  55.     for conn in connections.all():</font>
<font color="red">  56.         conn.queries_log.clear()</font>
<font color="green">  57. signals.request_started.connect(reset_queries)</font>
<font color="black">  58. </font>
<font color="black">  59. </font>
<font color="black">  60. # Register an event to reset transaction state and close connections past</font>
<font color="black">  61. # their lifetime.</font>
<font color="green">  62. def close_old_connections(**kwargs):</font>
<font color="red">  63.     for conn in connections.all():</font>
<font color="red">  64.         conn.close_if_unusable_or_obsolete()</font>
<font color="green">  65. signals.request_started.connect(close_old_connections)</font>
<font color="green">  66. signals.request_finished.connect(close_old_connections)</font>
</pre>

