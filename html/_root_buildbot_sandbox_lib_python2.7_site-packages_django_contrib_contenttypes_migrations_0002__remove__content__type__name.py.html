source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/contrib/contenttypes/migrations/0002_remove_content_type_name.py</b><br>


file stats: <b>26 lines, 19 executed: 73.1% covered</b>
<pre>
<font color="black">   1. # -*- coding: utf-8 -*-</font>
<font color="green">   2. from __future__ import unicode_literals</font>
<font color="black">   3. </font>
<font color="green">   4. from django.db import migrations, models</font>
<font color="black">   5. </font>
<font color="black">   6. </font>
<font color="green">   7. def add_legacy_name(apps, schema_editor):</font>
<font color="red">   8.     ContentType = apps.get_model('contenttypes', 'ContentType')</font>
<font color="red">   9.     for ct in ContentType.objects.all():</font>
<font color="red">  10.         try:</font>
<font color="red">  11.             ct.name = apps.get_model(ct.app_label, ct.model)._meta.object_name</font>
<font color="red">  12.         except LookupError:</font>
<font color="red">  13.             ct.name = ct.model</font>
<font color="red">  14.         ct.save()</font>
<font color="black">  15. </font>
<font color="black">  16. </font>
<font color="green">  17. class Migration(migrations.Migration):</font>
<font color="black">  18. </font>
<font color="black">  19.     dependencies = [</font>
<font color="green">  20.         ('contenttypes', '0001_initial'),</font>
<font color="black">  21.     ]</font>
<font color="black">  22. </font>
<font color="black">  23.     operations = [</font>
<font color="green">  24.         migrations.AlterModelOptions(</font>
<font color="green">  25.             name='contenttype',</font>
<font color="green">  26.             options={'verbose_name': 'content type', 'verbose_name_plural': 'content types'},</font>
<font color="black">  27.         ),</font>
<font color="green">  28.         migrations.AlterField(</font>
<font color="green">  29.             model_name='contenttype',</font>
<font color="green">  30.             name='name',</font>
<font color="green">  31.             field=models.CharField(max_length=100, null=True),</font>
<font color="black">  32.         ),</font>
<font color="green">  33.         migrations.RunPython(</font>
<font color="green">  34.             migrations.RunPython.noop,</font>
<font color="green">  35.             add_legacy_name,</font>
<font color="green">  36.             hints={'model_name': 'contenttype'},</font>
<font color="black">  37.         ),</font>
<font color="green">  38.         migrations.RemoveField(</font>
<font color="green">  39.             model_name='contenttype',</font>
<font color="green">  40.             name='name',</font>
<font color="black">  41.         ),</font>
<font color="black">  42.     ]</font>
</pre>

