source file: <b>/usr/lib/python2.7/xml/dom/minicompat.py</b><br>


file stats: <b>52 lines, 30 executed: 57.7% covered</b>
<pre>
<font color="green">   1. &quot;&quot;&quot;Python version compatibility support for minidom.&quot;&quot;&quot;</font>
<font color="black">   2. </font>
<font color="black">   3. # This module should only be imported using &quot;import *&quot;.</font>
<font color="black">   4. #</font>
<font color="black">   5. # The following names are defined:</font>
<font color="black">   6. #</font>
<font color="black">   7. #   NodeList      -- lightest possible NodeList implementation</font>
<font color="black">   8. #</font>
<font color="black">   9. #   EmptyNodeList -- lightest possible NodeList that is guaranteed to</font>
<font color="black">  10. #                    remain empty (immutable)</font>
<font color="black">  11. #</font>
<font color="black">  12. #   StringTypes   -- tuple of defined string types</font>
<font color="black">  13. #</font>
<font color="black">  14. #   defproperty   -- function used in conjunction with GetattrMagic;</font>
<font color="black">  15. #                    using these together is needed to make them work</font>
<font color="black">  16. #                    as efficiently as possible in both Python 2.2+</font>
<font color="black">  17. #                    and older versions.  For example:</font>
<font color="black">  18. #</font>
<font color="black">  19. #                        class MyClass(GetattrMagic):</font>
<font color="black">  20. #                            def _get_myattr(self):</font>
<font color="black">  21. #                                return something</font>
<font color="black">  22. #</font>
<font color="black">  23. #                        defproperty(MyClass, &quot;myattr&quot;,</font>
<font color="black">  24. #                                    &quot;return some value&quot;)</font>
<font color="black">  25. #</font>
<font color="black">  26. #                    For Python 2.2 and newer, this will construct a</font>
<font color="black">  27. #                    property object on the class, which avoids</font>
<font color="black">  28. #                    needing to override __getattr__().  It will only</font>
<font color="black">  29. #                    work for read-only attributes.</font>
<font color="black">  30. #</font>
<font color="black">  31. #                    For older versions of Python, inheriting from</font>
<font color="black">  32. #                    GetattrMagic will use the traditional</font>
<font color="black">  33. #                    __getattr__() hackery to achieve the same effect,</font>
<font color="black">  34. #                    but less efficiently.</font>
<font color="black">  35. #</font>
<font color="black">  36. #                    defproperty() should be used for each version of</font>
<font color="black">  37. #                    the relevant _get_&lt;property&gt;() function.</font>
<font color="black">  38. </font>
<font color="green">  39. __all__ = [&quot;NodeList&quot;, &quot;EmptyNodeList&quot;, &quot;StringTypes&quot;, &quot;defproperty&quot;]</font>
<font color="black">  40. </font>
<font color="green">  41. import xml.dom</font>
<font color="black">  42. </font>
<font color="green">  43. try:</font>
<font color="green">  44.     unicode</font>
<font color="red">  45. except NameError:</font>
<font color="red">  46.     StringTypes = type(''),</font>
<font color="black">  47. else:</font>
<font color="green">  48.     StringTypes = type(''), type(unicode(''))</font>
<font color="black">  49. </font>
<font color="black">  50. </font>
<font color="green">  51. class NodeList(list):</font>
<font color="green">  52.     __slots__ = ()</font>
<font color="black">  53. </font>
<font color="green">  54.     def item(self, index):</font>
<font color="red">  55.         if 0 &lt;= index &lt; len(self):</font>
<font color="red">  56.             return self[index]</font>
<font color="black">  57. </font>
<font color="green">  58.     def _get_length(self):</font>
<font color="red">  59.         return len(self)</font>
<font color="black">  60. </font>
<font color="green">  61.     def _set_length(self, value):</font>
<font color="red">  62.         raise xml.dom.NoModificationAllowedErr(</font>
<font color="red">  63.             &quot;attempt to modify read-only attribute 'length'&quot;)</font>
<font color="black">  64. </font>
<font color="green">  65.     length = property(_get_length, _set_length,</font>
<font color="green">  66.                       doc=&quot;The number of nodes in the NodeList.&quot;)</font>
<font color="black">  67. </font>
<font color="green">  68.     def __getstate__(self):</font>
<font color="red">  69.         return list(self)</font>
<font color="black">  70. </font>
<font color="green">  71.     def __setstate__(self, state):</font>
<font color="red">  72.         self[:] = state</font>
<font color="black">  73. </font>
<font color="black">  74. </font>
<font color="green">  75. class EmptyNodeList(tuple):</font>
<font color="green">  76.     __slots__ = ()</font>
<font color="black">  77. </font>
<font color="green">  78.     def __add__(self, other):</font>
<font color="red">  79.         NL = NodeList()</font>
<font color="red">  80.         NL.extend(other)</font>
<font color="red">  81.         return NL</font>
<font color="black">  82. </font>
<font color="green">  83.     def __radd__(self, other):</font>
<font color="red">  84.         NL = NodeList()</font>
<font color="red">  85.         NL.extend(other)</font>
<font color="red">  86.         return NL</font>
<font color="black">  87. </font>
<font color="green">  88.     def item(self, index):</font>
<font color="red">  89.         return None</font>
<font color="black">  90. </font>
<font color="green">  91.     def _get_length(self):</font>
<font color="red">  92.         return 0</font>
<font color="black">  93. </font>
<font color="green">  94.     def _set_length(self, value):</font>
<font color="red">  95.         raise xml.dom.NoModificationAllowedErr(</font>
<font color="red">  96.             &quot;attempt to modify read-only attribute 'length'&quot;)</font>
<font color="black">  97. </font>
<font color="green">  98.     length = property(_get_length, _set_length,</font>
<font color="green">  99.                       doc=&quot;The number of nodes in the NodeList.&quot;)</font>
<font color="black"> 100. </font>
<font color="black"> 101. </font>
<font color="green"> 102. def defproperty(klass, name, doc):</font>
<font color="green"> 103.     get = getattr(klass, (&quot;_get_&quot; + name)).im_func</font>
<font color="green"> 104.     def set(self, value, name=name):</font>
<font color="red"> 105.         raise xml.dom.NoModificationAllowedErr(</font>
<font color="red"> 106.             &quot;attempt to modify read-only attribute &quot; + repr(name))</font>
<font color="green"> 107.     assert not hasattr(klass, &quot;_set_&quot; + name), \</font>
<font color="red"> 108.            &quot;expected not to find _set_&quot; + name</font>
<font color="green"> 109.     prop = property(get, set, doc=doc)</font>
<font color="green"> 110.     setattr(klass, name, prop)</font>
</pre>

