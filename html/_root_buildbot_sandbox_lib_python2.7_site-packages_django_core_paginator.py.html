source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/core/paginator.py</b><br>


file stats: <b>91 lines, 34 executed: 37.4% covered</b>
<pre>
<font color="green">   1. import collections</font>
<font color="green">   2. from math import ceil</font>
<font color="black">   3. </font>
<font color="green">   4. from django.utils import six</font>
<font color="black">   5. </font>
<font color="black">   6. </font>
<font color="green">   7. class InvalidPage(Exception):</font>
<font color="green">   8.     pass</font>
<font color="black">   9. </font>
<font color="black">  10. </font>
<font color="green">  11. class PageNotAnInteger(InvalidPage):</font>
<font color="green">  12.     pass</font>
<font color="black">  13. </font>
<font color="black">  14. </font>
<font color="green">  15. class EmptyPage(InvalidPage):</font>
<font color="green">  16.     pass</font>
<font color="black">  17. </font>
<font color="black">  18. </font>
<font color="green">  19. class Paginator(object):</font>
<font color="black">  20. </font>
<font color="green">  21.     def __init__(self, object_list, per_page, orphans=0,</font>
<font color="green">  22.                  allow_empty_first_page=True):</font>
<font color="red">  23.         self.object_list = object_list</font>
<font color="red">  24.         self.per_page = int(per_page)</font>
<font color="red">  25.         self.orphans = int(orphans)</font>
<font color="red">  26.         self.allow_empty_first_page = allow_empty_first_page</font>
<font color="red">  27.         self._num_pages = self._count = None</font>
<font color="black">  28. </font>
<font color="green">  29.     def validate_number(self, number):</font>
<font color="black">  30.         &quot;&quot;&quot;</font>
<font color="black">  31.         Validates the given 1-based page number.</font>
<font color="black">  32.         &quot;&quot;&quot;</font>
<font color="red">  33.         try:</font>
<font color="red">  34.             number = int(number)</font>
<font color="red">  35.         except (TypeError, ValueError):</font>
<font color="red">  36.             raise PageNotAnInteger('That page number is not an integer')</font>
<font color="red">  37.         if number &lt; 1:</font>
<font color="red">  38.             raise EmptyPage('That page number is less than 1')</font>
<font color="red">  39.         if number &gt; self.num_pages:</font>
<font color="red">  40.             if number == 1 and self.allow_empty_first_page:</font>
<font color="red">  41.                 pass</font>
<font color="black">  42.             else:</font>
<font color="red">  43.                 raise EmptyPage('That page contains no results')</font>
<font color="red">  44.         return number</font>
<font color="black">  45. </font>
<font color="green">  46.     def page(self, number):</font>
<font color="black">  47.         &quot;&quot;&quot;</font>
<font color="black">  48.         Returns a Page object for the given 1-based page number.</font>
<font color="black">  49.         &quot;&quot;&quot;</font>
<font color="red">  50.         number = self.validate_number(number)</font>
<font color="red">  51.         bottom = (number - 1) * self.per_page</font>
<font color="red">  52.         top = bottom + self.per_page</font>
<font color="red">  53.         if top + self.orphans &gt;= self.count:</font>
<font color="red">  54.             top = self.count</font>
<font color="red">  55.         return self._get_page(self.object_list[bottom:top], number, self)</font>
<font color="black">  56. </font>
<font color="green">  57.     def _get_page(self, *args, **kwargs):</font>
<font color="black">  58.         &quot;&quot;&quot;</font>
<font color="black">  59.         Returns an instance of a single page.</font>
<font color="black">  60. </font>
<font color="black">  61.         This hook can be used by subclasses to use an alternative to the</font>
<font color="black">  62.         standard :cls:`Page` object.</font>
<font color="black">  63.         &quot;&quot;&quot;</font>
<font color="red">  64.         return Page(*args, **kwargs)</font>
<font color="black">  65. </font>
<font color="green">  66.     def _get_count(self):</font>
<font color="black">  67.         &quot;&quot;&quot;</font>
<font color="black">  68.         Returns the total number of objects, across all pages.</font>
<font color="black">  69.         &quot;&quot;&quot;</font>
<font color="red">  70.         if self._count is None:</font>
<font color="red">  71.             try:</font>
<font color="red">  72.                 self._count = self.object_list.count()</font>
<font color="red">  73.             except (AttributeError, TypeError):</font>
<font color="black">  74.                 # AttributeError if object_list has no count() method.</font>
<font color="black">  75.                 # TypeError if object_list.count() requires arguments</font>
<font color="black">  76.                 # (i.e. is of type list).</font>
<font color="red">  77.                 self._count = len(self.object_list)</font>
<font color="red">  78.         return self._count</font>
<font color="green">  79.     count = property(_get_count)</font>
<font color="black">  80. </font>
<font color="green">  81.     def _get_num_pages(self):</font>
<font color="black">  82.         &quot;&quot;&quot;</font>
<font color="black">  83.         Returns the total number of pages.</font>
<font color="black">  84.         &quot;&quot;&quot;</font>
<font color="red">  85.         if self._num_pages is None:</font>
<font color="red">  86.             if self.count == 0 and not self.allow_empty_first_page:</font>
<font color="red">  87.                 self._num_pages = 0</font>
<font color="black">  88.             else:</font>
<font color="red">  89.                 hits = max(1, self.count - self.orphans)</font>
<font color="red">  90.                 self._num_pages = int(ceil(hits / float(self.per_page)))</font>
<font color="red">  91.         return self._num_pages</font>
<font color="green">  92.     num_pages = property(_get_num_pages)</font>
<font color="black">  93. </font>
<font color="green">  94.     def _get_page_range(self):</font>
<font color="black">  95.         &quot;&quot;&quot;</font>
<font color="black">  96.         Returns a 1-based range of pages for iterating through within</font>
<font color="black">  97.         a template for loop.</font>
<font color="black">  98.         &quot;&quot;&quot;</font>
<font color="red">  99.         return six.moves.range(1, self.num_pages + 1)</font>
<font color="green"> 100.     page_range = property(_get_page_range)</font>
<font color="black"> 101. </font>
<font color="black"> 102. </font>
<font color="green"> 103. QuerySetPaginator = Paginator   # For backwards-compatibility.</font>
<font color="black"> 104. </font>
<font color="black"> 105. </font>
<font color="green"> 106. class Page(collections.Sequence):</font>
<font color="black"> 107. </font>
<font color="green"> 108.     def __init__(self, object_list, number, paginator):</font>
<font color="red"> 109.         self.object_list = object_list</font>
<font color="red"> 110.         self.number = number</font>
<font color="red"> 111.         self.paginator = paginator</font>
<font color="black"> 112. </font>
<font color="green"> 113.     def __repr__(self):</font>
<font color="red"> 114.         return '&lt;Page %s of %s&gt;' % (self.number, self.paginator.num_pages)</font>
<font color="black"> 115. </font>
<font color="green"> 116.     def __len__(self):</font>
<font color="red"> 117.         return len(self.object_list)</font>
<font color="black"> 118. </font>
<font color="green"> 119.     def __getitem__(self, index):</font>
<font color="red"> 120.         if not isinstance(index, (slice,) + six.integer_types):</font>
<font color="red"> 121.             raise TypeError</font>
<font color="black"> 122.         # The object_list is converted to a list so that if it was a QuerySet</font>
<font color="black"> 123.         # it won't be a database hit per __getitem__.</font>
<font color="red"> 124.         if not isinstance(self.object_list, list):</font>
<font color="red"> 125.             self.object_list = list(self.object_list)</font>
<font color="red"> 126.         return self.object_list[index]</font>
<font color="black"> 127. </font>
<font color="green"> 128.     def has_next(self):</font>
<font color="red"> 129.         return self.number &lt; self.paginator.num_pages</font>
<font color="black"> 130. </font>
<font color="green"> 131.     def has_previous(self):</font>
<font color="red"> 132.         return self.number &gt; 1</font>
<font color="black"> 133. </font>
<font color="green"> 134.     def has_other_pages(self):</font>
<font color="red"> 135.         return self.has_previous() or self.has_next()</font>
<font color="black"> 136. </font>
<font color="green"> 137.     def next_page_number(self):</font>
<font color="red"> 138.         return self.paginator.validate_number(self.number + 1)</font>
<font color="black"> 139. </font>
<font color="green"> 140.     def previous_page_number(self):</font>
<font color="red"> 141.         return self.paginator.validate_number(self.number - 1)</font>
<font color="black"> 142. </font>
<font color="green"> 143.     def start_index(self):</font>
<font color="black"> 144.         &quot;&quot;&quot;</font>
<font color="black"> 145.         Returns the 1-based index of the first object on this page,</font>
<font color="black"> 146.         relative to total objects in the paginator.</font>
<font color="black"> 147.         &quot;&quot;&quot;</font>
<font color="black"> 148.         # Special case, return zero if no items.</font>
<font color="red"> 149.         if self.paginator.count == 0:</font>
<font color="red"> 150.             return 0</font>
<font color="red"> 151.         return (self.paginator.per_page * (self.number - 1)) + 1</font>
<font color="black"> 152. </font>
<font color="green"> 153.     def end_index(self):</font>
<font color="black"> 154.         &quot;&quot;&quot;</font>
<font color="black"> 155.         Returns the 1-based index of the last object on this page,</font>
<font color="black"> 156.         relative to total objects found (hits).</font>
<font color="black"> 157.         &quot;&quot;&quot;</font>
<font color="black"> 158.         # Special case for the last page because there can be orphans.</font>
<font color="red"> 159.         if self.number == self.paginator.num_pages:</font>
<font color="red"> 160.             return self.paginator.count</font>
<font color="red"> 161.         return self.number * self.paginator.per_page</font>
</pre>

