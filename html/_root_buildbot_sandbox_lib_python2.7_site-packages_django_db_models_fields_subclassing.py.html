source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/db/models/fields/subclassing.py</b><br>


file stats: <b>29 lines, 12 executed: 41.4% covered</b>
<pre>
<font color="black">   1. &quot;&quot;&quot;</font>
<font color="black">   2. Convenience routines for creating non-trivial Field subclasses, as well as</font>
<font color="black">   3. backwards compatibility utilities.</font>
<font color="black">   4. </font>
<font color="black">   5. Add SubfieldBase as the metaclass for your Field subclass, implement</font>
<font color="black">   6. to_python() and the other necessary methods and everything will work</font>
<font color="black">   7. seamlessly.</font>
<font color="green">   8. &quot;&quot;&quot;</font>
<font color="black">   9. </font>
<font color="green">  10. import warnings</font>
<font color="black">  11. </font>
<font color="green">  12. from django.utils.deprecation import RemovedInDjango110Warning</font>
<font color="black">  13. </font>
<font color="black">  14. </font>
<font color="green">  15. class SubfieldBase(type):</font>
<font color="black">  16.     &quot;&quot;&quot;</font>
<font color="black">  17.     A metaclass for custom Field subclasses. This ensures the model's attribute</font>
<font color="black">  18.     has the descriptor protocol attached to it.</font>
<font color="green">  19.     &quot;&quot;&quot;</font>
<font color="green">  20.     def __new__(cls, name, bases, attrs):</font>
<font color="red">  21.         warnings.warn(&quot;SubfieldBase has been deprecated. Use Field.from_db_value instead.&quot;,</font>
<font color="red">  22.                   RemovedInDjango110Warning)</font>
<font color="black">  23. </font>
<font color="red">  24.         new_class = super(SubfieldBase, cls).__new__(cls, name, bases, attrs)</font>
<font color="red">  25.         new_class.contribute_to_class = make_contrib(</font>
<font color="red">  26.             new_class, attrs.get('contribute_to_class')</font>
<font color="black">  27.         )</font>
<font color="red">  28.         return new_class</font>
<font color="black">  29. </font>
<font color="black">  30. </font>
<font color="green">  31. class Creator(object):</font>
<font color="black">  32.     &quot;&quot;&quot;</font>
<font color="black">  33.     A placeholder class that provides a way to set the attribute on the model.</font>
<font color="green">  34.     &quot;&quot;&quot;</font>
<font color="green">  35.     def __init__(self, field):</font>
<font color="red">  36.         self.field = field</font>
<font color="black">  37. </font>
<font color="green">  38.     def __get__(self, obj, type=None):</font>
<font color="red">  39.         if obj is None:</font>
<font color="red">  40.             return self</font>
<font color="red">  41.         return obj.__dict__[self.field.name]</font>
<font color="black">  42. </font>
<font color="green">  43.     def __set__(self, obj, value):</font>
<font color="red">  44.         obj.__dict__[self.field.name] = self.field.to_python(value)</font>
<font color="black">  45. </font>
<font color="black">  46. </font>
<font color="green">  47. def make_contrib(superclass, func=None):</font>
<font color="black">  48.     &quot;&quot;&quot;</font>
<font color="black">  49.     Returns a suitable contribute_to_class() method for the Field subclass.</font>
<font color="black">  50. </font>
<font color="black">  51.     If 'func' is passed in, it is the existing contribute_to_class() method on</font>
<font color="black">  52.     the subclass and it is called before anything else. It is assumed in this</font>
<font color="black">  53.     case that the existing contribute_to_class() calls all the necessary</font>
<font color="black">  54.     superclass methods.</font>
<font color="black">  55.     &quot;&quot;&quot;</font>
<font color="red">  56.     def contribute_to_class(self, cls, name, **kwargs):</font>
<font color="red">  57.         if func:</font>
<font color="red">  58.             func(self, cls, name, **kwargs)</font>
<font color="black">  59.         else:</font>
<font color="red">  60.             super(superclass, self).contribute_to_class(cls, name, **kwargs)</font>
<font color="red">  61.         setattr(cls, self.name, Creator(self))</font>
<font color="black">  62. </font>
<font color="red">  63.     return contribute_to_class</font>
</pre>

