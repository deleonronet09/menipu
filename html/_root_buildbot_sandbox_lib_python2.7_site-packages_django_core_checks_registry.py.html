source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/core/checks/registry.py</b><br>


file stats: <b>58 lines, 40 executed: 69.0% covered</b>
<pre>
<font color="black">   1. # -*- coding: utf-8 -*-</font>
<font color="green">   2. from __future__ import unicode_literals</font>
<font color="black">   3. </font>
<font color="green">   4. from itertools import chain</font>
<font color="black">   5. </font>
<font color="green">   6. from django.utils.itercompat import is_iterable</font>
<font color="black">   7. </font>
<font color="black">   8. </font>
<font color="green">   9. class Tags(object):</font>
<font color="black">  10.     &quot;&quot;&quot;</font>
<font color="black">  11.     Built-in tags for internal checks.</font>
<font color="green">  12.     &quot;&quot;&quot;</font>
<font color="green">  13.     admin = 'admin'</font>
<font color="green">  14.     caches = 'caches'</font>
<font color="green">  15.     compatibility = 'compatibility'</font>
<font color="green">  16.     models = 'models'</font>
<font color="green">  17.     security = 'security'</font>
<font color="green">  18.     signals = 'signals'</font>
<font color="green">  19.     templates = 'templates'</font>
<font color="green">  20.     urls = 'urls'</font>
<font color="black">  21. </font>
<font color="black">  22. </font>
<font color="green">  23. class CheckRegistry(object):</font>
<font color="black">  24. </font>
<font color="green">  25.     def __init__(self):</font>
<font color="green">  26.         self.registered_checks = []</font>
<font color="green">  27.         self.deployment_checks = []</font>
<font color="black">  28. </font>
<font color="green">  29.     def register(self, check=None, *tags, **kwargs):</font>
<font color="black">  30.         &quot;&quot;&quot;</font>
<font color="black">  31.         Can be used as a function or a decorator. Register given function</font>
<font color="black">  32.         `f` labeled with given `tags`. The function should receive **kwargs</font>
<font color="black">  33.         and return list of Errors and Warnings.</font>
<font color="black">  34. </font>
<font color="black">  35.         Example::</font>
<font color="black">  36. </font>
<font color="black">  37.             registry = CheckRegistry()</font>
<font color="black">  38.             @registry.register('mytag', 'anothertag')</font>
<font color="black">  39.             def my_check(apps, **kwargs):</font>
<font color="black">  40.                 # ... perform checks and collect `errors` ...</font>
<font color="black">  41.                 return errors</font>
<font color="black">  42.             # or</font>
<font color="black">  43.             registry.register(my_check, 'mytag', 'anothertag')</font>
<font color="black">  44.         &quot;&quot;&quot;</font>
<font color="green">  45.         kwargs.setdefault('deploy', False)</font>
<font color="black">  46. </font>
<font color="green">  47.         def inner(check):</font>
<font color="green">  48.             check.tags = tags</font>
<font color="green">  49.             if kwargs['deploy']:</font>
<font color="green">  50.                 if check not in self.deployment_checks:</font>
<font color="green">  51.                     self.deployment_checks.append(check)</font>
<font color="green">  52.             elif check not in self.registered_checks:</font>
<font color="green">  53.                 self.registered_checks.append(check)</font>
<font color="green">  54.             return check</font>
<font color="black">  55. </font>
<font color="green">  56.         if callable(check):</font>
<font color="green">  57.             return inner(check)</font>
<font color="black">  58.         else:</font>
<font color="green">  59.             if check:</font>
<font color="green">  60.                 tags += (check, )</font>
<font color="green">  61.             return inner</font>
<font color="black">  62. </font>
<font color="green">  63.     def run_checks(self, app_configs=None, tags=None, include_deployment_checks=False):</font>
<font color="black">  64.         &quot;&quot;&quot;</font>
<font color="black">  65.         Run all registered checks and return list of Errors and Warnings.</font>
<font color="black">  66.         &quot;&quot;&quot;</font>
<font color="red">  67.         errors = []</font>
<font color="red">  68.         checks = self.get_checks(include_deployment_checks)</font>
<font color="black">  69. </font>
<font color="red">  70.         if tags is not None:</font>
<font color="red">  71.             checks = [check for check in checks</font>
<font color="red">  72.                       if hasattr(check, 'tags') and set(check.tags) &amp; set(tags)]</font>
<font color="black">  73. </font>
<font color="red">  74.         for check in checks:</font>
<font color="red">  75.             new_errors = check(app_configs=app_configs)</font>
<font color="red">  76.             assert is_iterable(new_errors), (</font>
<font color="red">  77.                 &quot;The function %r did not return a list. All functions registered &quot;</font>
<font color="red">  78.                 &quot;with the checks registry must return a list.&quot; % check)</font>
<font color="red">  79.             errors.extend(new_errors)</font>
<font color="red">  80.         return errors</font>
<font color="black">  81. </font>
<font color="green">  82.     def tag_exists(self, tag, include_deployment_checks=False):</font>
<font color="red">  83.         return tag in self.tags_available(include_deployment_checks)</font>
<font color="black">  84. </font>
<font color="green">  85.     def tags_available(self, deployment_checks=False):</font>
<font color="red">  86.         return set(chain(*[check.tags for check in self.get_checks(deployment_checks) if hasattr(check, 'tags')]))</font>
<font color="black">  87. </font>
<font color="green">  88.     def get_checks(self, include_deployment_checks=False):</font>
<font color="red">  89.         checks = list(self.registered_checks)</font>
<font color="red">  90.         if include_deployment_checks:</font>
<font color="red">  91.             checks.extend(self.deployment_checks)</font>
<font color="red">  92.         return checks</font>
<font color="black">  93. </font>
<font color="black">  94. </font>
<font color="green">  95. registry = CheckRegistry()</font>
<font color="green">  96. register = registry.register</font>
<font color="green">  97. run_checks = registry.run_checks</font>
<font color="green">  98. tag_exists = registry.tag_exists</font>
</pre>

