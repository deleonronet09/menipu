source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/core/mail/__init__.py</b><br>


file stats: <b>52 lines, 20 executed: 38.5% covered</b>
<pre>
<font color="black">   1. &quot;&quot;&quot;</font>
<font color="black">   2. Tools for sending email.</font>
<font color="green">   3. &quot;&quot;&quot;</font>
<font color="green">   4. from __future__ import unicode_literals</font>
<font color="black">   5. </font>
<font color="green">   6. from django.conf import settings</font>
<font color="black">   7. # Imported for backwards compatibility and for the sake</font>
<font color="black">   8. # of a cleaner namespace. These symbols used to be in</font>
<font color="black">   9. # django/core/mail.py before the introduction of email</font>
<font color="black">  10. # backends and the subsequent reorganization (See #10355)</font>
<font color="green">  11. from django.core.mail.message import (</font>
<font color="black">  12.     DEFAULT_ATTACHMENT_MIME_TYPE, BadHeaderError, EmailMessage,</font>
<font color="black">  13.     EmailMultiAlternatives, SafeMIMEMultipart, SafeMIMEText,</font>
<font color="black">  14.     forbid_multi_line_headers, make_msgid,</font>
<font color="black">  15. )</font>
<font color="green">  16. from django.core.mail.utils import DNS_NAME, CachedDnsName</font>
<font color="green">  17. from django.utils.module_loading import import_string</font>
<font color="black">  18. </font>
<font color="black">  19. __all__ = [</font>
<font color="green">  20.     'CachedDnsName', 'DNS_NAME', 'EmailMessage', 'EmailMultiAlternatives',</font>
<font color="green">  21.     'SafeMIMEText', 'SafeMIMEMultipart', 'DEFAULT_ATTACHMENT_MIME_TYPE',</font>
<font color="green">  22.     'make_msgid', 'BadHeaderError', 'forbid_multi_line_headers',</font>
<font color="green">  23.     'get_connection', 'send_mail', 'send_mass_mail', 'mail_admins',</font>
<font color="green">  24.     'mail_managers',</font>
<font color="black">  25. ]</font>
<font color="black">  26. </font>
<font color="black">  27. </font>
<font color="green">  28. def get_connection(backend=None, fail_silently=False, **kwds):</font>
<font color="black">  29.     &quot;&quot;&quot;Load an email backend and return an instance of it.</font>
<font color="black">  30. </font>
<font color="black">  31.     If backend is None (default) settings.EMAIL_BACKEND is used.</font>
<font color="black">  32. </font>
<font color="black">  33.     Both fail_silently and other keyword arguments are used in the</font>
<font color="black">  34.     constructor of the backend.</font>
<font color="black">  35.     &quot;&quot;&quot;</font>
<font color="red">  36.     klass = import_string(backend or settings.EMAIL_BACKEND)</font>
<font color="red">  37.     return klass(fail_silently=fail_silently, **kwds)</font>
<font color="black">  38. </font>
<font color="black">  39. </font>
<font color="black">  40. def send_mail(subject, message, from_email, recipient_list,</font>
<font color="green">  41.               fail_silently=False, auth_user=None, auth_password=None,</font>
<font color="green">  42.               connection=None, html_message=None):</font>
<font color="black">  43.     &quot;&quot;&quot;</font>
<font color="black">  44.     Easy wrapper for sending a single message to a recipient list. All members</font>
<font color="black">  45.     of the recipient list will see the other recipients in the 'To' field.</font>
<font color="black">  46. </font>
<font color="black">  47.     If auth_user is None, the EMAIL_HOST_USER setting is used.</font>
<font color="black">  48.     If auth_password is None, the EMAIL_HOST_PASSWORD setting is used.</font>
<font color="black">  49. </font>
<font color="black">  50.     Note: The API for this method is frozen. New code wanting to extend the</font>
<font color="black">  51.     functionality should use the EmailMessage class directly.</font>
<font color="black">  52.     &quot;&quot;&quot;</font>
<font color="red">  53.     connection = connection or get_connection(username=auth_user,</font>
<font color="red">  54.                                     password=auth_password,</font>
<font color="red">  55.                                     fail_silently=fail_silently)</font>
<font color="red">  56.     mail = EmailMultiAlternatives(subject, message, from_email, recipient_list,</font>
<font color="red">  57.                                   connection=connection)</font>
<font color="red">  58.     if html_message:</font>
<font color="red">  59.         mail.attach_alternative(html_message, 'text/html')</font>
<font color="black">  60. </font>
<font color="red">  61.     return mail.send()</font>
<font color="black">  62. </font>
<font color="black">  63. </font>
<font color="green">  64. def send_mass_mail(datatuple, fail_silently=False, auth_user=None,</font>
<font color="green">  65.                    auth_password=None, connection=None):</font>
<font color="black">  66.     &quot;&quot;&quot;</font>
<font color="black">  67.     Given a datatuple of (subject, message, from_email, recipient_list), sends</font>
<font color="black">  68.     each message to each recipient list. Returns the number of emails sent.</font>
<font color="black">  69. </font>
<font color="black">  70.     If from_email is None, the DEFAULT_FROM_EMAIL setting is used.</font>
<font color="black">  71.     If auth_user and auth_password are set, they're used to log in.</font>
<font color="black">  72.     If auth_user is None, the EMAIL_HOST_USER setting is used.</font>
<font color="black">  73.     If auth_password is None, the EMAIL_HOST_PASSWORD setting is used.</font>
<font color="black">  74. </font>
<font color="black">  75.     Note: The API for this method is frozen. New code wanting to extend the</font>
<font color="black">  76.     functionality should use the EmailMessage class directly.</font>
<font color="black">  77.     &quot;&quot;&quot;</font>
<font color="red">  78.     connection = connection or get_connection(username=auth_user,</font>
<font color="red">  79.                                     password=auth_password,</font>
<font color="red">  80.                                     fail_silently=fail_silently)</font>
<font color="red">  81.     messages = [EmailMessage(subject, message, sender, recipient,</font>
<font color="black">  82.                              connection=connection)</font>
<font color="red">  83.                 for subject, message, sender, recipient in datatuple]</font>
<font color="red">  84.     return connection.send_messages(messages)</font>
<font color="black">  85. </font>
<font color="black">  86. </font>
<font color="green">  87. def mail_admins(subject, message, fail_silently=False, connection=None,</font>
<font color="green">  88.                 html_message=None):</font>
<font color="black">  89.     &quot;&quot;&quot;Sends a message to the admins, as defined by the ADMINS setting.&quot;&quot;&quot;</font>
<font color="red">  90.     if not settings.ADMINS:</font>
<font color="red">  91.         return</font>
<font color="red">  92.     mail = EmailMultiAlternatives('%s%s' % (settings.EMAIL_SUBJECT_PREFIX, subject),</font>
<font color="red">  93.                 message, settings.SERVER_EMAIL, [a[1] for a in settings.ADMINS],</font>
<font color="red">  94.                 connection=connection)</font>
<font color="red">  95.     if html_message:</font>
<font color="red">  96.         mail.attach_alternative(html_message, 'text/html')</font>
<font color="red">  97.     mail.send(fail_silently=fail_silently)</font>
<font color="black">  98. </font>
<font color="black">  99. </font>
<font color="green"> 100. def mail_managers(subject, message, fail_silently=False, connection=None,</font>
<font color="green"> 101.                   html_message=None):</font>
<font color="black"> 102.     &quot;&quot;&quot;Sends a message to the managers, as defined by the MANAGERS setting.&quot;&quot;&quot;</font>
<font color="red"> 103.     if not settings.MANAGERS:</font>
<font color="red"> 104.         return</font>
<font color="red"> 105.     mail = EmailMultiAlternatives('%s%s' % (settings.EMAIL_SUBJECT_PREFIX, subject),</font>
<font color="red"> 106.                 message, settings.SERVER_EMAIL, [a[1] for a in settings.MANAGERS],</font>
<font color="red"> 107.                 connection=connection)</font>
<font color="red"> 108.     if html_message:</font>
<font color="red"> 109.         mail.attach_alternative(html_message, 'text/html')</font>
<font color="red"> 110.     mail.send(fail_silently=fail_silently)</font>
</pre>

