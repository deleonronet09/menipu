source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/contrib/sessions/base_session.py</b><br>


file stats: <b>32 lines, 21 executed: 65.6% covered</b>
<pre>
<font color="black">   1. &quot;&quot;&quot;</font>
<font color="black">   2. This module allows importing AbstractBaseSession even</font>
<font color="black">   3. when django.contrib.sessions is not in INSTALLED_APPS.</font>
<font color="green">   4. &quot;&quot;&quot;</font>
<font color="green">   5. from __future__ import unicode_literals</font>
<font color="black">   6. </font>
<font color="green">   7. from django.db import models</font>
<font color="green">   8. from django.utils.encoding import python_2_unicode_compatible</font>
<font color="green">   9. from django.utils.translation import ugettext_lazy as _</font>
<font color="black">  10. </font>
<font color="black">  11. </font>
<font color="green">  12. class BaseSessionManager(models.Manager):</font>
<font color="green">  13.     def encode(self, session_dict):</font>
<font color="black">  14.         &quot;&quot;&quot;</font>
<font color="black">  15.         Return the given session dictionary serialized and encoded as a string.</font>
<font color="black">  16.         &quot;&quot;&quot;</font>
<font color="red">  17.         session_store_class = self.model.get_session_store_class()</font>
<font color="red">  18.         return session_store_class().encode(session_dict)</font>
<font color="black">  19. </font>
<font color="green">  20.     def save(self, session_key, session_dict, expire_date):</font>
<font color="red">  21.         s = self.model(session_key, self.encode(session_dict), expire_date)</font>
<font color="red">  22.         if session_dict:</font>
<font color="red">  23.             s.save()</font>
<font color="black">  24.         else:</font>
<font color="red">  25.             s.delete()  # Clear sessions with no data.</font>
<font color="red">  26.         return s</font>
<font color="black">  27. </font>
<font color="black">  28. </font>
<font color="green">  29. @python_2_unicode_compatible</font>
<font color="green">  30. class AbstractBaseSession(models.Model):</font>
<font color="green">  31.     session_key = models.CharField(_('session key'), max_length=40, primary_key=True)</font>
<font color="green">  32.     session_data = models.TextField(_('session data'))</font>
<font color="green">  33.     expire_date = models.DateTimeField(_('expire date'), db_index=True)</font>
<font color="black">  34. </font>
<font color="green">  35.     objects = BaseSessionManager()</font>
<font color="black">  36. </font>
<font color="green">  37.     class Meta:</font>
<font color="green">  38.         abstract = True</font>
<font color="green">  39.         verbose_name = _('session')</font>
<font color="green">  40.         verbose_name_plural = _('sessions')</font>
<font color="black">  41. </font>
<font color="green">  42.     def __str__(self):</font>
<font color="red">  43.         return self.session_key</font>
<font color="black">  44. </font>
<font color="green">  45.     @classmethod</font>
<font color="black">  46.     def get_session_store_class(cls):</font>
<font color="red">  47.         raise NotImplementedError</font>
<font color="black">  48. </font>
<font color="green">  49.     def get_decoded(self):</font>
<font color="red">  50.         session_store_class = self.get_session_store_class()</font>
<font color="red">  51.         return session_store_class().decode(self.session_data)</font>
</pre>

