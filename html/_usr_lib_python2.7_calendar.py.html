source file: <b>/usr/lib/python2.7/calendar.py</b><br>


file stats: <b>423 lines, 115 executed: 27.2% covered</b>
<pre>
<font color="black">   1. &quot;&quot;&quot;Calendar printing functions</font>
<font color="black">   2. </font>
<font color="black">   3. Note when comparing these calendars to the ones printed by cal(1): By</font>
<font color="black">   4. default, these calendars have Monday as the first day of the week, and</font>
<font color="black">   5. Sunday as the last (the European convention). Use setfirstweekday() to</font>
<font color="green">   6. set the first day of the week (0=Monday, 6=Sunday).&quot;&quot;&quot;</font>
<font color="black">   7. </font>
<font color="green">   8. import sys</font>
<font color="green">   9. import datetime</font>
<font color="green">  10. import locale as _locale</font>
<font color="black">  11. </font>
<font color="green">  12. __all__ = [&quot;IllegalMonthError&quot;, &quot;IllegalWeekdayError&quot;, &quot;setfirstweekday&quot;,</font>
<font color="green">  13.            &quot;firstweekday&quot;, &quot;isleap&quot;, &quot;leapdays&quot;, &quot;weekday&quot;, &quot;monthrange&quot;,</font>
<font color="green">  14.            &quot;monthcalendar&quot;, &quot;prmonth&quot;, &quot;month&quot;, &quot;prcal&quot;, &quot;calendar&quot;,</font>
<font color="green">  15.            &quot;timegm&quot;, &quot;month_name&quot;, &quot;month_abbr&quot;, &quot;day_name&quot;, &quot;day_abbr&quot;]</font>
<font color="black">  16. </font>
<font color="black">  17. # Exception raised for bad input (with string parameter for details)</font>
<font color="green">  18. error = ValueError</font>
<font color="black">  19. </font>
<font color="black">  20. # Exceptions raised for bad input</font>
<font color="green">  21. class IllegalMonthError(ValueError):</font>
<font color="green">  22.     def __init__(self, month):</font>
<font color="red">  23.         self.month = month</font>
<font color="green">  24.     def __str__(self):</font>
<font color="red">  25.         return &quot;bad month number %r; must be 1-12&quot; % self.month</font>
<font color="black">  26. </font>
<font color="black">  27. </font>
<font color="green">  28. class IllegalWeekdayError(ValueError):</font>
<font color="green">  29.     def __init__(self, weekday):</font>
<font color="red">  30.         self.weekday = weekday</font>
<font color="green">  31.     def __str__(self):</font>
<font color="red">  32.         return &quot;bad weekday number %r; must be 0 (Monday) to 6 (Sunday)&quot; % self.weekday</font>
<font color="black">  33. </font>
<font color="black">  34. </font>
<font color="black">  35. # Constants for months referenced later</font>
<font color="green">  36. January = 1</font>
<font color="green">  37. February = 2</font>
<font color="black">  38. </font>
<font color="black">  39. # Number of days per month (except for February in leap years)</font>
<font color="green">  40. mdays = [0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]</font>
<font color="black">  41. </font>
<font color="black">  42. # This module used to have hard-coded lists of day and month names, as</font>
<font color="black">  43. # English strings.  The classes following emulate a read-only version of</font>
<font color="black">  44. # that, but supply localized names.  Note that the values are computed</font>
<font color="black">  45. # fresh on each call, in case the user changes locale between calls.</font>
<font color="black">  46. </font>
<font color="green">  47. class _localized_month:</font>
<font color="black">  48. </font>
<font color="green">  49.     _months = [datetime.date(2001, i+1, 1).strftime for i in range(12)]</font>
<font color="green">  50.     _months.insert(0, lambda x: &quot;&quot;)</font>
<font color="black">  51. </font>
<font color="green">  52.     def __init__(self, format):</font>
<font color="green">  53.         self.format = format</font>
<font color="black">  54. </font>
<font color="green">  55.     def __getitem__(self, i):</font>
<font color="red">  56.         funcs = self._months[i]</font>
<font color="red">  57.         if isinstance(i, slice):</font>
<font color="red">  58.             return [f(self.format) for f in funcs]</font>
<font color="black">  59.         else:</font>
<font color="red">  60.             return funcs(self.format)</font>
<font color="black">  61. </font>
<font color="green">  62.     def __len__(self):</font>
<font color="red">  63.         return 13</font>
<font color="black">  64. </font>
<font color="black">  65. </font>
<font color="green">  66. class _localized_day:</font>
<font color="black">  67. </font>
<font color="black">  68.     # January 1, 2001, was a Monday.</font>
<font color="green">  69.     _days = [datetime.date(2001, 1, i+1).strftime for i in range(7)]</font>
<font color="black">  70. </font>
<font color="green">  71.     def __init__(self, format):</font>
<font color="green">  72.         self.format = format</font>
<font color="black">  73. </font>
<font color="green">  74.     def __getitem__(self, i):</font>
<font color="red">  75.         funcs = self._days[i]</font>
<font color="red">  76.         if isinstance(i, slice):</font>
<font color="red">  77.             return [f(self.format) for f in funcs]</font>
<font color="black">  78.         else:</font>
<font color="red">  79.             return funcs(self.format)</font>
<font color="black">  80. </font>
<font color="green">  81.     def __len__(self):</font>
<font color="red">  82.         return 7</font>
<font color="black">  83. </font>
<font color="black">  84. </font>
<font color="black">  85. # Full and abbreviated names of weekdays</font>
<font color="green">  86. day_name = _localized_day('%A')</font>
<font color="green">  87. day_abbr = _localized_day('%a')</font>
<font color="black">  88. </font>
<font color="black">  89. # Full and abbreviated names of months (1-based arrays!!!)</font>
<font color="green">  90. month_name = _localized_month('%B')</font>
<font color="green">  91. month_abbr = _localized_month('%b')</font>
<font color="black">  92. </font>
<font color="black">  93. # Constants for weekdays</font>
<font color="green">  94. (MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY) = range(7)</font>
<font color="black">  95. </font>
<font color="black">  96. </font>
<font color="green">  97. def isleap(year):</font>
<font color="black">  98.     &quot;&quot;&quot;Return True for leap years, False for non-leap years.&quot;&quot;&quot;</font>
<font color="red">  99.     return year % 4 == 0 and (year % 100 != 0 or year % 400 == 0)</font>
<font color="black"> 100. </font>
<font color="black"> 101. </font>
<font color="green"> 102. def leapdays(y1, y2):</font>
<font color="black"> 103.     &quot;&quot;&quot;Return number of leap years in range [y1, y2).</font>
<font color="black"> 104.        Assume y1 &lt;= y2.&quot;&quot;&quot;</font>
<font color="red"> 105.     y1 -= 1</font>
<font color="red"> 106.     y2 -= 1</font>
<font color="red"> 107.     return (y2//4 - y1//4) - (y2//100 - y1//100) + (y2//400 - y1//400)</font>
<font color="black"> 108. </font>
<font color="black"> 109. </font>
<font color="green"> 110. def weekday(year, month, day):</font>
<font color="black"> 111.     &quot;&quot;&quot;Return weekday (0-6 ~ Mon-Sun) for year (1970-...), month (1-12),</font>
<font color="black"> 112.        day (1-31).&quot;&quot;&quot;</font>
<font color="red"> 113.     return datetime.date(year, month, day).weekday()</font>
<font color="black"> 114. </font>
<font color="black"> 115. </font>
<font color="green"> 116. def monthrange(year, month):</font>
<font color="black"> 117.     &quot;&quot;&quot;Return weekday (0-6 ~ Mon-Sun) and number of days (28-31) for</font>
<font color="black"> 118.        year, month.&quot;&quot;&quot;</font>
<font color="red"> 119.     if not 1 &lt;= month &lt;= 12:</font>
<font color="red"> 120.         raise IllegalMonthError(month)</font>
<font color="red"> 121.     day1 = weekday(year, month, 1)</font>
<font color="red"> 122.     ndays = mdays[month] + (month == February and isleap(year))</font>
<font color="red"> 123.     return day1, ndays</font>
<font color="black"> 124. </font>
<font color="black"> 125. </font>
<font color="green"> 126. class Calendar(object):</font>
<font color="black"> 127.     &quot;&quot;&quot;</font>
<font color="black"> 128.     Base calendar class. This class doesn't do any formatting. It simply</font>
<font color="black"> 129.     provides data to subclasses.</font>
<font color="green"> 130.     &quot;&quot;&quot;</font>
<font color="black"> 131. </font>
<font color="green"> 132.     def __init__(self, firstweekday=0):</font>
<font color="green"> 133.         self.firstweekday = firstweekday # 0 = Monday, 6 = Sunday</font>
<font color="black"> 134. </font>
<font color="green"> 135.     def getfirstweekday(self):</font>
<font color="red"> 136.         return self._firstweekday % 7</font>
<font color="black"> 137. </font>
<font color="green"> 138.     def setfirstweekday(self, firstweekday):</font>
<font color="green"> 139.         self._firstweekday = firstweekday</font>
<font color="black"> 140. </font>
<font color="green"> 141.     firstweekday = property(getfirstweekday, setfirstweekday)</font>
<font color="black"> 142. </font>
<font color="green"> 143.     def iterweekdays(self):</font>
<font color="black"> 144.         &quot;&quot;&quot;</font>
<font color="black"> 145.         Return a iterator for one week of weekday numbers starting with the</font>
<font color="black"> 146.         configured first one.</font>
<font color="black"> 147.         &quot;&quot;&quot;</font>
<font color="red"> 148.         for i in range(self.firstweekday, self.firstweekday + 7):</font>
<font color="red"> 149.             yield i%7</font>
<font color="black"> 150. </font>
<font color="green"> 151.     def itermonthdates(self, year, month):</font>
<font color="black"> 152.         &quot;&quot;&quot;</font>
<font color="black"> 153.         Return an iterator for one month. The iterator will yield datetime.date</font>
<font color="black"> 154.         values and will always iterate through complete weeks, so it will yield</font>
<font color="black"> 155.         dates outside the specified month.</font>
<font color="black"> 156.         &quot;&quot;&quot;</font>
<font color="red"> 157.         date = datetime.date(year, month, 1)</font>
<font color="black"> 158.         # Go back to the beginning of the week</font>
<font color="red"> 159.         days = (date.weekday() - self.firstweekday) % 7</font>
<font color="red"> 160.         date -= datetime.timedelta(days=days)</font>
<font color="red"> 161.         oneday = datetime.timedelta(days=1)</font>
<font color="red"> 162.         while True:</font>
<font color="red"> 163.             yield date</font>
<font color="red"> 164.             try:</font>
<font color="red"> 165.                 date += oneday</font>
<font color="red"> 166.             except OverflowError:</font>
<font color="black"> 167.                 # Adding one day could fail after datetime.MAXYEAR</font>
<font color="red"> 168.                 break</font>
<font color="red"> 169.             if date.month != month and date.weekday() == self.firstweekday:</font>
<font color="red"> 170.                 break</font>
<font color="black"> 171. </font>
<font color="green"> 172.     def itermonthdays2(self, year, month):</font>
<font color="black"> 173.         &quot;&quot;&quot;</font>
<font color="black"> 174.         Like itermonthdates(), but will yield (day number, weekday number)</font>
<font color="black"> 175.         tuples. For days outside the specified month the day number is 0.</font>
<font color="black"> 176.         &quot;&quot;&quot;</font>
<font color="red"> 177.         for date in self.itermonthdates(year, month):</font>
<font color="red"> 178.             if date.month != month:</font>
<font color="red"> 179.                 yield (0, date.weekday())</font>
<font color="black"> 180.             else:</font>
<font color="red"> 181.                 yield (date.day, date.weekday())</font>
<font color="black"> 182. </font>
<font color="green"> 183.     def itermonthdays(self, year, month):</font>
<font color="black"> 184.         &quot;&quot;&quot;</font>
<font color="black"> 185.         Like itermonthdates(), but will yield day numbers. For days outside</font>
<font color="black"> 186.         the specified month the day number is 0.</font>
<font color="black"> 187.         &quot;&quot;&quot;</font>
<font color="red"> 188.         for date in self.itermonthdates(year, month):</font>
<font color="red"> 189.             if date.month != month:</font>
<font color="red"> 190.                 yield 0</font>
<font color="black"> 191.             else:</font>
<font color="red"> 192.                 yield date.day</font>
<font color="black"> 193. </font>
<font color="green"> 194.     def monthdatescalendar(self, year, month):</font>
<font color="black"> 195.         &quot;&quot;&quot;</font>
<font color="black"> 196.         Return a matrix (list of lists) representing a month's calendar.</font>
<font color="black"> 197.         Each row represents a week; week entries are datetime.date values.</font>
<font color="black"> 198.         &quot;&quot;&quot;</font>
<font color="red"> 199.         dates = list(self.itermonthdates(year, month))</font>
<font color="red"> 200.         return [ dates[i:i+7] for i in range(0, len(dates), 7) ]</font>
<font color="black"> 201. </font>
<font color="green"> 202.     def monthdays2calendar(self, year, month):</font>
<font color="black"> 203.         &quot;&quot;&quot;</font>
<font color="black"> 204.         Return a matrix representing a month's calendar.</font>
<font color="black"> 205.         Each row represents a week; week entries are</font>
<font color="black"> 206.         (day number, weekday number) tuples. Day numbers outside this month</font>
<font color="black"> 207.         are zero.</font>
<font color="black"> 208.         &quot;&quot;&quot;</font>
<font color="red"> 209.         days = list(self.itermonthdays2(year, month))</font>
<font color="red"> 210.         return [ days[i:i+7] for i in range(0, len(days), 7) ]</font>
<font color="black"> 211. </font>
<font color="green"> 212.     def monthdayscalendar(self, year, month):</font>
<font color="black"> 213.         &quot;&quot;&quot;</font>
<font color="black"> 214.         Return a matrix representing a month's calendar.</font>
<font color="black"> 215.         Each row represents a week; days outside this month are zero.</font>
<font color="black"> 216.         &quot;&quot;&quot;</font>
<font color="red"> 217.         days = list(self.itermonthdays(year, month))</font>
<font color="red"> 218.         return [ days[i:i+7] for i in range(0, len(days), 7) ]</font>
<font color="black"> 219. </font>
<font color="green"> 220.     def yeardatescalendar(self, year, width=3):</font>
<font color="black"> 221.         &quot;&quot;&quot;</font>
<font color="black"> 222.         Return the data for the specified year ready for formatting. The return</font>
<font color="black"> 223.         value is a list of month rows. Each month row contains up to width months.</font>
<font color="black"> 224.         Each month contains between 4 and 6 weeks and each week contains 1-7</font>
<font color="black"> 225.         days. Days are datetime.date objects.</font>
<font color="black"> 226.         &quot;&quot;&quot;</font>
<font color="black"> 227.         months = [</font>
<font color="red"> 228.             self.monthdatescalendar(year, i)</font>
<font color="red"> 229.             for i in range(January, January+12)</font>
<font color="black"> 230.         ]</font>
<font color="red"> 231.         return [months[i:i+width] for i in range(0, len(months), width) ]</font>
<font color="black"> 232. </font>
<font color="green"> 233.     def yeardays2calendar(self, year, width=3):</font>
<font color="black"> 234.         &quot;&quot;&quot;</font>
<font color="black"> 235.         Return the data for the specified year ready for formatting (similar to</font>
<font color="black"> 236.         yeardatescalendar()). Entries in the week lists are</font>
<font color="black"> 237.         (day number, weekday number) tuples. Day numbers outside this month are</font>
<font color="black"> 238.         zero.</font>
<font color="black"> 239.         &quot;&quot;&quot;</font>
<font color="black"> 240.         months = [</font>
<font color="red"> 241.             self.monthdays2calendar(year, i)</font>
<font color="red"> 242.             for i in range(January, January+12)</font>
<font color="black"> 243.         ]</font>
<font color="red"> 244.         return [months[i:i+width] for i in range(0, len(months), width) ]</font>
<font color="black"> 245. </font>
<font color="green"> 246.     def yeardayscalendar(self, year, width=3):</font>
<font color="black"> 247.         &quot;&quot;&quot;</font>
<font color="black"> 248.         Return the data for the specified year ready for formatting (similar to</font>
<font color="black"> 249.         yeardatescalendar()). Entries in the week lists are day numbers.</font>
<font color="black"> 250.         Day numbers outside this month are zero.</font>
<font color="black"> 251.         &quot;&quot;&quot;</font>
<font color="black"> 252.         months = [</font>
<font color="red"> 253.             self.monthdayscalendar(year, i)</font>
<font color="red"> 254.             for i in range(January, January+12)</font>
<font color="black"> 255.         ]</font>
<font color="red"> 256.         return [months[i:i+width] for i in range(0, len(months), width) ]</font>
<font color="black"> 257. </font>
<font color="black"> 258. </font>
<font color="green"> 259. class TextCalendar(Calendar):</font>
<font color="black"> 260.     &quot;&quot;&quot;</font>
<font color="black"> 261.     Subclass of Calendar that outputs a calendar as a simple plain text</font>
<font color="black"> 262.     similar to the UNIX program cal.</font>
<font color="green"> 263.     &quot;&quot;&quot;</font>
<font color="black"> 264. </font>
<font color="green"> 265.     def prweek(self, theweek, width):</font>
<font color="black"> 266.         &quot;&quot;&quot;</font>
<font color="black"> 267.         Print a single week (no newline).</font>
<font color="black"> 268.         &quot;&quot;&quot;</font>
<font color="red"> 269.         print self.formatweek(theweek, width),</font>
<font color="black"> 270. </font>
<font color="green"> 271.     def formatday(self, day, weekday, width):</font>
<font color="black"> 272.         &quot;&quot;&quot;</font>
<font color="black"> 273.         Returns a formatted day.</font>
<font color="black"> 274.         &quot;&quot;&quot;</font>
<font color="red"> 275.         if day == 0:</font>
<font color="red"> 276.             s = ''</font>
<font color="black"> 277.         else:</font>
<font color="red"> 278.             s = '%2i' % day             # right-align single-digit days</font>
<font color="red"> 279.         return s.center(width)</font>
<font color="black"> 280. </font>
<font color="green"> 281.     def formatweek(self, theweek, width):</font>
<font color="black"> 282.         &quot;&quot;&quot;</font>
<font color="black"> 283.         Returns a single week in a string (no newline).</font>
<font color="black"> 284.         &quot;&quot;&quot;</font>
<font color="red"> 285.         return ' '.join(self.formatday(d, wd, width) for (d, wd) in theweek)</font>
<font color="black"> 286. </font>
<font color="green"> 287.     def formatweekday(self, day, width):</font>
<font color="black"> 288.         &quot;&quot;&quot;</font>
<font color="black"> 289.         Returns a formatted week day name.</font>
<font color="black"> 290.         &quot;&quot;&quot;</font>
<font color="red"> 291.         if width &gt;= 9:</font>
<font color="red"> 292.             names = day_name</font>
<font color="black"> 293.         else:</font>
<font color="red"> 294.             names = day_abbr</font>
<font color="red"> 295.         return names[day][:width].center(width)</font>
<font color="black"> 296. </font>
<font color="green"> 297.     def formatweekheader(self, width):</font>
<font color="black"> 298.         &quot;&quot;&quot;</font>
<font color="black"> 299.         Return a header for a week.</font>
<font color="black"> 300.         &quot;&quot;&quot;</font>
<font color="red"> 301.         return ' '.join(self.formatweekday(i, width) for i in self.iterweekdays())</font>
<font color="black"> 302. </font>
<font color="green"> 303.     def formatmonthname(self, theyear, themonth, width, withyear=True):</font>
<font color="black"> 304.         &quot;&quot;&quot;</font>
<font color="black"> 305.         Return a formatted month name.</font>
<font color="black"> 306.         &quot;&quot;&quot;</font>
<font color="red"> 307.         s = month_name[themonth]</font>
<font color="red"> 308.         if withyear:</font>
<font color="red"> 309.             s = &quot;%s %r&quot; % (s, theyear)</font>
<font color="red"> 310.         return s.center(width)</font>
<font color="black"> 311. </font>
<font color="green"> 312.     def prmonth(self, theyear, themonth, w=0, l=0):</font>
<font color="black"> 313.         &quot;&quot;&quot;</font>
<font color="black"> 314.         Print a month's calendar.</font>
<font color="black"> 315.         &quot;&quot;&quot;</font>
<font color="red"> 316.         print self.formatmonth(theyear, themonth, w, l),</font>
<font color="black"> 317. </font>
<font color="green"> 318.     def formatmonth(self, theyear, themonth, w=0, l=0):</font>
<font color="black"> 319.         &quot;&quot;&quot;</font>
<font color="black"> 320.         Return a month's calendar string (multi-line).</font>
<font color="black"> 321.         &quot;&quot;&quot;</font>
<font color="red"> 322.         w = max(2, w)</font>
<font color="red"> 323.         l = max(1, l)</font>
<font color="red"> 324.         s = self.formatmonthname(theyear, themonth, 7 * (w + 1) - 1)</font>
<font color="red"> 325.         s = s.rstrip()</font>
<font color="red"> 326.         s += '\n' * l</font>
<font color="red"> 327.         s += self.formatweekheader(w).rstrip()</font>
<font color="red"> 328.         s += '\n' * l</font>
<font color="red"> 329.         for week in self.monthdays2calendar(theyear, themonth):</font>
<font color="red"> 330.             s += self.formatweek(week, w).rstrip()</font>
<font color="red"> 331.             s += '\n' * l</font>
<font color="red"> 332.         return s</font>
<font color="black"> 333. </font>
<font color="green"> 334.     def formatyear(self, theyear, w=2, l=1, c=6, m=3):</font>
<font color="black"> 335.         &quot;&quot;&quot;</font>
<font color="black"> 336.         Returns a year's calendar as a multi-line string.</font>
<font color="black"> 337.         &quot;&quot;&quot;</font>
<font color="red"> 338.         w = max(2, w)</font>
<font color="red"> 339.         l = max(1, l)</font>
<font color="red"> 340.         c = max(2, c)</font>
<font color="red"> 341.         colwidth = (w + 1) * 7 - 1</font>
<font color="red"> 342.         v = []</font>
<font color="red"> 343.         a = v.append</font>
<font color="red"> 344.         a(repr(theyear).center(colwidth*m+c*(m-1)).rstrip())</font>
<font color="red"> 345.         a('\n'*l)</font>
<font color="red"> 346.         header = self.formatweekheader(w)</font>
<font color="red"> 347.         for (i, row) in enumerate(self.yeardays2calendar(theyear, m)):</font>
<font color="black"> 348.             # months in this row</font>
<font color="red"> 349.             months = range(m*i+1, min(m*(i+1)+1, 13))</font>
<font color="red"> 350.             a('\n'*l)</font>
<font color="red"> 351.             names = (self.formatmonthname(theyear, k, colwidth, False)</font>
<font color="red"> 352.                      for k in months)</font>
<font color="red"> 353.             a(formatstring(names, colwidth, c).rstrip())</font>
<font color="red"> 354.             a('\n'*l)</font>
<font color="red"> 355.             headers = (header for k in months)</font>
<font color="red"> 356.             a(formatstring(headers, colwidth, c).rstrip())</font>
<font color="red"> 357.             a('\n'*l)</font>
<font color="black"> 358.             # max number of weeks for this row</font>
<font color="red"> 359.             height = max(len(cal) for cal in row)</font>
<font color="red"> 360.             for j in range(height):</font>
<font color="red"> 361.                 weeks = []</font>
<font color="red"> 362.                 for cal in row:</font>
<font color="red"> 363.                     if j &gt;= len(cal):</font>
<font color="red"> 364.                         weeks.append('')</font>
<font color="black"> 365.                     else:</font>
<font color="red"> 366.                         weeks.append(self.formatweek(cal[j], w))</font>
<font color="red"> 367.                 a(formatstring(weeks, colwidth, c).rstrip())</font>
<font color="red"> 368.                 a('\n' * l)</font>
<font color="red"> 369.         return ''.join(v)</font>
<font color="black"> 370. </font>
<font color="green"> 371.     def pryear(self, theyear, w=0, l=0, c=6, m=3):</font>
<font color="black"> 372.         &quot;&quot;&quot;Print a year's calendar.&quot;&quot;&quot;</font>
<font color="red"> 373.         print self.formatyear(theyear, w, l, c, m)</font>
<font color="black"> 374. </font>
<font color="black"> 375. </font>
<font color="green"> 376. class HTMLCalendar(Calendar):</font>
<font color="black"> 377.     &quot;&quot;&quot;</font>
<font color="black"> 378.     This calendar returns complete HTML pages.</font>
<font color="green"> 379.     &quot;&quot;&quot;</font>
<font color="black"> 380. </font>
<font color="black"> 381.     # CSS classes for the day &lt;td&gt;s</font>
<font color="green"> 382.     cssclasses = [&quot;mon&quot;, &quot;tue&quot;, &quot;wed&quot;, &quot;thu&quot;, &quot;fri&quot;, &quot;sat&quot;, &quot;sun&quot;]</font>
<font color="black"> 383. </font>
<font color="green"> 384.     def formatday(self, day, weekday):</font>
<font color="black"> 385.         &quot;&quot;&quot;</font>
<font color="black"> 386.         Return a day as a table cell.</font>
<font color="black"> 387.         &quot;&quot;&quot;</font>
<font color="red"> 388.         if day == 0:</font>
<font color="red"> 389.             return '&lt;td class=&quot;noday&quot;&gt;&amp;nbsp;&lt;/td&gt;' # day outside month</font>
<font color="black"> 390.         else:</font>
<font color="red"> 391.             return '&lt;td class=&quot;%s&quot;&gt;%d&lt;/td&gt;' % (self.cssclasses[weekday], day)</font>
<font color="black"> 392. </font>
<font color="green"> 393.     def formatweek(self, theweek):</font>
<font color="black"> 394.         &quot;&quot;&quot;</font>
<font color="black"> 395.         Return a complete week as a table row.</font>
<font color="black"> 396.         &quot;&quot;&quot;</font>
<font color="red"> 397.         s = ''.join(self.formatday(d, wd) for (d, wd) in theweek)</font>
<font color="red"> 398.         return '&lt;tr&gt;%s&lt;/tr&gt;' % s</font>
<font color="black"> 399. </font>
<font color="green"> 400.     def formatweekday(self, day):</font>
<font color="black"> 401.         &quot;&quot;&quot;</font>
<font color="black"> 402.         Return a weekday name as a table header.</font>
<font color="black"> 403.         &quot;&quot;&quot;</font>
<font color="red"> 404.         return '&lt;th class=&quot;%s&quot;&gt;%s&lt;/th&gt;' % (self.cssclasses[day], day_abbr[day])</font>
<font color="black"> 405. </font>
<font color="green"> 406.     def formatweekheader(self):</font>
<font color="black"> 407.         &quot;&quot;&quot;</font>
<font color="black"> 408.         Return a header for a week as a table row.</font>
<font color="black"> 409.         &quot;&quot;&quot;</font>
<font color="red"> 410.         s = ''.join(self.formatweekday(i) for i in self.iterweekdays())</font>
<font color="red"> 411.         return '&lt;tr&gt;%s&lt;/tr&gt;' % s</font>
<font color="black"> 412. </font>
<font color="green"> 413.     def formatmonthname(self, theyear, themonth, withyear=True):</font>
<font color="black"> 414.         &quot;&quot;&quot;</font>
<font color="black"> 415.         Return a month name as a table row.</font>
<font color="black"> 416.         &quot;&quot;&quot;</font>
<font color="red"> 417.         if withyear:</font>
<font color="red"> 418.             s = '%s %s' % (month_name[themonth], theyear)</font>
<font color="black"> 419.         else:</font>
<font color="red"> 420.             s = '%s' % month_name[themonth]</font>
<font color="red"> 421.         return '&lt;tr&gt;&lt;th colspan=&quot;7&quot; class=&quot;month&quot;&gt;%s&lt;/th&gt;&lt;/tr&gt;' % s</font>
<font color="black"> 422. </font>
<font color="green"> 423.     def formatmonth(self, theyear, themonth, withyear=True):</font>
<font color="black"> 424.         &quot;&quot;&quot;</font>
<font color="black"> 425.         Return a formatted month as a table.</font>
<font color="black"> 426.         &quot;&quot;&quot;</font>
<font color="red"> 427.         v = []</font>
<font color="red"> 428.         a = v.append</font>
<font color="red"> 429.         a('&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; class=&quot;month&quot;&gt;')</font>
<font color="red"> 430.         a('\n')</font>
<font color="red"> 431.         a(self.formatmonthname(theyear, themonth, withyear=withyear))</font>
<font color="red"> 432.         a('\n')</font>
<font color="red"> 433.         a(self.formatweekheader())</font>
<font color="red"> 434.         a('\n')</font>
<font color="red"> 435.         for week in self.monthdays2calendar(theyear, themonth):</font>
<font color="red"> 436.             a(self.formatweek(week))</font>
<font color="red"> 437.             a('\n')</font>
<font color="red"> 438.         a('&lt;/table&gt;')</font>
<font color="red"> 439.         a('\n')</font>
<font color="red"> 440.         return ''.join(v)</font>
<font color="black"> 441. </font>
<font color="green"> 442.     def formatyear(self, theyear, width=3):</font>
<font color="black"> 443.         &quot;&quot;&quot;</font>
<font color="black"> 444.         Return a formatted year as a table of tables.</font>
<font color="black"> 445.         &quot;&quot;&quot;</font>
<font color="red"> 446.         v = []</font>
<font color="red"> 447.         a = v.append</font>
<font color="red"> 448.         width = max(width, 1)</font>
<font color="red"> 449.         a('&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; class=&quot;year&quot;&gt;')</font>
<font color="red"> 450.         a('\n')</font>
<font color="red"> 451.         a('&lt;tr&gt;&lt;th colspan=&quot;%d&quot; class=&quot;year&quot;&gt;%s&lt;/th&gt;&lt;/tr&gt;' % (width, theyear))</font>
<font color="red"> 452.         for i in range(January, January+12, width):</font>
<font color="black"> 453.             # months in this row</font>
<font color="red"> 454.             months = range(i, min(i+width, 13))</font>
<font color="red"> 455.             a('&lt;tr&gt;')</font>
<font color="red"> 456.             for m in months:</font>
<font color="red"> 457.                 a('&lt;td&gt;')</font>
<font color="red"> 458.                 a(self.formatmonth(theyear, m, withyear=False))</font>
<font color="red"> 459.                 a('&lt;/td&gt;')</font>
<font color="red"> 460.             a('&lt;/tr&gt;')</font>
<font color="red"> 461.         a('&lt;/table&gt;')</font>
<font color="red"> 462.         return ''.join(v)</font>
<font color="black"> 463. </font>
<font color="green"> 464.     def formatyearpage(self, theyear, width=3, css='calendar.css', encoding=None):</font>
<font color="black"> 465.         &quot;&quot;&quot;</font>
<font color="black"> 466.         Return a formatted year as a complete HTML page.</font>
<font color="black"> 467.         &quot;&quot;&quot;</font>
<font color="red"> 468.         if encoding is None:</font>
<font color="red"> 469.             encoding = sys.getdefaultencoding()</font>
<font color="red"> 470.         v = []</font>
<font color="red"> 471.         a = v.append</font>
<font color="red"> 472.         a('&lt;?xml version=&quot;1.0&quot; encoding=&quot;%s&quot;?&gt;\n' % encoding)</font>
<font color="red"> 473.         a('&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;\n')</font>
<font color="red"> 474.         a('&lt;html&gt;\n')</font>
<font color="red"> 475.         a('&lt;head&gt;\n')</font>
<font color="red"> 476.         a('&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=%s&quot; /&gt;\n' % encoding)</font>
<font color="red"> 477.         if css is not None:</font>
<font color="red"> 478.             a('&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;%s&quot; /&gt;\n' % css)</font>
<font color="red"> 479.         a('&lt;title&gt;Calendar for %d&lt;/title&gt;\n' % theyear)</font>
<font color="red"> 480.         a('&lt;/head&gt;\n')</font>
<font color="red"> 481.         a('&lt;body&gt;\n')</font>
<font color="red"> 482.         a(self.formatyear(theyear, width))</font>
<font color="red"> 483.         a('&lt;/body&gt;\n')</font>
<font color="red"> 484.         a('&lt;/html&gt;\n')</font>
<font color="red"> 485.         return ''.join(v).encode(encoding, &quot;xmlcharrefreplace&quot;)</font>
<font color="black"> 486. </font>
<font color="black"> 487. </font>
<font color="green"> 488. class TimeEncoding:</font>
<font color="green"> 489.     def __init__(self, locale):</font>
<font color="red"> 490.         self.locale = locale</font>
<font color="black"> 491. </font>
<font color="green"> 492.     def __enter__(self):</font>
<font color="red"> 493.         self.oldlocale = _locale.getlocale(_locale.LC_TIME)</font>
<font color="red"> 494.         _locale.setlocale(_locale.LC_TIME, self.locale)</font>
<font color="red"> 495.         return _locale.getlocale(_locale.LC_TIME)[1]</font>
<font color="black"> 496. </font>
<font color="green"> 497.     def __exit__(self, *args):</font>
<font color="red"> 498.         _locale.setlocale(_locale.LC_TIME, self.oldlocale)</font>
<font color="black"> 499. </font>
<font color="black"> 500. </font>
<font color="green"> 501. class LocaleTextCalendar(TextCalendar):</font>
<font color="black"> 502.     &quot;&quot;&quot;</font>
<font color="black"> 503.     This class can be passed a locale name in the constructor and will return</font>
<font color="black"> 504.     month and weekday names in the specified locale. If this locale includes</font>
<font color="black"> 505.     an encoding all strings containing month and weekday names will be returned</font>
<font color="black"> 506.     as unicode.</font>
<font color="green"> 507.     &quot;&quot;&quot;</font>
<font color="black"> 508. </font>
<font color="green"> 509.     def __init__(self, firstweekday=0, locale=None):</font>
<font color="red"> 510.         TextCalendar.__init__(self, firstweekday)</font>
<font color="red"> 511.         if locale is None:</font>
<font color="red"> 512.             locale = _locale.getdefaultlocale()</font>
<font color="red"> 513.         self.locale = locale</font>
<font color="black"> 514. </font>
<font color="green"> 515.     def formatweekday(self, day, width):</font>
<font color="red"> 516.         with TimeEncoding(self.locale) as encoding:</font>
<font color="red"> 517.             if width &gt;= 9:</font>
<font color="red"> 518.                 names = day_name</font>
<font color="black"> 519.             else:</font>
<font color="red"> 520.                 names = day_abbr</font>
<font color="red"> 521.             name = names[day]</font>
<font color="red"> 522.             if encoding is not None:</font>
<font color="red"> 523.                 name = name.decode(encoding)</font>
<font color="red"> 524.             return name[:width].center(width)</font>
<font color="black"> 525. </font>
<font color="green"> 526.     def formatmonthname(self, theyear, themonth, width, withyear=True):</font>
<font color="red"> 527.         with TimeEncoding(self.locale) as encoding:</font>
<font color="red"> 528.             s = month_name[themonth]</font>
<font color="red"> 529.             if encoding is not None:</font>
<font color="red"> 530.                 s = s.decode(encoding)</font>
<font color="red"> 531.             if withyear:</font>
<font color="red"> 532.                 s = &quot;%s %r&quot; % (s, theyear)</font>
<font color="red"> 533.             return s.center(width)</font>
<font color="black"> 534. </font>
<font color="black"> 535. </font>
<font color="green"> 536. class LocaleHTMLCalendar(HTMLCalendar):</font>
<font color="black"> 537.     &quot;&quot;&quot;</font>
<font color="black"> 538.     This class can be passed a locale name in the constructor and will return</font>
<font color="black"> 539.     month and weekday names in the specified locale. If this locale includes</font>
<font color="black"> 540.     an encoding all strings containing month and weekday names will be returned</font>
<font color="black"> 541.     as unicode.</font>
<font color="green"> 542.     &quot;&quot;&quot;</font>
<font color="green"> 543.     def __init__(self, firstweekday=0, locale=None):</font>
<font color="red"> 544.         HTMLCalendar.__init__(self, firstweekday)</font>
<font color="red"> 545.         if locale is None:</font>
<font color="red"> 546.             locale = _locale.getdefaultlocale()</font>
<font color="red"> 547.         self.locale = locale</font>
<font color="black"> 548. </font>
<font color="green"> 549.     def formatweekday(self, day):</font>
<font color="red"> 550.         with TimeEncoding(self.locale) as encoding:</font>
<font color="red"> 551.             s = day_abbr[day]</font>
<font color="red"> 552.             if encoding is not None:</font>
<font color="red"> 553.                 s = s.decode(encoding)</font>
<font color="red"> 554.             return '&lt;th class=&quot;%s&quot;&gt;%s&lt;/th&gt;' % (self.cssclasses[day], s)</font>
<font color="black"> 555. </font>
<font color="green"> 556.     def formatmonthname(self, theyear, themonth, withyear=True):</font>
<font color="red"> 557.         with TimeEncoding(self.locale) as encoding:</font>
<font color="red"> 558.             s = month_name[themonth]</font>
<font color="red"> 559.             if encoding is not None:</font>
<font color="red"> 560.                 s = s.decode(encoding)</font>
<font color="red"> 561.             if withyear:</font>
<font color="red"> 562.                 s = '%s %s' % (s, theyear)</font>
<font color="red"> 563.             return '&lt;tr&gt;&lt;th colspan=&quot;7&quot; class=&quot;month&quot;&gt;%s&lt;/th&gt;&lt;/tr&gt;' % s</font>
<font color="black"> 564. </font>
<font color="black"> 565. </font>
<font color="black"> 566. # Support for old module level interface</font>
<font color="green"> 567. c = TextCalendar()</font>
<font color="black"> 568. </font>
<font color="green"> 569. firstweekday = c.getfirstweekday</font>
<font color="black"> 570. </font>
<font color="green"> 571. def setfirstweekday(firstweekday):</font>
<font color="red"> 572.     try:</font>
<font color="red"> 573.         firstweekday.__index__</font>
<font color="red"> 574.     except AttributeError:</font>
<font color="red"> 575.         raise IllegalWeekdayError(firstweekday)</font>
<font color="red"> 576.     if not MONDAY &lt;= firstweekday &lt;= SUNDAY:</font>
<font color="red"> 577.         raise IllegalWeekdayError(firstweekday)</font>
<font color="red"> 578.     c.firstweekday = firstweekday</font>
<font color="black"> 579. </font>
<font color="green"> 580. monthcalendar = c.monthdayscalendar</font>
<font color="green"> 581. prweek = c.prweek</font>
<font color="green"> 582. week = c.formatweek</font>
<font color="green"> 583. weekheader = c.formatweekheader</font>
<font color="green"> 584. prmonth = c.prmonth</font>
<font color="green"> 585. month = c.formatmonth</font>
<font color="green"> 586. calendar = c.formatyear</font>
<font color="green"> 587. prcal = c.pryear</font>
<font color="black"> 588. </font>
<font color="black"> 589. </font>
<font color="black"> 590. # Spacing of month columns for multi-column year calendar</font>
<font color="green"> 591. _colwidth = 7*3 - 1         # Amount printed by prweek()</font>
<font color="green"> 592. _spacing = 6                # Number of spaces between columns</font>
<font color="black"> 593. </font>
<font color="black"> 594. </font>
<font color="green"> 595. def format(cols, colwidth=_colwidth, spacing=_spacing):</font>
<font color="black"> 596.     &quot;&quot;&quot;Prints multi-column formatting for year calendars&quot;&quot;&quot;</font>
<font color="red"> 597.     print formatstring(cols, colwidth, spacing)</font>
<font color="black"> 598. </font>
<font color="black"> 599. </font>
<font color="green"> 600. def formatstring(cols, colwidth=_colwidth, spacing=_spacing):</font>
<font color="black"> 601.     &quot;&quot;&quot;Returns a string formatted from n strings, centered within n columns.&quot;&quot;&quot;</font>
<font color="red"> 602.     spacing *= ' '</font>
<font color="red"> 603.     return spacing.join(c.center(colwidth) for c in cols)</font>
<font color="black"> 604. </font>
<font color="black"> 605. </font>
<font color="green"> 606. EPOCH = 1970</font>
<font color="green"> 607. _EPOCH_ORD = datetime.date(EPOCH, 1, 1).toordinal()</font>
<font color="black"> 608. </font>
<font color="black"> 609. </font>
<font color="green"> 610. def timegm(tuple):</font>
<font color="black"> 611.     &quot;&quot;&quot;Unrelated but handy function to calculate Unix timestamp from GMT.&quot;&quot;&quot;</font>
<font color="red"> 612.     year, month, day, hour, minute, second = tuple[:6]</font>
<font color="red"> 613.     days = datetime.date(year, month, 1).toordinal() - _EPOCH_ORD + day - 1</font>
<font color="red"> 614.     hours = days*24 + hour</font>
<font color="red"> 615.     minutes = hours*60 + minute</font>
<font color="red"> 616.     seconds = minutes*60 + second</font>
<font color="red"> 617.     return seconds</font>
<font color="black"> 618. </font>
<font color="black"> 619. </font>
<font color="green"> 620. def main(args):</font>
<font color="red"> 621.     import optparse</font>
<font color="red"> 622.     parser = optparse.OptionParser(usage=&quot;usage: %prog [options] [year [month]]&quot;)</font>
<font color="red"> 623.     parser.add_option(</font>
<font color="red"> 624.         &quot;-w&quot;, &quot;--width&quot;,</font>
<font color="red"> 625.         dest=&quot;width&quot;, type=&quot;int&quot;, default=2,</font>
<font color="red"> 626.         help=&quot;width of date column (default 2, text only)&quot;</font>
<font color="black"> 627.     )</font>
<font color="red"> 628.     parser.add_option(</font>
<font color="red"> 629.         &quot;-l&quot;, &quot;--lines&quot;,</font>
<font color="red"> 630.         dest=&quot;lines&quot;, type=&quot;int&quot;, default=1,</font>
<font color="red"> 631.         help=&quot;number of lines for each week (default 1, text only)&quot;</font>
<font color="black"> 632.     )</font>
<font color="red"> 633.     parser.add_option(</font>
<font color="red"> 634.         &quot;-s&quot;, &quot;--spacing&quot;,</font>
<font color="red"> 635.         dest=&quot;spacing&quot;, type=&quot;int&quot;, default=6,</font>
<font color="red"> 636.         help=&quot;spacing between months (default 6, text only)&quot;</font>
<font color="black"> 637.     )</font>
<font color="red"> 638.     parser.add_option(</font>
<font color="red"> 639.         &quot;-m&quot;, &quot;--months&quot;,</font>
<font color="red"> 640.         dest=&quot;months&quot;, type=&quot;int&quot;, default=3,</font>
<font color="red"> 641.         help=&quot;months per row (default 3, text only)&quot;</font>
<font color="black"> 642.     )</font>
<font color="red"> 643.     parser.add_option(</font>
<font color="red"> 644.         &quot;-c&quot;, &quot;--css&quot;,</font>
<font color="red"> 645.         dest=&quot;css&quot;, default=&quot;calendar.css&quot;,</font>
<font color="red"> 646.         help=&quot;CSS to use for page (html only)&quot;</font>
<font color="black"> 647.     )</font>
<font color="red"> 648.     parser.add_option(</font>
<font color="red"> 649.         &quot;-L&quot;, &quot;--locale&quot;,</font>
<font color="red"> 650.         dest=&quot;locale&quot;, default=None,</font>
<font color="red"> 651.         help=&quot;locale to be used from month and weekday names&quot;</font>
<font color="black"> 652.     )</font>
<font color="red"> 653.     parser.add_option(</font>
<font color="red"> 654.         &quot;-e&quot;, &quot;--encoding&quot;,</font>
<font color="red"> 655.         dest=&quot;encoding&quot;, default=None,</font>
<font color="red"> 656.         help=&quot;Encoding to use for output&quot;</font>
<font color="black"> 657.     )</font>
<font color="red"> 658.     parser.add_option(</font>
<font color="red"> 659.         &quot;-t&quot;, &quot;--type&quot;,</font>
<font color="red"> 660.         dest=&quot;type&quot;, default=&quot;text&quot;,</font>
<font color="red"> 661.         choices=(&quot;text&quot;, &quot;html&quot;),</font>
<font color="red"> 662.         help=&quot;output type (text or html)&quot;</font>
<font color="black"> 663.     )</font>
<font color="black"> 664. </font>
<font color="red"> 665.     (options, args) = parser.parse_args(args)</font>
<font color="black"> 666. </font>
<font color="red"> 667.     if options.locale and not options.encoding:</font>
<font color="red"> 668.         parser.error(&quot;if --locale is specified --encoding is required&quot;)</font>
<font color="red"> 669.         sys.exit(1)</font>
<font color="black"> 670. </font>
<font color="red"> 671.     locale = options.locale, options.encoding</font>
<font color="black"> 672. </font>
<font color="red"> 673.     if options.type == &quot;html&quot;:</font>
<font color="red"> 674.         if options.locale:</font>
<font color="red"> 675.             cal = LocaleHTMLCalendar(locale=locale)</font>
<font color="black"> 676.         else:</font>
<font color="red"> 677.             cal = HTMLCalendar()</font>
<font color="red"> 678.         encoding = options.encoding</font>
<font color="red"> 679.         if encoding is None:</font>
<font color="red"> 680.             encoding = sys.getdefaultencoding()</font>
<font color="red"> 681.         optdict = dict(encoding=encoding, css=options.css)</font>
<font color="red"> 682.         if len(args) == 1:</font>
<font color="red"> 683.             print cal.formatyearpage(datetime.date.today().year, **optdict)</font>
<font color="red"> 684.         elif len(args) == 2:</font>
<font color="red"> 685.             print cal.formatyearpage(int(args[1]), **optdict)</font>
<font color="black"> 686.         else:</font>
<font color="red"> 687.             parser.error(&quot;incorrect number of arguments&quot;)</font>
<font color="red"> 688.             sys.exit(1)</font>
<font color="black"> 689.     else:</font>
<font color="red"> 690.         if options.locale:</font>
<font color="red"> 691.             cal = LocaleTextCalendar(locale=locale)</font>
<font color="black"> 692.         else:</font>
<font color="red"> 693.             cal = TextCalendar()</font>
<font color="red"> 694.         optdict = dict(w=options.width, l=options.lines)</font>
<font color="red"> 695.         if len(args) != 3:</font>
<font color="red"> 696.             optdict[&quot;c&quot;] = options.spacing</font>
<font color="red"> 697.             optdict[&quot;m&quot;] = options.months</font>
<font color="red"> 698.         if len(args) == 1:</font>
<font color="red"> 699.             result = cal.formatyear(datetime.date.today().year, **optdict)</font>
<font color="red"> 700.         elif len(args) == 2:</font>
<font color="red"> 701.             result = cal.formatyear(int(args[1]), **optdict)</font>
<font color="red"> 702.         elif len(args) == 3:</font>
<font color="red"> 703.             result = cal.formatmonth(int(args[1]), int(args[2]), **optdict)</font>
<font color="black"> 704.         else:</font>
<font color="red"> 705.             parser.error(&quot;incorrect number of arguments&quot;)</font>
<font color="red"> 706.             sys.exit(1)</font>
<font color="red"> 707.         if options.encoding:</font>
<font color="red"> 708.             result = result.encode(options.encoding)</font>
<font color="red"> 709.         print result</font>
<font color="black"> 710. </font>
<font color="black"> 711. </font>
<font color="green"> 712. if __name__ == &quot;__main__&quot;:</font>
<font color="red"> 713.     main(sys.argv)</font>
</pre>

