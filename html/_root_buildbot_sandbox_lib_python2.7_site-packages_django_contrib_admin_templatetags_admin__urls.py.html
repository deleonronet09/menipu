source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/contrib/admin/templatetags/admin_urls.py</b><br>


file stats: <b>38 lines, 10 executed: 26.3% covered</b>
<pre>
<font color="green">   1. from django import template</font>
<font color="green">   2. from django.contrib.admin.utils import quote</font>
<font color="green">   3. from django.core.urlresolvers import Resolver404, get_script_prefix, resolve</font>
<font color="green">   4. from django.utils.http import urlencode</font>
<font color="green">   5. from django.utils.six.moves.urllib.parse import parse_qsl, urlparse, urlunparse</font>
<font color="black">   6. </font>
<font color="green">   7. register = template.Library()</font>
<font color="black">   8. </font>
<font color="black">   9. </font>
<font color="green">  10. @register.filter</font>
<font color="black">  11. def admin_urlname(value, arg):</font>
<font color="red">  12.     return 'admin:%s_%s_%s' % (value.app_label, value.model_name, arg)</font>
<font color="black">  13. </font>
<font color="black">  14. </font>
<font color="green">  15. @register.filter</font>
<font color="black">  16. def admin_urlquote(value):</font>
<font color="red">  17.     return quote(value)</font>
<font color="black">  18. </font>
<font color="black">  19. </font>
<font color="green">  20. @register.simple_tag(takes_context=True)</font>
<font color="green">  21. def add_preserved_filters(context, url, popup=False, to_field=None):</font>
<font color="red">  22.     opts = context.get('opts')</font>
<font color="red">  23.     preserved_filters = context.get('preserved_filters')</font>
<font color="black">  24. </font>
<font color="red">  25.     parsed_url = list(urlparse(url))</font>
<font color="red">  26.     parsed_qs = dict(parse_qsl(parsed_url[4]))</font>
<font color="red">  27.     merged_qs = dict()</font>
<font color="black">  28. </font>
<font color="red">  29.     if opts and preserved_filters:</font>
<font color="red">  30.         preserved_filters = dict(parse_qsl(preserved_filters))</font>
<font color="black">  31. </font>
<font color="red">  32.         match_url = '/%s' % url.partition(get_script_prefix())[2]</font>
<font color="red">  33.         try:</font>
<font color="red">  34.             match = resolve(match_url)</font>
<font color="red">  35.         except Resolver404:</font>
<font color="red">  36.             pass</font>
<font color="black">  37.         else:</font>
<font color="red">  38.             current_url = '%s:%s' % (match.app_name, match.url_name)</font>
<font color="red">  39.             changelist_url = 'admin:%s_%s_changelist' % (opts.app_label, opts.model_name)</font>
<font color="red">  40.             if changelist_url == current_url and '_changelist_filters' in preserved_filters:</font>
<font color="red">  41.                 preserved_filters = dict(parse_qsl(preserved_filters['_changelist_filters']))</font>
<font color="black">  42. </font>
<font color="red">  43.         merged_qs.update(preserved_filters)</font>
<font color="black">  44. </font>
<font color="red">  45.     if popup:</font>
<font color="red">  46.         from django.contrib.admin.options import IS_POPUP_VAR</font>
<font color="red">  47.         merged_qs[IS_POPUP_VAR] = 1</font>
<font color="red">  48.     if to_field:</font>
<font color="red">  49.         from django.contrib.admin.options import TO_FIELD_VAR</font>
<font color="red">  50.         merged_qs[TO_FIELD_VAR] = to_field</font>
<font color="black">  51. </font>
<font color="red">  52.     merged_qs.update(parsed_qs)</font>
<font color="black">  53. </font>
<font color="red">  54.     parsed_url[4] = urlencode(merged_qs)</font>
<font color="red">  55.     return urlunparse(parsed_url)</font>
</pre>

