source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/core/management/commands/test.py</b><br>


file stats: <b>59 lines, 50 executed: 84.7% covered</b>
<pre>
<font color="green">   1. import logging</font>
<font color="green">   2. import os</font>
<font color="green">   3. import sys</font>
<font color="black">   4. </font>
<font color="green">   5. from django.conf import settings</font>
<font color="green">   6. from django.core.management.base import BaseCommand</font>
<font color="green">   7. from django.test.utils import get_runner</font>
<font color="black">   8. </font>
<font color="black">   9. </font>
<font color="green">  10. class Command(BaseCommand):</font>
<font color="green">  11.     help = 'Discover and run tests in the specified modules or the current directory.'</font>
<font color="black">  12. </font>
<font color="green">  13.     requires_system_checks = False</font>
<font color="black">  14. </font>
<font color="green">  15.     def __init__(self):</font>
<font color="green">  16.         self.test_runner = None</font>
<font color="green">  17.         super(Command, self).__init__()</font>
<font color="black">  18. </font>
<font color="green">  19.     def run_from_argv(self, argv):</font>
<font color="black">  20.         &quot;&quot;&quot;</font>
<font color="black">  21.         Pre-parse the command line to extract the value of the --testrunner</font>
<font color="black">  22.         option. This allows a test runner to define additional command line</font>
<font color="black">  23.         arguments.</font>
<font color="black">  24.         &quot;&quot;&quot;</font>
<font color="green">  25.         option = '--testrunner='</font>
<font color="green">  26.         for arg in argv[2:]:</font>
<font color="red">  27.             if arg.startswith(option):</font>
<font color="red">  28.                 self.test_runner = arg[len(option):]</font>
<font color="red">  29.                 break</font>
<font color="green">  30.         super(Command, self).run_from_argv(argv)</font>
<font color="black">  31. </font>
<font color="green">  32.     def add_arguments(self, parser):</font>
<font color="green">  33.         parser.add_argument('args', metavar='test_label', nargs='*',</font>
<font color="green">  34.             help='Module paths to test; can be modulename, modulename.TestCase or modulename.TestCase.test_method')</font>
<font color="green">  35.         parser.add_argument('--noinput', '--no-input',</font>
<font color="green">  36.             action='store_false', dest='interactive', default=True,</font>
<font color="green">  37.             help='Tells Django to NOT prompt the user for input of any kind.'),</font>
<font color="green">  38.         parser.add_argument('--failfast',</font>
<font color="green">  39.             action='store_true', dest='failfast', default=False,</font>
<font color="green">  40.             help='Tells Django to stop running the test suite after first '</font>
<font color="black">  41.                  'failed test.'),</font>
<font color="green">  42.         parser.add_argument('--testrunner',</font>
<font color="green">  43.             action='store', dest='testrunner',</font>
<font color="green">  44.             help='Tells Django to use specified test runner class instead of '</font>
<font color="black">  45.                  'the one specified by the TEST_RUNNER setting.'),</font>
<font color="green">  46.         parser.add_argument('--liveserver',</font>
<font color="green">  47.             action='store', dest='liveserver', default=None,</font>
<font color="green">  48.             help='Overrides the default address where the live server (used '</font>
<font color="black">  49.                  'with LiveServerTestCase) is expected to run from. The '</font>
<font color="black">  50.                  'default value is localhost:8081-8179.'),</font>
<font color="black">  51. </font>
<font color="green">  52.         test_runner_class = get_runner(settings, self.test_runner)</font>
<font color="green">  53.         if hasattr(test_runner_class, 'option_list'):</font>
<font color="black">  54.             # Keeping compatibility with both optparse and argparse at this level</font>
<font color="black">  55.             # would be too heavy for a non-critical item</font>
<font color="red">  56.             raise RuntimeError(</font>
<font color="red">  57.                 &quot;The method to extend accepted command-line arguments by the &quot;</font>
<font color="black">  58.                 &quot;test management command has changed in Django 1.8. Please &quot;</font>
<font color="black">  59.                 &quot;create an add_arguments class method to achieve this.&quot;)</font>
<font color="black">  60. </font>
<font color="green">  61.         if hasattr(test_runner_class, 'add_arguments'):</font>
<font color="green">  62.             test_runner_class.add_arguments(parser)</font>
<font color="black">  63. </font>
<font color="green">  64.     def execute(self, *args, **options):</font>
<font color="green">  65.         if options['verbosity'] &gt; 0:</font>
<font color="black">  66.             # ensure that deprecation warnings are displayed during testing</font>
<font color="black">  67.             # the following state is assumed:</font>
<font color="black">  68.             # logging.capturewarnings is true</font>
<font color="black">  69.             # a &quot;default&quot; level warnings filter has been added for</font>
<font color="black">  70.             # DeprecationWarning. See django.conf.LazySettings._configure_logging</font>
<font color="green">  71.             logger = logging.getLogger('py.warnings')</font>
<font color="green">  72.             handler = logging.StreamHandler()</font>
<font color="green">  73.             logger.addHandler(handler)</font>
<font color="green">  74.         super(Command, self).execute(*args, **options)</font>
<font color="red">  75.         if options['verbosity'] &gt; 0:</font>
<font color="black">  76.             # remove the testing-specific handler</font>
<font color="red">  77.             logger.removeHandler(handler)</font>
<font color="black">  78. </font>
<font color="green">  79.     def handle(self, *test_labels, **options):</font>
<font color="green">  80.         from django.conf import settings</font>
<font color="green">  81.         from django.test.utils import get_runner</font>
<font color="black">  82. </font>
<font color="green">  83.         TestRunner = get_runner(settings, options.get('testrunner'))</font>
<font color="black">  84. </font>
<font color="green">  85.         if options.get('liveserver') is not None:</font>
<font color="red">  86.             os.environ['DJANGO_LIVE_TEST_SERVER_ADDRESS'] = options['liveserver']</font>
<font color="red">  87.             del options['liveserver']</font>
<font color="black">  88. </font>
<font color="green">  89.         test_runner = TestRunner(**options)</font>
<font color="green">  90.         failures = test_runner.run_tests(test_labels)</font>
<font color="black">  91. </font>
<font color="green">  92.         if failures:</font>
<font color="green">  93.             sys.exit(bool(failures))</font>
</pre>

