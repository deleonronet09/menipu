source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/contrib/messages/api.py</b><br>


file stats: <b>43 lines, 15 executed: 34.9% covered</b>
<pre>
<font color="green">   1. from django.contrib.messages import constants</font>
<font color="green">   2. from django.contrib.messages.storage import default_storage</font>
<font color="green">   3. from django.http import HttpRequest</font>
<font color="black">   4. </font>
<font color="black">   5. __all__ = (</font>
<font color="black">   6.     'add_message', 'get_messages',</font>
<font color="black">   7.     'get_level', 'set_level',</font>
<font color="black">   8.     'debug', 'info', 'success', 'warning', 'error',</font>
<font color="green">   9.     'MessageFailure',</font>
<font color="black">  10. )</font>
<font color="black">  11. </font>
<font color="black">  12. </font>
<font color="green">  13. class MessageFailure(Exception):</font>
<font color="green">  14.     pass</font>
<font color="black">  15. </font>
<font color="black">  16. </font>
<font color="green">  17. def add_message(request, level, message, extra_tags='', fail_silently=False):</font>
<font color="black">  18.     &quot;&quot;&quot;</font>
<font color="black">  19.     Attempts to add a message to the request using the 'messages' app.</font>
<font color="black">  20.     &quot;&quot;&quot;</font>
<font color="red">  21.     if not isinstance(request, HttpRequest):</font>
<font color="red">  22.         raise TypeError(&quot;add_message() argument must be an HttpRequest object, &quot;</font>
<font color="red">  23.                         &quot;not '%s'.&quot; % request.__class__.__name__)</font>
<font color="red">  24.     if hasattr(request, '_messages'):</font>
<font color="red">  25.         return request._messages.add(level, message, extra_tags)</font>
<font color="red">  26.     if not fail_silently:</font>
<font color="red">  27.         raise MessageFailure('You cannot add messages without installing '</font>
<font color="black">  28.                     'django.contrib.messages.middleware.MessageMiddleware')</font>
<font color="black">  29. </font>
<font color="black">  30. </font>
<font color="green">  31. def get_messages(request):</font>
<font color="black">  32.     &quot;&quot;&quot;</font>
<font color="black">  33.     Returns the message storage on the request if it exists, otherwise returns</font>
<font color="black">  34.     an empty list.</font>
<font color="black">  35.     &quot;&quot;&quot;</font>
<font color="red">  36.     if hasattr(request, '_messages'):</font>
<font color="red">  37.         return request._messages</font>
<font color="black">  38.     else:</font>
<font color="red">  39.         return []</font>
<font color="black">  40. </font>
<font color="black">  41. </font>
<font color="green">  42. def get_level(request):</font>
<font color="black">  43.     &quot;&quot;&quot;</font>
<font color="black">  44.     Returns the minimum level of messages to be recorded.</font>
<font color="black">  45. </font>
<font color="black">  46.     The default level is the ``MESSAGE_LEVEL`` setting. If this is not found,</font>
<font color="black">  47.     the ``INFO`` level is used.</font>
<font color="black">  48.     &quot;&quot;&quot;</font>
<font color="red">  49.     if hasattr(request, '_messages'):</font>
<font color="red">  50.         storage = request._messages</font>
<font color="black">  51.     else:</font>
<font color="red">  52.         storage = default_storage(request)</font>
<font color="red">  53.     return storage.level</font>
<font color="black">  54. </font>
<font color="black">  55. </font>
<font color="green">  56. def set_level(request, level):</font>
<font color="black">  57.     &quot;&quot;&quot;</font>
<font color="black">  58.     Sets the minimum level of messages to be recorded, returning ``True`` if</font>
<font color="black">  59.     the level was recorded successfully.</font>
<font color="black">  60. </font>
<font color="black">  61.     If set to ``None``, the default level will be used (see the ``get_level``</font>
<font color="black">  62.     method).</font>
<font color="black">  63.     &quot;&quot;&quot;</font>
<font color="red">  64.     if not hasattr(request, '_messages'):</font>
<font color="red">  65.         return False</font>
<font color="red">  66.     request._messages.level = level</font>
<font color="red">  67.     return True</font>
<font color="black">  68. </font>
<font color="black">  69. </font>
<font color="green">  70. def debug(request, message, extra_tags='', fail_silently=False):</font>
<font color="black">  71.     &quot;&quot;&quot;</font>
<font color="black">  72.     Adds a message with the ``DEBUG`` level.</font>
<font color="black">  73.     &quot;&quot;&quot;</font>
<font color="red">  74.     add_message(request, constants.DEBUG, message, extra_tags=extra_tags,</font>
<font color="red">  75.                 fail_silently=fail_silently)</font>
<font color="black">  76. </font>
<font color="black">  77. </font>
<font color="green">  78. def info(request, message, extra_tags='', fail_silently=False):</font>
<font color="black">  79.     &quot;&quot;&quot;</font>
<font color="black">  80.     Adds a message with the ``INFO`` level.</font>
<font color="black">  81.     &quot;&quot;&quot;</font>
<font color="red">  82.     add_message(request, constants.INFO, message, extra_tags=extra_tags,</font>
<font color="red">  83.                 fail_silently=fail_silently)</font>
<font color="black">  84. </font>
<font color="black">  85. </font>
<font color="green">  86. def success(request, message, extra_tags='', fail_silently=False):</font>
<font color="black">  87.     &quot;&quot;&quot;</font>
<font color="black">  88.     Adds a message with the ``SUCCESS`` level.</font>
<font color="black">  89.     &quot;&quot;&quot;</font>
<font color="red">  90.     add_message(request, constants.SUCCESS, message, extra_tags=extra_tags,</font>
<font color="red">  91.                 fail_silently=fail_silently)</font>
<font color="black">  92. </font>
<font color="black">  93. </font>
<font color="green">  94. def warning(request, message, extra_tags='', fail_silently=False):</font>
<font color="black">  95.     &quot;&quot;&quot;</font>
<font color="black">  96.     Adds a message with the ``WARNING`` level.</font>
<font color="black">  97.     &quot;&quot;&quot;</font>
<font color="red">  98.     add_message(request, constants.WARNING, message, extra_tags=extra_tags,</font>
<font color="red">  99.                 fail_silently=fail_silently)</font>
<font color="black"> 100. </font>
<font color="black"> 101. </font>
<font color="green"> 102. def error(request, message, extra_tags='', fail_silently=False):</font>
<font color="black"> 103.     &quot;&quot;&quot;</font>
<font color="black"> 104.     Adds a message with the ``ERROR`` level.</font>
<font color="black"> 105.     &quot;&quot;&quot;</font>
<font color="red"> 106.     add_message(request, constants.ERROR, message, extra_tags=extra_tags,</font>
<font color="red"> 107.                 fail_silently=fail_silently)</font>
</pre>

