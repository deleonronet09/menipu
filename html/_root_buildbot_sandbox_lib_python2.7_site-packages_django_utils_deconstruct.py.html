source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/utils/deconstruct.py</b><br>


file stats: <b>28 lines, 15 executed: 53.6% covered</b>
<pre>
<font color="green">   1. from importlib import import_module</font>
<font color="black">   2. </font>
<font color="green">   3. from django.utils.version import get_docs_version</font>
<font color="black">   4. </font>
<font color="black">   5. </font>
<font color="green">   6. def deconstructible(*args, **kwargs):</font>
<font color="black">   7.     &quot;&quot;&quot;</font>
<font color="black">   8.     Class decorator that allow the decorated class to be serialized</font>
<font color="black">   9.     by the migrations subsystem.</font>
<font color="black">  10. </font>
<font color="black">  11.     Accepts an optional kwarg `path` to specify the import path.</font>
<font color="black">  12.     &quot;&quot;&quot;</font>
<font color="green">  13.     path = kwargs.pop('path', None)</font>
<font color="black">  14. </font>
<font color="green">  15.     def decorator(klass):</font>
<font color="green">  16.         def __new__(cls, *args, **kwargs):</font>
<font color="black">  17.             # We capture the arguments to make returning them trivial</font>
<font color="green">  18.             obj = super(klass, cls).__new__(cls)</font>
<font color="green">  19.             obj._constructor_args = (args, kwargs)</font>
<font color="green">  20.             return obj</font>
<font color="black">  21. </font>
<font color="green">  22.         def deconstruct(obj):</font>
<font color="black">  23.             &quot;&quot;&quot;</font>
<font color="black">  24.             Returns a 3-tuple of class import path, positional arguments,</font>
<font color="black">  25.             and keyword arguments.</font>
<font color="black">  26.             &quot;&quot;&quot;</font>
<font color="black">  27.             # Python 2/fallback version</font>
<font color="red">  28.             if path:</font>
<font color="red">  29.                 module_name, _, name = path.rpartition('.')</font>
<font color="black">  30.             else:</font>
<font color="red">  31.                 module_name = obj.__module__</font>
<font color="red">  32.                 name = obj.__class__.__name__</font>
<font color="black">  33.             # Make sure it's actually there and not an inner class</font>
<font color="red">  34.             module = import_module(module_name)</font>
<font color="red">  35.             if not hasattr(module, name):</font>
<font color="red">  36.                 raise ValueError(</font>
<font color="red">  37.                     &quot;Could not find object %s in %s.\n&quot;</font>
<font color="black">  38.                     &quot;Please note that you cannot serialize things like inner &quot;</font>
<font color="black">  39.                     &quot;classes. Please move the object into the main module &quot;</font>
<font color="black">  40.                     &quot;body to use migrations.\n&quot;</font>
<font color="black">  41.                     &quot;For more information, see &quot;</font>
<font color="black">  42.                     &quot;https://docs.djangoproject.com/en/%s/topics/migrations/#serializing-values&quot;</font>
<font color="red">  43.                     % (name, module_name, get_docs_version()))</font>
<font color="black">  44.             return (</font>
<font color="red">  45.                 path or '%s.%s' % (obj.__class__.__module__, name),</font>
<font color="red">  46.                 obj._constructor_args[0],</font>
<font color="red">  47.                 obj._constructor_args[1],</font>
<font color="black">  48.             )</font>
<font color="black">  49. </font>
<font color="green">  50.         klass.__new__ = staticmethod(__new__)</font>
<font color="green">  51.         klass.deconstruct = deconstruct</font>
<font color="black">  52. </font>
<font color="green">  53.         return klass</font>
<font color="black">  54. </font>
<font color="green">  55.     if not args:</font>
<font color="red">  56.         return decorator</font>
<font color="green">  57.     return decorator(*args, **kwargs)</font>
</pre>

