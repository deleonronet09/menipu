source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/core/checks/security/sessions.py</b><br>


file stats: <b>55 lines, 34 executed: 61.8% covered</b>
<pre>
<font color="green">   1. from django.conf import settings</font>
<font color="black">   2. </font>
<font color="green">   3. from .. import Tags, Warning, register</font>
<font color="black">   4. </font>
<font color="black">   5. </font>
<font color="green">   6. def add_session_cookie_message(message):</font>
<font color="green">   7.     return message + (</font>
<font color="green">   8.         &quot; Using a secure-only session cookie makes it more difficult for &quot;</font>
<font color="black">   9.         &quot;network traffic sniffers to hijack user sessions.&quot;</font>
<font color="black">  10.     )</font>
<font color="black">  11. </font>
<font color="green">  12. W010 = Warning(</font>
<font color="green">  13.     add_session_cookie_message(</font>
<font color="green">  14.         &quot;You have 'django.contrib.sessions' in your INSTALLED_APPS, &quot;</font>
<font color="black">  15.         &quot;but you have not set SESSION_COOKIE_SECURE to True.&quot;</font>
<font color="black">  16.     ),</font>
<font color="green">  17.     id='security.W010',</font>
<font color="black">  18. )</font>
<font color="black">  19. </font>
<font color="green">  20. W011 = Warning(</font>
<font color="green">  21.     add_session_cookie_message(</font>
<font color="green">  22.         &quot;You have 'django.contrib.sessions.middleware.SessionMiddleware' &quot;</font>
<font color="black">  23.         &quot;in your MIDDLEWARE_CLASSES, but you have not set &quot;</font>
<font color="black">  24.         &quot;SESSION_COOKIE_SECURE to True.&quot;</font>
<font color="black">  25.     ),</font>
<font color="green">  26.     id='security.W011',</font>
<font color="black">  27. )</font>
<font color="black">  28. </font>
<font color="green">  29. W012 = Warning(</font>
<font color="green">  30.     add_session_cookie_message(&quot;SESSION_COOKIE_SECURE is not set to True.&quot;),</font>
<font color="green">  31.     id='security.W012',</font>
<font color="black">  32. )</font>
<font color="black">  33. </font>
<font color="black">  34. </font>
<font color="green">  35. def add_httponly_message(message):</font>
<font color="green">  36.     return message + (</font>
<font color="green">  37.         &quot; Using an HttpOnly session cookie makes it more difficult for &quot;</font>
<font color="black">  38.         &quot;cross-site scripting attacks to hijack user sessions.&quot;</font>
<font color="black">  39.     )</font>
<font color="black">  40. </font>
<font color="black">  41. </font>
<font color="green">  42. W013 = Warning(</font>
<font color="green">  43.     add_httponly_message(</font>
<font color="green">  44.         &quot;You have 'django.contrib.sessions' in your INSTALLED_APPS, &quot;</font>
<font color="black">  45.         &quot;but you have not set SESSION_COOKIE_HTTPONLY to True.&quot;,</font>
<font color="black">  46.     ),</font>
<font color="green">  47.     id='security.W013',</font>
<font color="black">  48. )</font>
<font color="black">  49. </font>
<font color="green">  50. W014 = Warning(</font>
<font color="green">  51.     add_httponly_message(</font>
<font color="green">  52.         &quot;You have 'django.contrib.sessions.middleware.SessionMiddleware' &quot;</font>
<font color="black">  53.         &quot;in your MIDDLEWARE_CLASSES, but you have not set &quot;</font>
<font color="black">  54.         &quot;SESSION_COOKIE_HTTPONLY to True.&quot;</font>
<font color="black">  55.     ),</font>
<font color="green">  56.     id='security.W014',</font>
<font color="black">  57. )</font>
<font color="black">  58. </font>
<font color="green">  59. W015 = Warning(</font>
<font color="green">  60.     add_httponly_message(&quot;SESSION_COOKIE_HTTPONLY is not set to True.&quot;),</font>
<font color="green">  61.     id='security.W015',</font>
<font color="black">  62. )</font>
<font color="black">  63. </font>
<font color="black">  64. </font>
<font color="green">  65. @register(Tags.security, deploy=True)</font>
<font color="black">  66. def check_session_cookie_secure(app_configs, **kwargs):</font>
<font color="red">  67.     errors = []</font>
<font color="red">  68.     if not settings.SESSION_COOKIE_SECURE:</font>
<font color="red">  69.         if _session_app():</font>
<font color="red">  70.             errors.append(W010)</font>
<font color="red">  71.         if _session_middleware():</font>
<font color="red">  72.             errors.append(W011)</font>
<font color="red">  73.         if len(errors) &gt; 1:</font>
<font color="red">  74.             errors = [W012]</font>
<font color="red">  75.     return errors</font>
<font color="black">  76. </font>
<font color="black">  77. </font>
<font color="green">  78. @register(Tags.security, deploy=True)</font>
<font color="black">  79. def check_session_cookie_httponly(app_configs, **kwargs):</font>
<font color="red">  80.     errors = []</font>
<font color="red">  81.     if not settings.SESSION_COOKIE_HTTPONLY:</font>
<font color="red">  82.         if _session_app():</font>
<font color="red">  83.             errors.append(W013)</font>
<font color="red">  84.         if _session_middleware():</font>
<font color="red">  85.             errors.append(W014)</font>
<font color="red">  86.         if len(errors) &gt; 1:</font>
<font color="red">  87.             errors = [W015]</font>
<font color="red">  88.     return errors</font>
<font color="black">  89. </font>
<font color="black">  90. </font>
<font color="green">  91. def _session_middleware():</font>
<font color="red">  92.     return (&quot;django.contrib.sessions.middleware.SessionMiddleware&quot; in</font>
<font color="red">  93.             settings.MIDDLEWARE_CLASSES)</font>
<font color="black">  94. </font>
<font color="black">  95. </font>
<font color="green">  96. def _session_app():</font>
<font color="red">  97.     return &quot;django.contrib.sessions&quot; in settings.INSTALLED_APPS</font>
</pre>

