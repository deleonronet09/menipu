source file: <b>/usr/lib/python2.7/ctypes/_endian.py</b><br>


file stats: <b>37 lines, 13 executed: 35.1% covered</b>
<pre>
<font color="black">   1. ######################################################################</font>
<font color="black">   2. #  This file should be kept compatible with Python 2.3, see PEP 291. #</font>
<font color="black">   3. ######################################################################</font>
<font color="green">   4. import sys</font>
<font color="green">   5. from ctypes import *</font>
<font color="black">   6. </font>
<font color="green">   7. _array_type = type(Array)</font>
<font color="black">   8. </font>
<font color="green">   9. def _other_endian(typ):</font>
<font color="black">  10.     &quot;&quot;&quot;Return the type with the 'other' byte order.  Simple types like</font>
<font color="black">  11.     c_int and so on already have __ctype_be__ and __ctype_le__</font>
<font color="black">  12.     attributes which contain the types, for more complicated types</font>
<font color="black">  13.     arrays and structures are supported.</font>
<font color="black">  14.     &quot;&quot;&quot;</font>
<font color="black">  15.     # check _OTHER_ENDIAN attribute (present if typ is primitive type)</font>
<font color="red">  16.     if hasattr(typ, _OTHER_ENDIAN):</font>
<font color="red">  17.         return getattr(typ, _OTHER_ENDIAN)</font>
<font color="black">  18.     # if typ is array</font>
<font color="red">  19.     if isinstance(typ, _array_type):</font>
<font color="red">  20.         return _other_endian(typ._type_) * typ._length_</font>
<font color="black">  21.     # if typ is structure</font>
<font color="red">  22.     if issubclass(typ, Structure):</font>
<font color="red">  23.         return typ</font>
<font color="red">  24.     raise TypeError(&quot;This type does not support other endian: %s&quot; % typ)</font>
<font color="black">  25. </font>
<font color="green">  26. class _swapped_meta(type(Structure)):</font>
<font color="green">  27.     def __setattr__(self, attrname, value):</font>
<font color="red">  28.         if attrname == &quot;_fields_&quot;:</font>
<font color="red">  29.             fields = []</font>
<font color="red">  30.             for desc in value:</font>
<font color="red">  31.                 name = desc[0]</font>
<font color="red">  32.                 typ = desc[1]</font>
<font color="red">  33.                 rest = desc[2:]</font>
<font color="red">  34.                 fields.append((name, _other_endian(typ)) + rest)</font>
<font color="red">  35.             value = fields</font>
<font color="red">  36.         super(_swapped_meta, self).__setattr__(attrname, value)</font>
<font color="black">  37. </font>
<font color="black">  38. ################################################################</font>
<font color="black">  39. </font>
<font color="black">  40. # Note: The Structure metaclass checks for the *presence* (not the</font>
<font color="black">  41. # value!) of a _swapped_bytes_ attribute to determine the bit order in</font>
<font color="black">  42. # structures containing bit fields.</font>
<font color="black">  43. </font>
<font color="green">  44. if sys.byteorder == &quot;little&quot;:</font>
<font color="green">  45.     _OTHER_ENDIAN = &quot;__ctype_be__&quot;</font>
<font color="black">  46. </font>
<font color="green">  47.     LittleEndianStructure = Structure</font>
<font color="black">  48. </font>
<font color="green">  49.     class BigEndianStructure(Structure):</font>
<font color="green">  50.         &quot;&quot;&quot;Structure with big endian byte order&quot;&quot;&quot;</font>
<font color="green">  51.         __metaclass__ = _swapped_meta</font>
<font color="green">  52.         _swappedbytes_ = None</font>
<font color="black">  53. </font>
<font color="red">  54. elif sys.byteorder == &quot;big&quot;:</font>
<font color="red">  55.     _OTHER_ENDIAN = &quot;__ctype_le__&quot;</font>
<font color="black">  56. </font>
<font color="red">  57.     BigEndianStructure = Structure</font>
<font color="red">  58.     class LittleEndianStructure(Structure):</font>
<font color="red">  59.         &quot;&quot;&quot;Structure with little endian byte order&quot;&quot;&quot;</font>
<font color="red">  60.         __metaclass__ = _swapped_meta</font>
<font color="red">  61.         _swappedbytes_ = None</font>
<font color="black">  62. </font>
<font color="black">  63. else:</font>
<font color="red">  64.     raise RuntimeError(&quot;Invalid byteorder&quot;)</font>
</pre>

