source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/utils/termcolors.py</b><br>


file stats: <b>118 lines, 78 executed: 66.1% covered</b>
<pre>
<font color="black">   1. &quot;&quot;&quot;</font>
<font color="black">   2. termcolors.py</font>
<font color="green">   3. &quot;&quot;&quot;</font>
<font color="black">   4. </font>
<font color="green">   5. from django.utils import six</font>
<font color="black">   6. </font>
<font color="green">   7. color_names = ('black', 'red', 'green', 'yellow', 'blue', 'magenta', 'cyan', 'white')</font>
<font color="green">   8. foreground = {color_names[x]: '3%s' % x for x in range(8)}</font>
<font color="green">   9. background = {color_names[x]: '4%s' % x for x in range(8)}</font>
<font color="black">  10. </font>
<font color="green">  11. RESET = '0'</font>
<font color="green">  12. opt_dict = {'bold': '1', 'underscore': '4', 'blink': '5', 'reverse': '7', 'conceal': '8'}</font>
<font color="black">  13. </font>
<font color="black">  14. </font>
<font color="green">  15. def colorize(text='', opts=(), **kwargs):</font>
<font color="black">  16.     &quot;&quot;&quot;</font>
<font color="black">  17.     Returns your text, enclosed in ANSI graphics codes.</font>
<font color="black">  18. </font>
<font color="black">  19.     Depends on the keyword arguments 'fg' and 'bg', and the contents of</font>
<font color="black">  20.     the opts tuple/list.</font>
<font color="black">  21. </font>
<font color="black">  22.     Returns the RESET code if no parameters are given.</font>
<font color="black">  23. </font>
<font color="black">  24.     Valid colors:</font>
<font color="black">  25.         'black', 'red', 'green', 'yellow', 'blue', 'magenta', 'cyan', 'white'</font>
<font color="black">  26. </font>
<font color="black">  27.     Valid options:</font>
<font color="black">  28.         'bold'</font>
<font color="black">  29.         'underscore'</font>
<font color="black">  30.         'blink'</font>
<font color="black">  31.         'reverse'</font>
<font color="black">  32.         'conceal'</font>
<font color="black">  33.         'noreset' - string will not be auto-terminated with the RESET code</font>
<font color="black">  34. </font>
<font color="black">  35.     Examples:</font>
<font color="black">  36.         colorize('hello', fg='red', bg='blue', opts=('blink',))</font>
<font color="black">  37.         colorize()</font>
<font color="black">  38.         colorize('goodbye', opts=('underscore',))</font>
<font color="black">  39.         print(colorize('first line', fg='red', opts=('noreset',)))</font>
<font color="black">  40.         print('this should be red too')</font>
<font color="black">  41.         print(colorize('and so should this'))</font>
<font color="black">  42.         print('this should not be red')</font>
<font color="black">  43.     &quot;&quot;&quot;</font>
<font color="red">  44.     code_list = []</font>
<font color="red">  45.     if text == '' and len(opts) == 1 and opts[0] == 'reset':</font>
<font color="red">  46.         return '\x1b[%sm' % RESET</font>
<font color="red">  47.     for k, v in six.iteritems(kwargs):</font>
<font color="red">  48.         if k == 'fg':</font>
<font color="red">  49.             code_list.append(foreground[v])</font>
<font color="red">  50.         elif k == 'bg':</font>
<font color="red">  51.             code_list.append(background[v])</font>
<font color="red">  52.     for o in opts:</font>
<font color="red">  53.         if o in opt_dict:</font>
<font color="red">  54.             code_list.append(opt_dict[o])</font>
<font color="red">  55.     if 'noreset' not in opts:</font>
<font color="red">  56.         text = '%s\x1b[%sm' % (text or '', RESET)</font>
<font color="red">  57.     return '%s%s' % (('\x1b[%sm' % ';'.join(code_list)), text or '')</font>
<font color="black">  58. </font>
<font color="black">  59. </font>
<font color="green">  60. def make_style(opts=(), **kwargs):</font>
<font color="black">  61.     &quot;&quot;&quot;</font>
<font color="black">  62.     Returns a function with default parameters for colorize()</font>
<font color="black">  63. </font>
<font color="black">  64.     Example:</font>
<font color="black">  65.         bold_red = make_style(opts=('bold',), fg='red')</font>
<font color="black">  66.         print(bold_red('hello'))</font>
<font color="black">  67.         KEYWORD = make_style(fg='yellow')</font>
<font color="black">  68.         COMMENT = make_style(fg='blue', opts=('bold',))</font>
<font color="black">  69.     &quot;&quot;&quot;</font>
<font color="green">  70.     return lambda text: colorize(text, opts, **kwargs)</font>
<font color="black">  71. </font>
<font color="green">  72. NOCOLOR_PALETTE = 'nocolor'</font>
<font color="green">  73. DARK_PALETTE = 'dark'</font>
<font color="green">  74. LIGHT_PALETTE = 'light'</font>
<font color="black">  75. </font>
<font color="green">  76. PALETTES = {</font>
<font color="green">  77.     NOCOLOR_PALETTE: {</font>
<font color="green">  78.         'ERROR': {},</font>
<font color="green">  79.         'SUCCESS': {},</font>
<font color="green">  80.         'WARNING': {},</font>
<font color="green">  81.         'NOTICE': {},</font>
<font color="green">  82.         'SQL_FIELD': {},</font>
<font color="green">  83.         'SQL_COLTYPE': {},</font>
<font color="green">  84.         'SQL_KEYWORD': {},</font>
<font color="green">  85.         'SQL_TABLE': {},</font>
<font color="green">  86.         'HTTP_INFO': {},</font>
<font color="green">  87.         'HTTP_SUCCESS': {},</font>
<font color="green">  88.         'HTTP_REDIRECT': {},</font>
<font color="green">  89.         'HTTP_NOT_MODIFIED': {},</font>
<font color="green">  90.         'HTTP_BAD_REQUEST': {},</font>
<font color="green">  91.         'HTTP_NOT_FOUND': {},</font>
<font color="green">  92.         'HTTP_SERVER_ERROR': {},</font>
<font color="green">  93.         'MIGRATE_HEADING': {},</font>
<font color="green">  94.         'MIGRATE_LABEL': {},</font>
<font color="green">  95.         'MIGRATE_SUCCESS': {},</font>
<font color="green">  96.         'MIGRATE_FAILURE': {},</font>
<font color="black">  97.     },</font>
<font color="green">  98.     DARK_PALETTE: {</font>
<font color="green">  99.         'ERROR': {'fg': 'red', 'opts': ('bold',)},</font>
<font color="green"> 100.         'SUCCESS': {'fg': 'green', 'opts': ('bold',)},</font>
<font color="green"> 101.         'WARNING': {'fg': 'yellow', 'opts': ('bold',)},</font>
<font color="green"> 102.         'NOTICE': {'fg': 'red'},</font>
<font color="green"> 103.         'SQL_FIELD': {'fg': 'green', 'opts': ('bold',)},</font>
<font color="green"> 104.         'SQL_COLTYPE': {'fg': 'green'},</font>
<font color="green"> 105.         'SQL_KEYWORD': {'fg': 'yellow'},</font>
<font color="green"> 106.         'SQL_TABLE': {'opts': ('bold',)},</font>
<font color="green"> 107.         'HTTP_INFO': {'opts': ('bold',)},</font>
<font color="green"> 108.         'HTTP_SUCCESS': {},</font>
<font color="green"> 109.         'HTTP_REDIRECT': {'fg': 'green'},</font>
<font color="green"> 110.         'HTTP_NOT_MODIFIED': {'fg': 'cyan'},</font>
<font color="green"> 111.         'HTTP_BAD_REQUEST': {'fg': 'red', 'opts': ('bold',)},</font>
<font color="green"> 112.         'HTTP_NOT_FOUND': {'fg': 'yellow'},</font>
<font color="green"> 113.         'HTTP_SERVER_ERROR': {'fg': 'magenta', 'opts': ('bold',)},</font>
<font color="green"> 114.         'MIGRATE_HEADING': {'fg': 'cyan', 'opts': ('bold',)},</font>
<font color="green"> 115.         'MIGRATE_LABEL': {'opts': ('bold',)},</font>
<font color="green"> 116.         'MIGRATE_SUCCESS': {'fg': 'green', 'opts': ('bold',)},</font>
<font color="green"> 117.         'MIGRATE_FAILURE': {'fg': 'red', 'opts': ('bold',)},</font>
<font color="black"> 118.     },</font>
<font color="green"> 119.     LIGHT_PALETTE: {</font>
<font color="green"> 120.         'ERROR': {'fg': 'red', 'opts': ('bold',)},</font>
<font color="green"> 121.         'SUCCESS': {'fg': 'green', 'opts': ('bold',)},</font>
<font color="green"> 122.         'WARNING': {'fg': 'yellow', 'opts': ('bold',)},</font>
<font color="green"> 123.         'NOTICE': {'fg': 'red'},</font>
<font color="green"> 124.         'SQL_FIELD': {'fg': 'green', 'opts': ('bold',)},</font>
<font color="green"> 125.         'SQL_COLTYPE': {'fg': 'green'},</font>
<font color="green"> 126.         'SQL_KEYWORD': {'fg': 'blue'},</font>
<font color="green"> 127.         'SQL_TABLE': {'opts': ('bold',)},</font>
<font color="green"> 128.         'HTTP_INFO': {'opts': ('bold',)},</font>
<font color="green"> 129.         'HTTP_SUCCESS': {},</font>
<font color="green"> 130.         'HTTP_REDIRECT': {'fg': 'green', 'opts': ('bold',)},</font>
<font color="green"> 131.         'HTTP_NOT_MODIFIED': {'fg': 'green'},</font>
<font color="green"> 132.         'HTTP_BAD_REQUEST': {'fg': 'red', 'opts': ('bold',)},</font>
<font color="green"> 133.         'HTTP_NOT_FOUND': {'fg': 'red'},</font>
<font color="green"> 134.         'HTTP_SERVER_ERROR': {'fg': 'magenta', 'opts': ('bold',)},</font>
<font color="green"> 135.         'MIGRATE_HEADING': {'fg': 'cyan', 'opts': ('bold',)},</font>
<font color="green"> 136.         'MIGRATE_LABEL': {'opts': ('bold',)},</font>
<font color="green"> 137.         'MIGRATE_SUCCESS': {'fg': 'green', 'opts': ('bold',)},</font>
<font color="green"> 138.         'MIGRATE_FAILURE': {'fg': 'red', 'opts': ('bold',)},</font>
<font color="black"> 139.     }</font>
<font color="black"> 140. }</font>
<font color="green"> 141. DEFAULT_PALETTE = DARK_PALETTE</font>
<font color="black"> 142. </font>
<font color="black"> 143. </font>
<font color="green"> 144. def parse_color_setting(config_string):</font>
<font color="black"> 145.     &quot;&quot;&quot;Parse a DJANGO_COLORS environment variable to produce the system palette</font>
<font color="black"> 146. </font>
<font color="black"> 147.     The general form of a palette definition is:</font>
<font color="black"> 148. </font>
<font color="black"> 149.         &quot;palette;role=fg;role=fg/bg;role=fg,option,option;role=fg/bg,option,option&quot;</font>
<font color="black"> 150. </font>
<font color="black"> 151.     where:</font>
<font color="black"> 152.         palette is a named palette; one of 'light', 'dark', or 'nocolor'.</font>
<font color="black"> 153.         role is a named style used by Django</font>
<font color="black"> 154.         fg is a background color.</font>
<font color="black"> 155.         bg is a background color.</font>
<font color="black"> 156.         option is a display options.</font>
<font color="black"> 157. </font>
<font color="black"> 158.     Specifying a named palette is the same as manually specifying the individual</font>
<font color="black"> 159.     definitions for each role. Any individual definitions following the palette</font>
<font color="black"> 160.     definition will augment the base palette definition.</font>
<font color="black"> 161. </font>
<font color="black"> 162.     Valid roles:</font>
<font color="black"> 163.         'error', 'notice', 'sql_field', 'sql_coltype', 'sql_keyword', 'sql_table',</font>
<font color="black"> 164.         'http_info', 'http_success', 'http_redirect', 'http_bad_request',</font>
<font color="black"> 165.         'http_not_found', 'http_server_error'</font>
<font color="black"> 166. </font>
<font color="black"> 167.     Valid colors:</font>
<font color="black"> 168.         'black', 'red', 'green', 'yellow', 'blue', 'magenta', 'cyan', 'white'</font>
<font color="black"> 169. </font>
<font color="black"> 170.     Valid options:</font>
<font color="black"> 171.         'bold', 'underscore', 'blink', 'reverse', 'conceal'</font>
<font color="black"> 172.     &quot;&quot;&quot;</font>
<font color="green"> 173.     if not config_string:</font>
<font color="green"> 174.         return PALETTES[DEFAULT_PALETTE]</font>
<font color="black"> 175. </font>
<font color="black"> 176.     # Split the color configuration into parts</font>
<font color="red"> 177.     parts = config_string.lower().split(';')</font>
<font color="red"> 178.     palette = PALETTES[NOCOLOR_PALETTE].copy()</font>
<font color="red"> 179.     for part in parts:</font>
<font color="red"> 180.         if part in PALETTES:</font>
<font color="black"> 181.             # A default palette has been specified</font>
<font color="red"> 182.             palette.update(PALETTES[part])</font>
<font color="red"> 183.         elif '=' in part:</font>
<font color="black"> 184.             # Process a palette defining string</font>
<font color="red"> 185.             definition = {}</font>
<font color="black"> 186. </font>
<font color="black"> 187.             # Break the definition into the role,</font>
<font color="black"> 188.             # plus the list of specific instructions.</font>
<font color="black"> 189.             # The role must be in upper case</font>
<font color="red"> 190.             role, instructions = part.split('=')</font>
<font color="red"> 191.             role = role.upper()</font>
<font color="black"> 192. </font>
<font color="red"> 193.             styles = instructions.split(',')</font>
<font color="red"> 194.             styles.reverse()</font>
<font color="black"> 195. </font>
<font color="black"> 196.             # The first instruction can contain a slash</font>
<font color="black"> 197.             # to break apart fg/bg.</font>
<font color="red"> 198.             colors = styles.pop().split('/')</font>
<font color="red"> 199.             colors.reverse()</font>
<font color="red"> 200.             fg = colors.pop()</font>
<font color="red"> 201.             if fg in color_names:</font>
<font color="red"> 202.                 definition['fg'] = fg</font>
<font color="red"> 203.             if colors and colors[-1] in color_names:</font>
<font color="red"> 204.                 definition['bg'] = colors[-1]</font>
<font color="black"> 205. </font>
<font color="black"> 206.             # All remaining instructions are options</font>
<font color="red"> 207.             opts = tuple(s for s in styles if s in opt_dict.keys())</font>
<font color="red"> 208.             if opts:</font>
<font color="red"> 209.                 definition['opts'] = opts</font>
<font color="black"> 210. </font>
<font color="black"> 211.             # The nocolor palette has all available roles.</font>
<font color="black"> 212.             # Use that palette as the basis for determining</font>
<font color="black"> 213.             # if the role is valid.</font>
<font color="red"> 214.             if role in PALETTES[NOCOLOR_PALETTE] and definition:</font>
<font color="red"> 215.                 palette[role] = definition</font>
<font color="black"> 216. </font>
<font color="black"> 217.     # If there are no colors specified, return the empty palette.</font>
<font color="red"> 218.     if palette == PALETTES[NOCOLOR_PALETTE]:</font>
<font color="red"> 219.         return None</font>
<font color="red"> 220.     return palette</font>
</pre>

