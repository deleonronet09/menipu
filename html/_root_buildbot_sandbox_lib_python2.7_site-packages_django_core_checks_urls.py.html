source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/core/checks/urls.py</b><br>


file stats: <b>48 lines, 8 executed: 16.7% covered</b>
<pre>
<font color="green">   1. from __future__ import unicode_literals</font>
<font color="black">   2. </font>
<font color="green">   3. from . import Tags, Warning, register</font>
<font color="black">   4. </font>
<font color="black">   5. </font>
<font color="green">   6. @register(Tags.urls)</font>
<font color="black">   7. def check_url_config(app_configs, **kwargs):</font>
<font color="red">   8.     from django.core.urlresolvers import get_resolver</font>
<font color="red">   9.     resolver = get_resolver()</font>
<font color="red">  10.     return check_resolver(resolver)</font>
<font color="black">  11. </font>
<font color="black">  12. </font>
<font color="green">  13. def check_resolver(resolver):</font>
<font color="black">  14.     &quot;&quot;&quot;</font>
<font color="black">  15.     Recursively check the resolver.</font>
<font color="black">  16.     &quot;&quot;&quot;</font>
<font color="red">  17.     from django.core.urlresolvers import RegexURLPattern, RegexURLResolver</font>
<font color="red">  18.     warnings = []</font>
<font color="red">  19.     for pattern in resolver.url_patterns:</font>
<font color="red">  20.         if isinstance(pattern, RegexURLResolver):</font>
<font color="red">  21.             warnings.extend(check_include_trailing_dollar(pattern))</font>
<font color="black">  22.             # Check resolver recursively</font>
<font color="red">  23.             warnings.extend(check_resolver(pattern))</font>
<font color="red">  24.         elif isinstance(pattern, RegexURLPattern):</font>
<font color="red">  25.             warnings.extend(check_pattern_name(pattern))</font>
<font color="black">  26. </font>
<font color="red">  27.         warnings.extend(check_pattern_startswith_slash(pattern))</font>
<font color="black">  28. </font>
<font color="red">  29.     return warnings</font>
<font color="black">  30. </font>
<font color="black">  31. </font>
<font color="green">  32. def describe_pattern(pattern):</font>
<font color="black">  33.     &quot;&quot;&quot;</font>
<font color="black">  34.     Format the URL pattern for display in warning messages.</font>
<font color="black">  35.     &quot;&quot;&quot;</font>
<font color="red">  36.     description = &quot;'{}'&quot;.format(pattern.regex.pattern)</font>
<font color="red">  37.     if getattr(pattern, 'name', False):</font>
<font color="red">  38.         description += &quot; [name='{}']&quot;.format(pattern.name)</font>
<font color="red">  39.     return description</font>
<font color="black">  40. </font>
<font color="black">  41. </font>
<font color="green">  42. def check_include_trailing_dollar(pattern):</font>
<font color="black">  43.     &quot;&quot;&quot;</font>
<font color="black">  44.     Check that include is not used with a regex ending with a dollar.</font>
<font color="black">  45.     &quot;&quot;&quot;</font>
<font color="red">  46.     regex_pattern = pattern.regex.pattern</font>
<font color="red">  47.     if regex_pattern.endswith('$') and not regex_pattern.endswith('\$'):</font>
<font color="red">  48.         warning = Warning(</font>
<font color="red">  49.             &quot;Your URL pattern {} uses include with a regex ending with a '$'. &quot;</font>
<font color="black">  50.             &quot;Remove the dollar from the regex to avoid problems including &quot;</font>
<font color="red">  51.             &quot;URLs.&quot;.format(describe_pattern(pattern)),</font>
<font color="red">  52.             id=&quot;urls.W001&quot;,</font>
<font color="black">  53.         )</font>
<font color="red">  54.         return [warning]</font>
<font color="black">  55.     else:</font>
<font color="red">  56.         return []</font>
<font color="black">  57. </font>
<font color="black">  58. </font>
<font color="green">  59. def check_pattern_startswith_slash(pattern):</font>
<font color="black">  60.     &quot;&quot;&quot;</font>
<font color="black">  61.     Check that the pattern does not begin with a forward slash.</font>
<font color="black">  62.     &quot;&quot;&quot;</font>
<font color="red">  63.     regex_pattern = pattern.regex.pattern</font>
<font color="red">  64.     if regex_pattern.startswith('/') or regex_pattern.startswith('^/'):</font>
<font color="red">  65.         warning = Warning(</font>
<font color="red">  66.             &quot;Your URL pattern {} has a regex beginning with a '/'. &quot;</font>
<font color="red">  67.             &quot;Remove this slash as it is unnecessary.&quot;.format(describe_pattern(pattern)),</font>
<font color="red">  68.             id=&quot;urls.W002&quot;,</font>
<font color="black">  69.         )</font>
<font color="red">  70.         return [warning]</font>
<font color="black">  71.     else:</font>
<font color="red">  72.         return []</font>
<font color="black">  73. </font>
<font color="black">  74. </font>
<font color="green">  75. def check_pattern_name(pattern):</font>
<font color="black">  76.     &quot;&quot;&quot;</font>
<font color="black">  77.     Check that the pattern name does not contain a colon.</font>
<font color="black">  78.     &quot;&quot;&quot;</font>
<font color="red">  79.     if pattern.name is not None and &quot;:&quot; in pattern.name:</font>
<font color="red">  80.         warning = Warning(</font>
<font color="red">  81.             &quot;Your URL pattern {} has a name including a ':'. Remove the colon, to &quot;</font>
<font color="red">  82.             &quot;avoid ambiguous namespace references.&quot;.format(describe_pattern(pattern)),</font>
<font color="red">  83.             id=&quot;urls.W003&quot;,</font>
<font color="black">  84.         )</font>
<font color="red">  85.         return [warning]</font>
<font color="black">  86.     else:</font>
<font color="red">  87.         return []</font>
</pre>

