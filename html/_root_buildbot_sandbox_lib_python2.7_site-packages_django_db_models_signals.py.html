source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/db/models/signals.py</b><br>


file stats: <b>48 lines, 30 executed: 62.5% covered</b>
<pre>
<font color="green">   1. from django.apps import apps</font>
<font color="green">   2. from django.dispatch import Signal</font>
<font color="green">   3. from django.utils import six</font>
<font color="black">   4. </font>
<font color="black">   5. </font>
<font color="green">   6. class_prepared = Signal(providing_args=[&quot;class&quot;])</font>
<font color="black">   7. </font>
<font color="black">   8. </font>
<font color="green">   9. class ModelSignal(Signal):</font>
<font color="black">  10.     &quot;&quot;&quot;</font>
<font color="black">  11.     Signal subclass that allows the sender to be lazily specified as a string</font>
<font color="black">  12.     of the `app_label.ModelName` form.</font>
<font color="green">  13.     &quot;&quot;&quot;</font>
<font color="black">  14. </font>
<font color="green">  15.     def __init__(self, *args, **kwargs):</font>
<font color="green">  16.         super(ModelSignal, self).__init__(*args, **kwargs)</font>
<font color="green">  17.         self.unresolved_references = {}</font>
<font color="green">  18.         class_prepared.connect(self._resolve_references)</font>
<font color="black">  19. </font>
<font color="green">  20.     def _resolve_references(self, sender, **kwargs):</font>
<font color="green">  21.         opts = sender._meta</font>
<font color="green">  22.         reference = (opts.app_label, opts.object_name)</font>
<font color="green">  23.         try:</font>
<font color="green">  24.             receivers = self.unresolved_references.pop(reference)</font>
<font color="green">  25.         except KeyError:</font>
<font color="green">  26.             pass</font>
<font color="black">  27.         else:</font>
<font color="red">  28.             for receiver, weak, dispatch_uid in receivers:</font>
<font color="red">  29.                 super(ModelSignal, self).connect(</font>
<font color="red">  30.                     receiver, sender=sender, weak=weak, dispatch_uid=dispatch_uid</font>
<font color="black">  31.                 )</font>
<font color="black">  32. </font>
<font color="green">  33.     def connect(self, receiver, sender=None, weak=True, dispatch_uid=None):</font>
<font color="red">  34.         if isinstance(sender, six.string_types):</font>
<font color="red">  35.             try:</font>
<font color="red">  36.                 app_label, model_name = sender.split('.')</font>
<font color="red">  37.             except ValueError:</font>
<font color="red">  38.                 raise ValueError(</font>
<font color="red">  39.                     &quot;Specified sender must either be a model or a &quot;</font>
<font color="black">  40.                     &quot;model name of the 'app_label.ModelName' form.&quot;</font>
<font color="black">  41.                 )</font>
<font color="red">  42.             try:</font>
<font color="red">  43.                 sender = apps.get_registered_model(app_label, model_name)</font>
<font color="red">  44.             except LookupError:</font>
<font color="red">  45.                 ref = (app_label, model_name)</font>
<font color="red">  46.                 refs = self.unresolved_references.setdefault(ref, [])</font>
<font color="red">  47.                 refs.append((receiver, weak, dispatch_uid))</font>
<font color="red">  48.                 return</font>
<font color="red">  49.         super(ModelSignal, self).connect(</font>
<font color="red">  50.             receiver, sender=sender, weak=weak, dispatch_uid=dispatch_uid</font>
<font color="black">  51.         )</font>
<font color="black">  52. </font>
<font color="green">  53. pre_init = ModelSignal(providing_args=[&quot;instance&quot;, &quot;args&quot;, &quot;kwargs&quot;], use_caching=True)</font>
<font color="green">  54. post_init = ModelSignal(providing_args=[&quot;instance&quot;], use_caching=True)</font>
<font color="black">  55. </font>
<font color="green">  56. pre_save = ModelSignal(providing_args=[&quot;instance&quot;, &quot;raw&quot;, &quot;using&quot;, &quot;update_fields&quot;],</font>
<font color="green">  57.                        use_caching=True)</font>
<font color="green">  58. post_save = ModelSignal(providing_args=[&quot;instance&quot;, &quot;raw&quot;, &quot;created&quot;, &quot;using&quot;, &quot;update_fields&quot;], use_caching=True)</font>
<font color="black">  59. </font>
<font color="green">  60. pre_delete = ModelSignal(providing_args=[&quot;instance&quot;, &quot;using&quot;], use_caching=True)</font>
<font color="green">  61. post_delete = ModelSignal(providing_args=[&quot;instance&quot;, &quot;using&quot;], use_caching=True)</font>
<font color="black">  62. </font>
<font color="green">  63. m2m_changed = ModelSignal(</font>
<font color="green">  64.     providing_args=[&quot;action&quot;, &quot;instance&quot;, &quot;reverse&quot;, &quot;model&quot;, &quot;pk_set&quot;, &quot;using&quot;],</font>
<font color="green">  65.     use_caching=True,</font>
<font color="black">  66. )</font>
<font color="black">  67. </font>
<font color="green">  68. pre_migrate = Signal(providing_args=[&quot;app_config&quot;, &quot;verbosity&quot;, &quot;interactive&quot;, &quot;using&quot;])</font>
<font color="green">  69. post_migrate = Signal(providing_args=[&quot;app_config&quot;, &quot;verbosity&quot;, &quot;interactive&quot;, &quot;using&quot;])</font>
</pre>

