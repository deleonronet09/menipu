source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/utils/dateparse.py</b><br>


file stats: <b>56 lines, 19 executed: 33.9% covered</b>
<pre>
<font color="green">   1. &quot;&quot;&quot;Functions to parse datetime objects.&quot;&quot;&quot;</font>
<font color="black">   2. </font>
<font color="black">   3. # We're using regular expressions rather than time.strptime because:</font>
<font color="black">   4. # - They provide both validation and parsing.</font>
<font color="black">   5. # - They're more flexible for datetimes.</font>
<font color="black">   6. # - The date/datetime/time constructors produce friendlier error messages.</font>
<font color="black">   7. </font>
<font color="green">   8. import datetime</font>
<font color="green">   9. import re</font>
<font color="black">  10. </font>
<font color="green">  11. from django.utils import six</font>
<font color="green">  12. from django.utils.timezone import get_fixed_timezone, utc</font>
<font color="black">  13. </font>
<font color="green">  14. date_re = re.compile(</font>
<font color="green">  15.     r'(?P&lt;year&gt;\d{4})-(?P&lt;month&gt;\d{1,2})-(?P&lt;day&gt;\d{1,2})$'</font>
<font color="black">  16. )</font>
<font color="black">  17. </font>
<font color="green">  18. time_re = re.compile(</font>
<font color="green">  19.     r'(?P&lt;hour&gt;\d{1,2}):(?P&lt;minute&gt;\d{1,2})'</font>
<font color="black">  20.     r'(?::(?P&lt;second&gt;\d{1,2})(?:\.(?P&lt;microsecond&gt;\d{1,6})\d{0,6})?)?'</font>
<font color="black">  21. )</font>
<font color="black">  22. </font>
<font color="green">  23. datetime_re = re.compile(</font>
<font color="green">  24.     r'(?P&lt;year&gt;\d{4})-(?P&lt;month&gt;\d{1,2})-(?P&lt;day&gt;\d{1,2})'</font>
<font color="black">  25.     r'[T ](?P&lt;hour&gt;\d{1,2}):(?P&lt;minute&gt;\d{1,2})'</font>
<font color="black">  26.     r'(?::(?P&lt;second&gt;\d{1,2})(?:\.(?P&lt;microsecond&gt;\d{1,6})\d{0,6})?)?'</font>
<font color="black">  27.     r'(?P&lt;tzinfo&gt;Z|[+-]\d{2}(?::?\d{2})?)?$'</font>
<font color="black">  28. )</font>
<font color="black">  29. </font>
<font color="green">  30. standard_duration_re = re.compile(</font>
<font color="green">  31.     r'^'</font>
<font color="black">  32.     r'(?:(?P&lt;days&gt;-?\d+) (days?, )?)?'</font>
<font color="black">  33.     r'((?:(?P&lt;hours&gt;\d+):)(?=\d+:\d+))?'</font>
<font color="black">  34.     r'(?:(?P&lt;minutes&gt;\d+):)?'</font>
<font color="black">  35.     r'(?P&lt;seconds&gt;\d+)'</font>
<font color="black">  36.     r'(?:\.(?P&lt;microseconds&gt;\d{1,6})\d{0,6})?'</font>
<font color="black">  37.     r'$'</font>
<font color="black">  38. )</font>
<font color="black">  39. </font>
<font color="black">  40. # Support the sections of ISO 8601 date representation that are accepted by</font>
<font color="black">  41. # timedelta</font>
<font color="green">  42. iso8601_duration_re = re.compile(</font>
<font color="green">  43.     r'^P'</font>
<font color="black">  44.     r'(?:(?P&lt;days&gt;\d+(.\d+)?)D)?'</font>
<font color="black">  45.     r'(?:T'</font>
<font color="black">  46.     r'(?:(?P&lt;hours&gt;\d+(.\d+)?)H)?'</font>
<font color="black">  47.     r'(?:(?P&lt;minutes&gt;\d+(.\d+)?)M)?'</font>
<font color="black">  48.     r'(?:(?P&lt;seconds&gt;\d+(.\d+)?)S)?'</font>
<font color="black">  49.     r')?'</font>
<font color="black">  50.     r'$'</font>
<font color="black">  51. )</font>
<font color="black">  52. </font>
<font color="black">  53. </font>
<font color="green">  54. def parse_date(value):</font>
<font color="black">  55.     &quot;&quot;&quot;Parses a string and return a datetime.date.</font>
<font color="black">  56. </font>
<font color="black">  57.     Raises ValueError if the input is well formatted but not a valid date.</font>
<font color="black">  58.     Returns None if the input isn't well formatted.</font>
<font color="black">  59.     &quot;&quot;&quot;</font>
<font color="red">  60.     match = date_re.match(value)</font>
<font color="red">  61.     if match:</font>
<font color="red">  62.         kw = {k: int(v) for k, v in six.iteritems(match.groupdict())}</font>
<font color="red">  63.         return datetime.date(**kw)</font>
<font color="black">  64. </font>
<font color="black">  65. </font>
<font color="green">  66. def parse_time(value):</font>
<font color="black">  67.     &quot;&quot;&quot;Parses a string and return a datetime.time.</font>
<font color="black">  68. </font>
<font color="black">  69.     This function doesn't support time zone offsets.</font>
<font color="black">  70. </font>
<font color="black">  71.     Raises ValueError if the input is well formatted but not a valid time.</font>
<font color="black">  72.     Returns None if the input isn't well formatted, in particular if it</font>
<font color="black">  73.     contains an offset.</font>
<font color="black">  74.     &quot;&quot;&quot;</font>
<font color="red">  75.     match = time_re.match(value)</font>
<font color="red">  76.     if match:</font>
<font color="red">  77.         kw = match.groupdict()</font>
<font color="red">  78.         if kw['microsecond']:</font>
<font color="red">  79.             kw['microsecond'] = kw['microsecond'].ljust(6, '0')</font>
<font color="red">  80.         kw = {k: int(v) for k, v in six.iteritems(kw) if v is not None}</font>
<font color="red">  81.         return datetime.time(**kw)</font>
<font color="black">  82. </font>
<font color="black">  83. </font>
<font color="green">  84. def parse_datetime(value):</font>
<font color="black">  85.     &quot;&quot;&quot;Parses a string and return a datetime.datetime.</font>
<font color="black">  86. </font>
<font color="black">  87.     This function supports time zone offsets. When the input contains one,</font>
<font color="black">  88.     the output uses a timezone with a fixed offset from UTC.</font>
<font color="black">  89. </font>
<font color="black">  90.     Raises ValueError if the input is well formatted but not a valid datetime.</font>
<font color="black">  91.     Returns None if the input isn't well formatted.</font>
<font color="black">  92.     &quot;&quot;&quot;</font>
<font color="red">  93.     match = datetime_re.match(value)</font>
<font color="red">  94.     if match:</font>
<font color="red">  95.         kw = match.groupdict()</font>
<font color="red">  96.         if kw['microsecond']:</font>
<font color="red">  97.             kw['microsecond'] = kw['microsecond'].ljust(6, '0')</font>
<font color="red">  98.         tzinfo = kw.pop('tzinfo')</font>
<font color="red">  99.         if tzinfo == 'Z':</font>
<font color="red"> 100.             tzinfo = utc</font>
<font color="red"> 101.         elif tzinfo is not None:</font>
<font color="red"> 102.             offset_mins = int(tzinfo[-2:]) if len(tzinfo) &gt; 3 else 0</font>
<font color="red"> 103.             offset = 60 * int(tzinfo[1:3]) + offset_mins</font>
<font color="red"> 104.             if tzinfo[0] == '-':</font>
<font color="red"> 105.                 offset = -offset</font>
<font color="red"> 106.             tzinfo = get_fixed_timezone(offset)</font>
<font color="red"> 107.         kw = {k: int(v) for k, v in six.iteritems(kw) if v is not None}</font>
<font color="red"> 108.         kw['tzinfo'] = tzinfo</font>
<font color="red"> 109.         return datetime.datetime(**kw)</font>
<font color="black"> 110. </font>
<font color="black"> 111. </font>
<font color="green"> 112. def parse_duration(value):</font>
<font color="black"> 113.     &quot;&quot;&quot;Parses a duration string and returns a datetime.timedelta.</font>
<font color="black"> 114. </font>
<font color="black"> 115.     The preferred format for durations in Django is '%d %H:%M:%S.%f'.</font>
<font color="black"> 116. </font>
<font color="black"> 117.     Also supports ISO 8601 representation.</font>
<font color="black"> 118.     &quot;&quot;&quot;</font>
<font color="red"> 119.     match = standard_duration_re.match(value)</font>
<font color="red"> 120.     if not match:</font>
<font color="red"> 121.         match = iso8601_duration_re.match(value)</font>
<font color="red"> 122.     if match:</font>
<font color="red"> 123.         kw = match.groupdict()</font>
<font color="red"> 124.         if kw.get('microseconds'):</font>
<font color="red"> 125.             kw['microseconds'] = kw['microseconds'].ljust(6, '0')</font>
<font color="red"> 126.         kw = {k: float(v) for k, v in six.iteritems(kw) if v is not None}</font>
<font color="red"> 127.         return datetime.timedelta(**kw)</font>
</pre>

