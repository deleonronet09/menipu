source file: <b>/usr/lib/python2.7/email/iterators.py</b><br>


file stats: <b>34 lines, 10 executed: 29.4% covered</b>
<pre>
<font color="black">   1. # Copyright (C) 2001-2006 Python Software Foundation</font>
<font color="black">   2. # Author: Barry Warsaw</font>
<font color="black">   3. # Contact: email-sig@python.org</font>
<font color="black">   4. </font>
<font color="green">   5. &quot;&quot;&quot;Various types of useful iterators and generators.&quot;&quot;&quot;</font>
<font color="black">   6. </font>
<font color="black">   7. __all__ = [</font>
<font color="green">   8.     'body_line_iterator',</font>
<font color="green">   9.     'typed_subpart_iterator',</font>
<font color="green">  10.     'walk',</font>
<font color="black">  11.     # Do not include _structure() since it's part of the debugging API.</font>
<font color="black">  12.     ]</font>
<font color="black">  13. </font>
<font color="green">  14. import sys</font>
<font color="green">  15. from cStringIO import StringIO</font>
<font color="black">  16. </font>
<font color="black">  17. </font>
<font color="black">  18. </font>
<font color="black">  19. # This function will become a method of the Message class</font>
<font color="green">  20. def walk(self):</font>
<font color="black">  21.     &quot;&quot;&quot;Walk over the message tree, yielding each subpart.</font>
<font color="black">  22. </font>
<font color="black">  23.     The walk is performed in depth-first order.  This method is a</font>
<font color="black">  24.     generator.</font>
<font color="black">  25.     &quot;&quot;&quot;</font>
<font color="red">  26.     yield self</font>
<font color="red">  27.     if self.is_multipart():</font>
<font color="red">  28.         for subpart in self.get_payload():</font>
<font color="red">  29.             for subsubpart in subpart.walk():</font>
<font color="red">  30.                 yield subsubpart</font>
<font color="black">  31. </font>
<font color="black">  32. </font>
<font color="black">  33. </font>
<font color="black">  34. # These two functions are imported into the Iterators.py interface module.</font>
<font color="green">  35. def body_line_iterator(msg, decode=False):</font>
<font color="black">  36.     &quot;&quot;&quot;Iterate over the parts, returning string payloads line-by-line.</font>
<font color="black">  37. </font>
<font color="black">  38.     Optional decode (default False) is passed through to .get_payload().</font>
<font color="black">  39.     &quot;&quot;&quot;</font>
<font color="red">  40.     for subpart in msg.walk():</font>
<font color="red">  41.         payload = subpart.get_payload(decode=decode)</font>
<font color="red">  42.         if isinstance(payload, basestring):</font>
<font color="red">  43.             for line in StringIO(payload):</font>
<font color="red">  44.                 yield line</font>
<font color="black">  45. </font>
<font color="black">  46. </font>
<font color="green">  47. def typed_subpart_iterator(msg, maintype='text', subtype=None):</font>
<font color="black">  48.     &quot;&quot;&quot;Iterate over the subparts with a given MIME type.</font>
<font color="black">  49. </font>
<font color="black">  50.     Use `maintype' as the main MIME type to match against; this defaults to</font>
<font color="black">  51.     &quot;text&quot;.  Optional `subtype' is the MIME subtype to match against; if</font>
<font color="black">  52.     omitted, only the main type is matched.</font>
<font color="black">  53.     &quot;&quot;&quot;</font>
<font color="red">  54.     for subpart in msg.walk():</font>
<font color="red">  55.         if subpart.get_content_maintype() == maintype:</font>
<font color="red">  56.             if subtype is None or subpart.get_content_subtype() == subtype:</font>
<font color="red">  57.                 yield subpart</font>
<font color="black">  58. </font>
<font color="black">  59. </font>
<font color="black">  60. </font>
<font color="green">  61. def _structure(msg, fp=None, level=0, include_default=False):</font>
<font color="black">  62.     &quot;&quot;&quot;A handy debugging aid&quot;&quot;&quot;</font>
<font color="red">  63.     if fp is None:</font>
<font color="red">  64.         fp = sys.stdout</font>
<font color="red">  65.     tab = ' ' * (level * 4)</font>
<font color="red">  66.     print &gt;&gt; fp, tab + msg.get_content_type(),</font>
<font color="red">  67.     if include_default:</font>
<font color="red">  68.         print &gt;&gt; fp, '[%s]' % msg.get_default_type()</font>
<font color="black">  69.     else:</font>
<font color="red">  70.         print &gt;&gt; fp</font>
<font color="red">  71.     if msg.is_multipart():</font>
<font color="red">  72.         for subpart in msg.get_payload():</font>
<font color="red">  73.             _structure(subpart, fp, level+1, include_default)</font>
</pre>

