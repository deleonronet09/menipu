source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/contrib/admin/widgets.py</b><br>


file stats: <b>273 lines, 83 executed: 30.4% covered</b>
<pre>
<font color="black">   1. &quot;&quot;&quot;</font>
<font color="black">   2. Form Widget classes specific to the Django admin site.</font>
<font color="green">   3. &quot;&quot;&quot;</font>
<font color="green">   4. from __future__ import unicode_literals</font>
<font color="black">   5. </font>
<font color="green">   6. import copy</font>
<font color="black">   7. </font>
<font color="green">   8. from django import forms</font>
<font color="green">   9. from django.contrib.admin.templatetags.admin_static import static</font>
<font color="green">  10. from django.core.urlresolvers import reverse</font>
<font color="green">  11. from django.db.models.deletion import CASCADE</font>
<font color="green">  12. from django.forms.utils import flatatt</font>
<font color="green">  13. from django.forms.widgets import RadioFieldRenderer</font>
<font color="green">  14. from django.template.loader import render_to_string</font>
<font color="green">  15. from django.utils import six</font>
<font color="green">  16. from django.utils.encoding import force_text</font>
<font color="green">  17. from django.utils.html import (</font>
<font color="black">  18.     escape, escapejs, format_html, format_html_join, smart_urlquote,</font>
<font color="black">  19. )</font>
<font color="green">  20. from django.utils.safestring import mark_safe</font>
<font color="green">  21. from django.utils.text import Truncator</font>
<font color="green">  22. from django.utils.translation import ugettext as _</font>
<font color="black">  23. </font>
<font color="black">  24. </font>
<font color="green">  25. class FilteredSelectMultiple(forms.SelectMultiple):</font>
<font color="black">  26.     &quot;&quot;&quot;</font>
<font color="black">  27.     A SelectMultiple with a JavaScript filter interface.</font>
<font color="black">  28. </font>
<font color="black">  29.     Note that the resulting JavaScript assumes that the jsi18n</font>
<font color="black">  30.     catalog has been loaded in the page</font>
<font color="green">  31.     &quot;&quot;&quot;</font>
<font color="green">  32.     @property</font>
<font color="black">  33.     def media(self):</font>
<font color="red">  34.         js = [&quot;core.js&quot;, &quot;SelectBox.js&quot;, &quot;SelectFilter2.js&quot;]</font>
<font color="red">  35.         return forms.Media(js=[static(&quot;admin/js/%s&quot; % path) for path in js])</font>
<font color="black">  36. </font>
<font color="green">  37.     def __init__(self, verbose_name, is_stacked, attrs=None, choices=()):</font>
<font color="red">  38.         self.verbose_name = verbose_name</font>
<font color="red">  39.         self.is_stacked = is_stacked</font>
<font color="red">  40.         super(FilteredSelectMultiple, self).__init__(attrs, choices)</font>
<font color="black">  41. </font>
<font color="green">  42.     def render(self, name, value, attrs=None, choices=()):</font>
<font color="red">  43.         if attrs is None:</font>
<font color="red">  44.             attrs = {}</font>
<font color="red">  45.         attrs['class'] = 'selectfilter'</font>
<font color="red">  46.         if self.is_stacked:</font>
<font color="red">  47.             attrs['class'] += 'stacked'</font>
<font color="red">  48.         output = [super(FilteredSelectMultiple, self).render(name, value, attrs, choices)]</font>
<font color="red">  49.         output.append('&lt;script type=&quot;text/javascript&quot;&gt;addEvent(window, &quot;load&quot;, function(e) {')</font>
<font color="black">  50.         # TODO: &quot;id_&quot; is hard-coded here. This should instead use the correct</font>
<font color="black">  51.         # API to determine the ID dynamically.</font>
<font color="red">  52.         output.append('SelectFilter.init(&quot;id_%s&quot;, &quot;%s&quot;, %s); });&lt;/script&gt;\n'</font>
<font color="red">  53.             % (name, escapejs(self.verbose_name), int(self.is_stacked)))</font>
<font color="red">  54.         return mark_safe(''.join(output))</font>
<font color="black">  55. </font>
<font color="black">  56. </font>
<font color="green">  57. class AdminDateWidget(forms.DateInput):</font>
<font color="green">  58.     @property</font>
<font color="black">  59.     def media(self):</font>
<font color="red">  60.         js = [&quot;calendar.js&quot;, &quot;admin/DateTimeShortcuts.js&quot;]</font>
<font color="red">  61.         return forms.Media(js=[static(&quot;admin/js/%s&quot; % path) for path in js])</font>
<font color="black">  62. </font>
<font color="green">  63.     def __init__(self, attrs=None, format=None):</font>
<font color="red">  64.         final_attrs = {'class': 'vDateField', 'size': '10'}</font>
<font color="red">  65.         if attrs is not None:</font>
<font color="red">  66.             final_attrs.update(attrs)</font>
<font color="red">  67.         super(AdminDateWidget, self).__init__(attrs=final_attrs, format=format)</font>
<font color="black">  68. </font>
<font color="black">  69. </font>
<font color="green">  70. class AdminTimeWidget(forms.TimeInput):</font>
<font color="green">  71.     @property</font>
<font color="black">  72.     def media(self):</font>
<font color="red">  73.         js = [&quot;calendar.js&quot;, &quot;admin/DateTimeShortcuts.js&quot;]</font>
<font color="red">  74.         return forms.Media(js=[static(&quot;admin/js/%s&quot; % path) for path in js])</font>
<font color="black">  75. </font>
<font color="green">  76.     def __init__(self, attrs=None, format=None):</font>
<font color="red">  77.         final_attrs = {'class': 'vTimeField', 'size': '8'}</font>
<font color="red">  78.         if attrs is not None:</font>
<font color="red">  79.             final_attrs.update(attrs)</font>
<font color="red">  80.         super(AdminTimeWidget, self).__init__(attrs=final_attrs, format=format)</font>
<font color="black">  81. </font>
<font color="black">  82. </font>
<font color="green">  83. class AdminSplitDateTime(forms.SplitDateTimeWidget):</font>
<font color="black">  84.     &quot;&quot;&quot;</font>
<font color="black">  85.     A SplitDateTime Widget that has some admin-specific styling.</font>
<font color="green">  86.     &quot;&quot;&quot;</font>
<font color="green">  87.     def __init__(self, attrs=None):</font>
<font color="red">  88.         widgets = [AdminDateWidget, AdminTimeWidget]</font>
<font color="black">  89.         # Note that we're calling MultiWidget, not SplitDateTimeWidget, because</font>
<font color="black">  90.         # we want to define widgets.</font>
<font color="red">  91.         forms.MultiWidget.__init__(self, widgets, attrs)</font>
<font color="black">  92. </font>
<font color="green">  93.     def format_output(self, rendered_widgets):</font>
<font color="red">  94.         return format_html('&lt;p class=&quot;datetime&quot;&gt;{} {}&lt;br /&gt;{} {}&lt;/p&gt;',</font>
<font color="red">  95.                            _('Date:'), rendered_widgets[0],</font>
<font color="red">  96.                            _('Time:'), rendered_widgets[1])</font>
<font color="black">  97. </font>
<font color="black">  98. </font>
<font color="green">  99. class AdminRadioFieldRenderer(RadioFieldRenderer):</font>
<font color="green"> 100.     def render(self):</font>
<font color="black"> 101.         &quot;&quot;&quot;Outputs a &lt;ul&gt; for this set of radio fields.&quot;&quot;&quot;</font>
<font color="red"> 102.         return format_html('&lt;ul{}&gt;\n{}\n&lt;/ul&gt;',</font>
<font color="red"> 103.                            flatatt(self.attrs),</font>
<font color="red"> 104.                            format_html_join('\n', '&lt;li&gt;{}&lt;/li&gt;',</font>
<font color="red"> 105.                                             ((force_text(w),) for w in self)))</font>
<font color="black"> 106. </font>
<font color="black"> 107. </font>
<font color="green"> 108. class AdminRadioSelect(forms.RadioSelect):</font>
<font color="green"> 109.     renderer = AdminRadioFieldRenderer</font>
<font color="black"> 110. </font>
<font color="black"> 111. </font>
<font color="green"> 112. class AdminFileWidget(forms.ClearableFileInput):</font>
<font color="green"> 113.     template_with_initial = ('&lt;p class=&quot;file-upload&quot;&gt;%s&lt;/p&gt;'</font>
<font color="green"> 114.                             % forms.ClearableFileInput.template_with_initial)</font>
<font color="green"> 115.     template_with_clear = ('&lt;span class=&quot;clearable-file-input&quot;&gt;%s&lt;/span&gt;'</font>
<font color="green"> 116.                            % forms.ClearableFileInput.template_with_clear)</font>
<font color="black"> 117. </font>
<font color="black"> 118. </font>
<font color="green"> 119. def url_params_from_lookup_dict(lookups):</font>
<font color="black"> 120.     &quot;&quot;&quot;</font>
<font color="black"> 121.     Converts the type of lookups specified in a ForeignKey limit_choices_to</font>
<font color="black"> 122.     attribute to a dictionary of query parameters</font>
<font color="black"> 123.     &quot;&quot;&quot;</font>
<font color="red"> 124.     params = {}</font>
<font color="red"> 125.     if lookups and hasattr(lookups, 'items'):</font>
<font color="red"> 126.         items = []</font>
<font color="red"> 127.         for k, v in lookups.items():</font>
<font color="red"> 128.             if callable(v):</font>
<font color="red"> 129.                 v = v()</font>
<font color="red"> 130.             if isinstance(v, (tuple, list)):</font>
<font color="red"> 131.                 v = ','.join(str(x) for x in v)</font>
<font color="red"> 132.             elif isinstance(v, bool):</font>
<font color="black"> 133.                 # See django.db.fields.BooleanField.get_prep_lookup</font>
<font color="red"> 134.                 v = ('0', '1')[v]</font>
<font color="black"> 135.             else:</font>
<font color="red"> 136.                 v = six.text_type(v)</font>
<font color="red"> 137.             items.append((k, v))</font>
<font color="red"> 138.         params.update(dict(items))</font>
<font color="red"> 139.     return params</font>
<font color="black"> 140. </font>
<font color="black"> 141. </font>
<font color="green"> 142. class ForeignKeyRawIdWidget(forms.TextInput):</font>
<font color="black"> 143.     &quot;&quot;&quot;</font>
<font color="black"> 144.     A Widget for displaying ForeignKeys in the &quot;raw_id&quot; interface rather than</font>
<font color="black"> 145.     in a &lt;select&gt; box.</font>
<font color="green"> 146.     &quot;&quot;&quot;</font>
<font color="green"> 147.     def __init__(self, rel, admin_site, attrs=None, using=None):</font>
<font color="red"> 148.         self.rel = rel</font>
<font color="red"> 149.         self.admin_site = admin_site</font>
<font color="red"> 150.         self.db = using</font>
<font color="red"> 151.         super(ForeignKeyRawIdWidget, self).__init__(attrs)</font>
<font color="black"> 152. </font>
<font color="green"> 153.     def render(self, name, value, attrs=None):</font>
<font color="red"> 154.         rel_to = self.rel.model</font>
<font color="red"> 155.         if attrs is None:</font>
<font color="red"> 156.             attrs = {}</font>
<font color="red"> 157.         extra = []</font>
<font color="red"> 158.         if rel_to in self.admin_site._registry:</font>
<font color="black"> 159.             # The related object is registered with the same AdminSite</font>
<font color="red"> 160.             related_url = reverse(</font>
<font color="red"> 161.                 'admin:%s_%s_changelist' % (</font>
<font color="red"> 162.                     rel_to._meta.app_label,</font>
<font color="red"> 163.                     rel_to._meta.model_name,</font>
<font color="black"> 164.                 ),</font>
<font color="red"> 165.                 current_app=self.admin_site.name,</font>
<font color="black"> 166.             )</font>
<font color="black"> 167. </font>
<font color="red"> 168.             params = self.url_parameters()</font>
<font color="red"> 169.             if params:</font>
<font color="red"> 170.                 url = '?' + '&amp;amp;'.join('%s=%s' % (k, v) for k, v in params.items())</font>
<font color="black"> 171.             else:</font>
<font color="red"> 172.                 url = ''</font>
<font color="red"> 173.             if &quot;class&quot; not in attrs:</font>
<font color="red"> 174.                 attrs['class'] = 'vForeignKeyRawIdAdminField'  # The JavaScript code looks for this hook.</font>
<font color="black"> 175.             # TODO: &quot;lookup_id_&quot; is hard-coded here. This should instead use</font>
<font color="black"> 176.             # the correct API to determine the ID dynamically.</font>
<font color="red"> 177.             extra.append('&lt;a href=&quot;%s%s&quot; class=&quot;related-lookup&quot; id=&quot;lookup_id_%s&quot; title=&quot;%s&quot;&gt;&lt;/a&gt;' %</font>
<font color="red"> 178.                 (related_url, url, name, _('Lookup')))</font>
<font color="red"> 179.         output = [super(ForeignKeyRawIdWidget, self).render(name, value, attrs)] + extra</font>
<font color="red"> 180.         if value:</font>
<font color="red"> 181.             output.append(self.label_for_value(value))</font>
<font color="red"> 182.         return mark_safe(''.join(output))</font>
<font color="black"> 183. </font>
<font color="green"> 184.     def base_url_parameters(self):</font>
<font color="red"> 185.         limit_choices_to = self.rel.limit_choices_to</font>
<font color="red"> 186.         if callable(limit_choices_to):</font>
<font color="red"> 187.             limit_choices_to = limit_choices_to()</font>
<font color="red"> 188.         return url_params_from_lookup_dict(limit_choices_to)</font>
<font color="black"> 189. </font>
<font color="green"> 190.     def url_parameters(self):</font>
<font color="red"> 191.         from django.contrib.admin.views.main import TO_FIELD_VAR</font>
<font color="red"> 192.         params = self.base_url_parameters()</font>
<font color="red"> 193.         params.update({TO_FIELD_VAR: self.rel.get_related_field().name})</font>
<font color="red"> 194.         return params</font>
<font color="black"> 195. </font>
<font color="green"> 196.     def label_for_value(self, value):</font>
<font color="red"> 197.         key = self.rel.get_related_field().name</font>
<font color="red"> 198.         try:</font>
<font color="red"> 199.             obj = self.rel.model._default_manager.using(self.db).get(**{key: value})</font>
<font color="red"> 200.             return '&amp;nbsp;&lt;strong&gt;%s&lt;/strong&gt;' % escape(Truncator(obj).words(14, truncate='...'))</font>
<font color="red"> 201.         except (ValueError, self.rel.model.DoesNotExist):</font>
<font color="red"> 202.             return ''</font>
<font color="black"> 203. </font>
<font color="black"> 204. </font>
<font color="green"> 205. class ManyToManyRawIdWidget(ForeignKeyRawIdWidget):</font>
<font color="black"> 206.     &quot;&quot;&quot;</font>
<font color="black"> 207.     A Widget for displaying ManyToMany ids in the &quot;raw_id&quot; interface rather than</font>
<font color="black"> 208.     in a &lt;select multiple&gt; box.</font>
<font color="green"> 209.     &quot;&quot;&quot;</font>
<font color="green"> 210.     def render(self, name, value, attrs=None):</font>
<font color="red"> 211.         if attrs is None:</font>
<font color="red"> 212.             attrs = {}</font>
<font color="red"> 213.         if self.rel.model in self.admin_site._registry:</font>
<font color="black"> 214.             # The related object is registered with the same AdminSite</font>
<font color="red"> 215.             attrs['class'] = 'vManyToManyRawIdAdminField'</font>
<font color="red"> 216.         if value:</font>
<font color="red"> 217.             value = ','.join(force_text(v) for v in value)</font>
<font color="black"> 218.         else:</font>
<font color="red"> 219.             value = ''</font>
<font color="red"> 220.         return super(ManyToManyRawIdWidget, self).render(name, value, attrs)</font>
<font color="black"> 221. </font>
<font color="green"> 222.     def url_parameters(self):</font>
<font color="red"> 223.         return self.base_url_parameters()</font>
<font color="black"> 224. </font>
<font color="green"> 225.     def label_for_value(self, value):</font>
<font color="red"> 226.         return ''</font>
<font color="black"> 227. </font>
<font color="green"> 228.     def value_from_datadict(self, data, files, name):</font>
<font color="red"> 229.         value = data.get(name)</font>
<font color="red"> 230.         if value:</font>
<font color="red"> 231.             return value.split(',')</font>
<font color="black"> 232. </font>
<font color="black"> 233. </font>
<font color="green"> 234. class RelatedFieldWidgetWrapper(forms.Widget):</font>
<font color="black"> 235.     &quot;&quot;&quot;</font>
<font color="black"> 236.     This class is a wrapper to a given widget to add the add icon for the</font>
<font color="black"> 237.     admin interface.</font>
<font color="green"> 238.     &quot;&quot;&quot;</font>
<font color="green"> 239.     template = 'admin/related_widget_wrapper.html'</font>
<font color="black"> 240. </font>
<font color="green"> 241.     def __init__(self, widget, rel, admin_site, can_add_related=None,</font>
<font color="green"> 242.                  can_change_related=False, can_delete_related=False):</font>
<font color="red"> 243.         self.needs_multipart_form = widget.needs_multipart_form</font>
<font color="red"> 244.         self.attrs = widget.attrs</font>
<font color="red"> 245.         self.choices = widget.choices</font>
<font color="red"> 246.         self.widget = widget</font>
<font color="red"> 247.         self.rel = rel</font>
<font color="black"> 248.         # Backwards compatible check for whether a user can add related</font>
<font color="black"> 249.         # objects.</font>
<font color="red"> 250.         if can_add_related is None:</font>
<font color="red"> 251.             can_add_related = rel.model in admin_site._registry</font>
<font color="red"> 252.         self.can_add_related = can_add_related</font>
<font color="black"> 253.         # XXX: The UX does not support multiple selected values.</font>
<font color="red"> 254.         multiple = getattr(widget, 'allow_multiple_selected', False)</font>
<font color="red"> 255.         self.can_change_related = not multiple and can_change_related</font>
<font color="black"> 256.         # XXX: The deletion UX can be confusing when dealing with cascading deletion.</font>
<font color="red"> 257.         cascade = getattr(rel, 'on_delete', None) is CASCADE</font>
<font color="red"> 258.         self.can_delete_related = not multiple and not cascade and can_delete_related</font>
<font color="black"> 259.         # so we can check if the related object is registered with this AdminSite</font>
<font color="red"> 260.         self.admin_site = admin_site</font>
<font color="black"> 261. </font>
<font color="green"> 262.     def __deepcopy__(self, memo):</font>
<font color="red"> 263.         obj = copy.copy(self)</font>
<font color="red"> 264.         obj.widget = copy.deepcopy(self.widget, memo)</font>
<font color="red"> 265.         obj.attrs = self.widget.attrs</font>
<font color="red"> 266.         memo[id(self)] = obj</font>
<font color="red"> 267.         return obj</font>
<font color="black"> 268. </font>
<font color="green"> 269.     @property</font>
<font color="black"> 270.     def is_hidden(self):</font>
<font color="red"> 271.         return self.widget.is_hidden</font>
<font color="black"> 272. </font>
<font color="green"> 273.     @property</font>
<font color="black"> 274.     def media(self):</font>
<font color="red"> 275.         return self.widget.media</font>
<font color="black"> 276. </font>
<font color="green"> 277.     def get_related_url(self, info, action, *args):</font>
<font color="red"> 278.         return reverse(&quot;admin:%s_%s_%s&quot; % (info + (action,)),</font>
<font color="red"> 279.                        current_app=self.admin_site.name, args=args)</font>
<font color="black"> 280. </font>
<font color="green"> 281.     def render(self, name, value, *args, **kwargs):</font>
<font color="red"> 282.         from django.contrib.admin.views.main import IS_POPUP_VAR, TO_FIELD_VAR</font>
<font color="red"> 283.         rel_opts = self.rel.model._meta</font>
<font color="red"> 284.         info = (rel_opts.app_label, rel_opts.model_name)</font>
<font color="red"> 285.         self.widget.choices = self.choices</font>
<font color="red"> 286.         url_params = '&amp;'.join(&quot;%s=%s&quot; % param for param in [</font>
<font color="red"> 287.             (TO_FIELD_VAR, self.rel.get_related_field().name),</font>
<font color="red"> 288.             (IS_POPUP_VAR, 1),</font>
<font color="black"> 289.         ])</font>
<font color="red"> 290.         context = {</font>
<font color="red"> 291.             'widget': self.widget.render(name, value, *args, **kwargs),</font>
<font color="red"> 292.             'name': name,</font>
<font color="red"> 293.             'url_params': url_params,</font>
<font color="red"> 294.             'model': rel_opts.verbose_name,</font>
<font color="black"> 295.         }</font>
<font color="red"> 296.         if self.can_change_related:</font>
<font color="red"> 297.             change_related_template_url = self.get_related_url(info, 'change', '__fk__')</font>
<font color="red"> 298.             context.update(</font>
<font color="red"> 299.                 can_change_related=True,</font>
<font color="red"> 300.                 change_related_template_url=change_related_template_url,</font>
<font color="black"> 301.             )</font>
<font color="red"> 302.         if self.can_add_related:</font>
<font color="red"> 303.             add_related_url = self.get_related_url(info, 'add')</font>
<font color="red"> 304.             context.update(</font>
<font color="red"> 305.                 can_add_related=True,</font>
<font color="red"> 306.                 add_related_url=add_related_url,</font>
<font color="black"> 307.             )</font>
<font color="red"> 308.         if self.can_delete_related:</font>
<font color="red"> 309.             delete_related_template_url = self.get_related_url(info, 'delete', '__fk__')</font>
<font color="red"> 310.             context.update(</font>
<font color="red"> 311.                 can_delete_related=True,</font>
<font color="red"> 312.                 delete_related_template_url=delete_related_template_url,</font>
<font color="black"> 313.             )</font>
<font color="red"> 314.         return mark_safe(render_to_string(self.template, context))</font>
<font color="black"> 315. </font>
<font color="green"> 316.     def build_attrs(self, extra_attrs=None, **kwargs):</font>
<font color="black"> 317.         &quot;Helper function for building an attribute dictionary.&quot;</font>
<font color="red"> 318.         self.attrs = self.widget.build_attrs(extra_attrs=None, **kwargs)</font>
<font color="red"> 319.         return self.attrs</font>
<font color="black"> 320. </font>
<font color="green"> 321.     def value_from_datadict(self, data, files, name):</font>
<font color="red"> 322.         return self.widget.value_from_datadict(data, files, name)</font>
<font color="black"> 323. </font>
<font color="green"> 324.     def id_for_label(self, id_):</font>
<font color="red"> 325.         return self.widget.id_for_label(id_)</font>
<font color="black"> 326. </font>
<font color="black"> 327. </font>
<font color="green"> 328. class AdminTextareaWidget(forms.Textarea):</font>
<font color="green"> 329.     def __init__(self, attrs=None):</font>
<font color="red"> 330.         final_attrs = {'class': 'vLargeTextField'}</font>
<font color="red"> 331.         if attrs is not None:</font>
<font color="red"> 332.             final_attrs.update(attrs)</font>
<font color="red"> 333.         super(AdminTextareaWidget, self).__init__(attrs=final_attrs)</font>
<font color="black"> 334. </font>
<font color="black"> 335. </font>
<font color="green"> 336. class AdminTextInputWidget(forms.TextInput):</font>
<font color="green"> 337.     def __init__(self, attrs=None):</font>
<font color="red"> 338.         final_attrs = {'class': 'vTextField'}</font>
<font color="red"> 339.         if attrs is not None:</font>
<font color="red"> 340.             final_attrs.update(attrs)</font>
<font color="red"> 341.         super(AdminTextInputWidget, self).__init__(attrs=final_attrs)</font>
<font color="black"> 342. </font>
<font color="black"> 343. </font>
<font color="green"> 344. class AdminEmailInputWidget(forms.EmailInput):</font>
<font color="green"> 345.     def __init__(self, attrs=None):</font>
<font color="red"> 346.         final_attrs = {'class': 'vTextField'}</font>
<font color="red"> 347.         if attrs is not None:</font>
<font color="red"> 348.             final_attrs.update(attrs)</font>
<font color="red"> 349.         super(AdminEmailInputWidget, self).__init__(attrs=final_attrs)</font>
<font color="black"> 350. </font>
<font color="black"> 351. </font>
<font color="green"> 352. class AdminURLFieldWidget(forms.URLInput):</font>
<font color="green"> 353.     def __init__(self, attrs=None):</font>
<font color="red"> 354.         final_attrs = {'class': 'vURLField'}</font>
<font color="red"> 355.         if attrs is not None:</font>
<font color="red"> 356.             final_attrs.update(attrs)</font>
<font color="red"> 357.         super(AdminURLFieldWidget, self).__init__(attrs=final_attrs)</font>
<font color="black"> 358. </font>
<font color="green"> 359.     def render(self, name, value, attrs=None):</font>
<font color="red"> 360.         html = super(AdminURLFieldWidget, self).render(name, value, attrs)</font>
<font color="red"> 361.         if value:</font>
<font color="red"> 362.             value = force_text(self._format_value(value))</font>
<font color="red"> 363.             final_attrs = {'href': smart_urlquote(value)}</font>
<font color="red"> 364.             html = format_html(</font>
<font color="red"> 365.                 '&lt;p class=&quot;url&quot;&gt;{} &lt;a{}&gt;{}&lt;/a&gt;&lt;br /&gt;{} {}&lt;/p&gt;',</font>
<font color="red"> 366.                 _('Currently:'), flatatt(final_attrs), value,</font>
<font color="red"> 367.                 _('Change:'), html</font>
<font color="black"> 368.             )</font>
<font color="red"> 369.         return html</font>
<font color="black"> 370. </font>
<font color="black"> 371. </font>
<font color="green"> 372. class AdminIntegerFieldWidget(forms.TextInput):</font>
<font color="green"> 373.     class_name = 'vIntegerField'</font>
<font color="black"> 374. </font>
<font color="green"> 375.     def __init__(self, attrs=None):</font>
<font color="red"> 376.         final_attrs = {'class': self.class_name}</font>
<font color="red"> 377.         if attrs is not None:</font>
<font color="red"> 378.             final_attrs.update(attrs)</font>
<font color="red"> 379.         super(AdminIntegerFieldWidget, self).__init__(attrs=final_attrs)</font>
<font color="black"> 380. </font>
<font color="black"> 381. </font>
<font color="green"> 382. class AdminBigIntegerFieldWidget(AdminIntegerFieldWidget):</font>
<font color="green"> 383.     class_name = 'vBigIntegerField'</font>
<font color="black"> 384. </font>
<font color="black"> 385. </font>
<font color="green"> 386. class AdminCommaSeparatedIntegerFieldWidget(forms.TextInput):</font>
<font color="green"> 387.     def __init__(self, attrs=None):</font>
<font color="red"> 388.         final_attrs = {'class': 'vCommaSeparatedIntegerField'}</font>
<font color="red"> 389.         if attrs is not None:</font>
<font color="red"> 390.             final_attrs.update(attrs)</font>
<font color="red"> 391.         super(AdminCommaSeparatedIntegerFieldWidget, self).__init__(attrs=final_attrs)</font>
</pre>

