source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/views/decorators/cache.py</b><br>


file stats: <b>28 lines, 9 executed: 32.1% covered</b>
<pre>
<font color="green">   1. from functools import wraps</font>
<font color="black">   2. </font>
<font color="green">   3. from django.middleware.cache import CacheMiddleware</font>
<font color="green">   4. from django.utils.cache import add_never_cache_headers, patch_cache_control</font>
<font color="green">   5. from django.utils.decorators import (</font>
<font color="black">   6.     available_attrs, decorator_from_middleware_with_args,</font>
<font color="black">   7. )</font>
<font color="black">   8. </font>
<font color="black">   9. </font>
<font color="green">  10. def cache_page(*args, **kwargs):</font>
<font color="black">  11.     &quot;&quot;&quot;</font>
<font color="black">  12.     Decorator for views that tries getting the page from the cache and</font>
<font color="black">  13.     populates the cache if the page isn't in the cache yet.</font>
<font color="black">  14. </font>
<font color="black">  15.     The cache is keyed by the URL and some data from the headers.</font>
<font color="black">  16.     Additionally there is the key prefix that is used to distinguish different</font>
<font color="black">  17.     cache areas in a multi-site setup. You could use the</font>
<font color="black">  18.     get_current_site().domain, for example, as that is unique across a Django</font>
<font color="black">  19.     project.</font>
<font color="black">  20. </font>
<font color="black">  21.     Additionally, all headers from the response's Vary header will be taken</font>
<font color="black">  22.     into account on caching -- just like the middleware does.</font>
<font color="black">  23.     &quot;&quot;&quot;</font>
<font color="black">  24.     # We also add some asserts to give better error messages in case people are</font>
<font color="black">  25.     # using other ways to call cache_page that no longer work.</font>
<font color="red">  26.     if len(args) != 1 or callable(args[0]):</font>
<font color="red">  27.         raise TypeError(&quot;cache_page has a single mandatory positional argument: timeout&quot;)</font>
<font color="red">  28.     cache_timeout = args[0]</font>
<font color="red">  29.     cache_alias = kwargs.pop('cache', None)</font>
<font color="red">  30.     key_prefix = kwargs.pop('key_prefix', None)</font>
<font color="red">  31.     if kwargs:</font>
<font color="red">  32.         raise TypeError(&quot;cache_page has two optional keyword arguments: cache and key_prefix&quot;)</font>
<font color="black">  33. </font>
<font color="red">  34.     return decorator_from_middleware_with_args(CacheMiddleware)(</font>
<font color="red">  35.         cache_timeout=cache_timeout, cache_alias=cache_alias, key_prefix=key_prefix</font>
<font color="black">  36.     )</font>
<font color="black">  37. </font>
<font color="black">  38. </font>
<font color="green">  39. def cache_control(**kwargs):</font>
<font color="red">  40.     def _cache_controller(viewfunc):</font>
<font color="red">  41.         @wraps(viewfunc, assigned=available_attrs(viewfunc))</font>
<font color="black">  42.         def _cache_controlled(request, *args, **kw):</font>
<font color="red">  43.             response = viewfunc(request, *args, **kw)</font>
<font color="red">  44.             patch_cache_control(response, **kwargs)</font>
<font color="red">  45.             return response</font>
<font color="red">  46.         return _cache_controlled</font>
<font color="red">  47.     return _cache_controller</font>
<font color="black">  48. </font>
<font color="black">  49. </font>
<font color="green">  50. def never_cache(view_func):</font>
<font color="black">  51.     &quot;&quot;&quot;</font>
<font color="black">  52.     Decorator that adds headers to a response so that it will</font>
<font color="black">  53.     never be cached.</font>
<font color="black">  54.     &quot;&quot;&quot;</font>
<font color="green">  55.     @wraps(view_func, assigned=available_attrs(view_func))</font>
<font color="black">  56.     def _wrapped_view_func(request, *args, **kwargs):</font>
<font color="red">  57.         response = view_func(request, *args, **kwargs)</font>
<font color="red">  58.         add_never_cache_headers(response)</font>
<font color="red">  59.         return response</font>
<font color="green">  60.     return _wrapped_view_func</font>
</pre>

