source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/db/migrations/topological_sort.py</b><br>


file stats: <b>17 lines, 2 executed: 11.8% covered</b>
<pre>
<font color="green">   1. def topological_sort_as_sets(dependency_graph):</font>
<font color="black">   2.     &quot;&quot;&quot;Variation of Kahn's algorithm (1962) that returns sets.</font>
<font color="black">   3. </font>
<font color="black">   4.     Takes a dependency graph as a dictionary of node =&gt; dependencies.</font>
<font color="black">   5. </font>
<font color="black">   6.     Yields sets of items in topological order, where the first set contains</font>
<font color="black">   7.     all nodes without dependencies, and each following set contains all</font>
<font color="black">   8.     nodes that depend on the nodes in the previously yielded sets.</font>
<font color="black">   9.     &quot;&quot;&quot;</font>
<font color="red">  10.     todo = dependency_graph.copy()</font>
<font color="red">  11.     while todo:</font>
<font color="red">  12.         current = {node for node, deps in todo.items() if len(deps) == 0}</font>
<font color="black">  13. </font>
<font color="red">  14.         if not current:</font>
<font color="red">  15.             raise ValueError('Cyclic dependency in graph: {}'.format(</font>
<font color="red">  16.                 ', '.join(repr(x) for x in todo.items())))</font>
<font color="black">  17. </font>
<font color="red">  18.         yield current</font>
<font color="black">  19. </font>
<font color="black">  20.         # remove current from todo's nodes &amp; dependencies</font>
<font color="red">  21.         todo = {node: (dependencies - current) for node, dependencies in</font>
<font color="red">  22.                 todo.items() if node not in current}</font>
<font color="black">  23. </font>
<font color="black">  24. </font>
<font color="green">  25. def stable_topological_sort(l, dependency_graph):</font>
<font color="red">  26.     result = []</font>
<font color="red">  27.     for layer in topological_sort_as_sets(dependency_graph):</font>
<font color="red">  28.         for node in l:</font>
<font color="red">  29.             if node in layer:</font>
<font color="red">  30.                 result.append(node)</font>
<font color="red">  31.     return result</font>
</pre>

