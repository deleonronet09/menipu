source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/utils/numberformat.py</b><br>


file stats: <b>36 lines, 7 executed: 19.4% covered</b>
<pre>
<font color="green">   1. from __future__ import unicode_literals</font>
<font color="black">   2. </font>
<font color="green">   3. from decimal import Decimal</font>
<font color="black">   4. </font>
<font color="green">   5. from django.conf import settings</font>
<font color="green">   6. from django.utils import six</font>
<font color="green">   7. from django.utils.safestring import mark_safe</font>
<font color="black">   8. </font>
<font color="black">   9. </font>
<font color="green">  10. def format(number, decimal_sep, decimal_pos=None, grouping=0, thousand_sep='',</font>
<font color="green">  11.            force_grouping=False):</font>
<font color="black">  12.     &quot;&quot;&quot;</font>
<font color="black">  13.     Gets a number (as a number or string), and returns it as a string,</font>
<font color="black">  14.     using formats defined as arguments:</font>
<font color="black">  15. </font>
<font color="black">  16.     * decimal_sep: Decimal separator symbol (for example &quot;.&quot;)</font>
<font color="black">  17.     * decimal_pos: Number of decimal positions</font>
<font color="black">  18.     * grouping: Number of digits in every group limited by thousand separator</font>
<font color="black">  19.     * thousand_sep: Thousand separator symbol (for example &quot;,&quot;)</font>
<font color="black">  20.     &quot;&quot;&quot;</font>
<font color="red">  21.     use_grouping = settings.USE_L10N and settings.USE_THOUSAND_SEPARATOR</font>
<font color="red">  22.     use_grouping = use_grouping or force_grouping</font>
<font color="red">  23.     use_grouping = use_grouping and grouping &gt; 0</font>
<font color="black">  24.     # Make the common case fast</font>
<font color="red">  25.     if isinstance(number, int) and not use_grouping and not decimal_pos:</font>
<font color="red">  26.         return mark_safe(six.text_type(number))</font>
<font color="black">  27.     # sign</font>
<font color="red">  28.     sign = ''</font>
<font color="red">  29.     if isinstance(number, Decimal):</font>
<font color="red">  30.         str_number = '{:f}'.format(number)</font>
<font color="black">  31.     else:</font>
<font color="red">  32.         str_number = six.text_type(number)</font>
<font color="red">  33.     if str_number[0] == '-':</font>
<font color="red">  34.         sign = '-'</font>
<font color="red">  35.         str_number = str_number[1:]</font>
<font color="black">  36.     # decimal part</font>
<font color="red">  37.     if '.' in str_number:</font>
<font color="red">  38.         int_part, dec_part = str_number.split('.')</font>
<font color="red">  39.         if decimal_pos is not None:</font>
<font color="red">  40.             dec_part = dec_part[:decimal_pos]</font>
<font color="black">  41.     else:</font>
<font color="red">  42.         int_part, dec_part = str_number, ''</font>
<font color="red">  43.     if decimal_pos is not None:</font>
<font color="red">  44.         dec_part = dec_part + ('0' * (decimal_pos - len(dec_part)))</font>
<font color="red">  45.     if dec_part:</font>
<font color="red">  46.         dec_part = decimal_sep + dec_part</font>
<font color="black">  47.     # grouping</font>
<font color="red">  48.     if use_grouping:</font>
<font color="red">  49.         int_part_gd = ''</font>
<font color="red">  50.         for cnt, digit in enumerate(int_part[::-1]):</font>
<font color="red">  51.             if cnt and not cnt % grouping:</font>
<font color="red">  52.                 int_part_gd += thousand_sep[::-1]</font>
<font color="red">  53.             int_part_gd += digit</font>
<font color="red">  54.         int_part = int_part_gd[::-1]</font>
<font color="red">  55.     return sign + int_part + dec_part</font>
</pre>

