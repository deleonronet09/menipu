source file: <b>/usr/lib/python2.7/xml/sax/expatreader.py</b><br>


file stats: <b>297 lines, 63 executed: 21.2% covered</b>
<pre>
<font color="black">   1. &quot;&quot;&quot;</font>
<font color="black">   2. SAX driver for the pyexpat C module.  This driver works with</font>
<font color="black">   3. pyexpat.__version__ == '2.22'.</font>
<font color="green">   4. &quot;&quot;&quot;</font>
<font color="black">   5. </font>
<font color="green">   6. version = &quot;0.20&quot;</font>
<font color="black">   7. </font>
<font color="green">   8. from xml.sax._exceptions import *</font>
<font color="green">   9. from xml.sax.handler import feature_validation, feature_namespaces</font>
<font color="green">  10. from xml.sax.handler import feature_namespace_prefixes</font>
<font color="green">  11. from xml.sax.handler import feature_external_ges, feature_external_pes</font>
<font color="green">  12. from xml.sax.handler import feature_string_interning</font>
<font color="green">  13. from xml.sax.handler import property_xml_string, property_interning_dict</font>
<font color="black">  14. </font>
<font color="black">  15. # xml.parsers.expat does not raise ImportError in Jython</font>
<font color="green">  16. import sys</font>
<font color="green">  17. if sys.platform[:4] == &quot;java&quot;:</font>
<font color="red">  18.     raise SAXReaderNotAvailable(&quot;expat not available in Java&quot;, None)</font>
<font color="green">  19. del sys</font>
<font color="black">  20. </font>
<font color="green">  21. try:</font>
<font color="green">  22.     from xml.parsers import expat</font>
<font color="red">  23. except ImportError:</font>
<font color="red">  24.     raise SAXReaderNotAvailable(&quot;expat not supported&quot;, None)</font>
<font color="black">  25. else:</font>
<font color="green">  26.     if not hasattr(expat, &quot;ParserCreate&quot;):</font>
<font color="red">  27.         raise SAXReaderNotAvailable(&quot;expat not supported&quot;, None)</font>
<font color="green">  28. from xml.sax import xmlreader, saxutils, handler</font>
<font color="black">  29. </font>
<font color="green">  30. AttributesImpl = xmlreader.AttributesImpl</font>
<font color="green">  31. AttributesNSImpl = xmlreader.AttributesNSImpl</font>
<font color="black">  32. </font>
<font color="black">  33. # If we're using a sufficiently recent version of Python, we can use</font>
<font color="black">  34. # weak references to avoid cycles between the parser and content</font>
<font color="black">  35. # handler, otherwise we'll just have to pretend.</font>
<font color="green">  36. try:</font>
<font color="green">  37.     import _weakref</font>
<font color="red">  38. except ImportError:</font>
<font color="red">  39.     def _mkproxy(o):</font>
<font color="red">  40.         return o</font>
<font color="black">  41. else:</font>
<font color="green">  42.     import weakref</font>
<font color="green">  43.     _mkproxy = weakref.proxy</font>
<font color="green">  44.     del weakref, _weakref</font>
<font color="black">  45. </font>
<font color="black">  46. # --- ExpatLocator</font>
<font color="black">  47. </font>
<font color="green">  48. class ExpatLocator(xmlreader.Locator):</font>
<font color="black">  49.     &quot;&quot;&quot;Locator for use with the ExpatParser class.</font>
<font color="black">  50. </font>
<font color="black">  51.     This uses a weak reference to the parser object to avoid creating</font>
<font color="black">  52.     a circular reference between the parser and the content handler.</font>
<font color="green">  53.     &quot;&quot;&quot;</font>
<font color="green">  54.     def __init__(self, parser):</font>
<font color="red">  55.         self._ref = _mkproxy(parser)</font>
<font color="black">  56. </font>
<font color="green">  57.     def getColumnNumber(self):</font>
<font color="red">  58.         parser = self._ref</font>
<font color="red">  59.         if parser._parser is None:</font>
<font color="red">  60.             return None</font>
<font color="red">  61.         return parser._parser.ErrorColumnNumber</font>
<font color="black">  62. </font>
<font color="green">  63.     def getLineNumber(self):</font>
<font color="red">  64.         parser = self._ref</font>
<font color="red">  65.         if parser._parser is None:</font>
<font color="red">  66.             return 1</font>
<font color="red">  67.         return parser._parser.ErrorLineNumber</font>
<font color="black">  68. </font>
<font color="green">  69.     def getPublicId(self):</font>
<font color="red">  70.         parser = self._ref</font>
<font color="red">  71.         if parser is None:</font>
<font color="red">  72.             return None</font>
<font color="red">  73.         return parser._source.getPublicId()</font>
<font color="black">  74. </font>
<font color="green">  75.     def getSystemId(self):</font>
<font color="red">  76.         parser = self._ref</font>
<font color="red">  77.         if parser is None:</font>
<font color="red">  78.             return None</font>
<font color="red">  79.         return parser._source.getSystemId()</font>
<font color="black">  80. </font>
<font color="black">  81. </font>
<font color="black">  82. # --- ExpatParser</font>
<font color="black">  83. </font>
<font color="green">  84. class ExpatParser(xmlreader.IncrementalParser, xmlreader.Locator):</font>
<font color="green">  85.     &quot;&quot;&quot;SAX driver for the pyexpat C module.&quot;&quot;&quot;</font>
<font color="black">  86. </font>
<font color="green">  87.     def __init__(self, namespaceHandling=0, bufsize=2**16-20):</font>
<font color="red">  88.         xmlreader.IncrementalParser.__init__(self, bufsize)</font>
<font color="red">  89.         self._source = xmlreader.InputSource()</font>
<font color="red">  90.         self._parser = None</font>
<font color="red">  91.         self._namespaces = namespaceHandling</font>
<font color="red">  92.         self._lex_handler_prop = None</font>
<font color="red">  93.         self._parsing = 0</font>
<font color="red">  94.         self._entity_stack = []</font>
<font color="red">  95.         self._external_ges = 1</font>
<font color="red">  96.         self._interning = None</font>
<font color="black">  97. </font>
<font color="black">  98.     # XMLReader methods</font>
<font color="black">  99. </font>
<font color="green"> 100.     def parse(self, source):</font>
<font color="black"> 101.         &quot;Parse an XML document from a URL or an InputSource.&quot;</font>
<font color="red"> 102.         source = saxutils.prepare_input_source(source)</font>
<font color="black"> 103. </font>
<font color="red"> 104.         self._source = source</font>
<font color="red"> 105.         self.reset()</font>
<font color="red"> 106.         self._cont_handler.setDocumentLocator(ExpatLocator(self))</font>
<font color="red"> 107.         xmlreader.IncrementalParser.parse(self, source)</font>
<font color="black"> 108. </font>
<font color="green"> 109.     def prepareParser(self, source):</font>
<font color="red"> 110.         if source.getSystemId() is not None:</font>
<font color="red"> 111.             base = source.getSystemId()</font>
<font color="red"> 112.             if isinstance(base, unicode):</font>
<font color="red"> 113.                 base = base.encode('utf-8')</font>
<font color="red"> 114.             self._parser.SetBase(base)</font>
<font color="black"> 115. </font>
<font color="black"> 116.     # Redefined setContentHandler to allow changing handlers during parsing</font>
<font color="black"> 117. </font>
<font color="green"> 118.     def setContentHandler(self, handler):</font>
<font color="red"> 119.         xmlreader.IncrementalParser.setContentHandler(self, handler)</font>
<font color="red"> 120.         if self._parsing:</font>
<font color="red"> 121.             self._reset_cont_handler()</font>
<font color="black"> 122. </font>
<font color="green"> 123.     def getFeature(self, name):</font>
<font color="red"> 124.         if name == feature_namespaces:</font>
<font color="red"> 125.             return self._namespaces</font>
<font color="red"> 126.         elif name == feature_string_interning:</font>
<font color="red"> 127.             return self._interning is not None</font>
<font color="red"> 128.         elif name in (feature_validation, feature_external_pes,</font>
<font color="red"> 129.                       feature_namespace_prefixes):</font>
<font color="red"> 130.             return 0</font>
<font color="red"> 131.         elif name == feature_external_ges:</font>
<font color="red"> 132.             return self._external_ges</font>
<font color="red"> 133.         raise SAXNotRecognizedException(&quot;Feature '%s' not recognized&quot; % name)</font>
<font color="black"> 134. </font>
<font color="green"> 135.     def setFeature(self, name, state):</font>
<font color="red"> 136.         if self._parsing:</font>
<font color="red"> 137.             raise SAXNotSupportedException(&quot;Cannot set features while parsing&quot;)</font>
<font color="black"> 138. </font>
<font color="red"> 139.         if name == feature_namespaces:</font>
<font color="red"> 140.             self._namespaces = state</font>
<font color="red"> 141.         elif name == feature_external_ges:</font>
<font color="red"> 142.             self._external_ges = state</font>
<font color="red"> 143.         elif name == feature_string_interning:</font>
<font color="red"> 144.             if state:</font>
<font color="red"> 145.                 if self._interning is None:</font>
<font color="red"> 146.                     self._interning = {}</font>
<font color="black"> 147.             else:</font>
<font color="red"> 148.                 self._interning = None</font>
<font color="red"> 149.         elif name == feature_validation:</font>
<font color="red"> 150.             if state:</font>
<font color="red"> 151.                 raise SAXNotSupportedException(</font>
<font color="red"> 152.                     &quot;expat does not support validation&quot;)</font>
<font color="red"> 153.         elif name == feature_external_pes:</font>
<font color="red"> 154.             if state:</font>
<font color="red"> 155.                 raise SAXNotSupportedException(</font>
<font color="red"> 156.                     &quot;expat does not read external parameter entities&quot;)</font>
<font color="red"> 157.         elif name == feature_namespace_prefixes:</font>
<font color="red"> 158.             if state:</font>
<font color="red"> 159.                 raise SAXNotSupportedException(</font>
<font color="red"> 160.                     &quot;expat does not report namespace prefixes&quot;)</font>
<font color="black"> 161.         else:</font>
<font color="red"> 162.             raise SAXNotRecognizedException(</font>
<font color="red"> 163.                 &quot;Feature '%s' not recognized&quot; % name)</font>
<font color="black"> 164. </font>
<font color="green"> 165.     def getProperty(self, name):</font>
<font color="red"> 166.         if name == handler.property_lexical_handler:</font>
<font color="red"> 167.             return self._lex_handler_prop</font>
<font color="red"> 168.         elif name == property_interning_dict:</font>
<font color="red"> 169.             return self._interning</font>
<font color="red"> 170.         elif name == property_xml_string:</font>
<font color="red"> 171.             if self._parser:</font>
<font color="red"> 172.                 if hasattr(self._parser, &quot;GetInputContext&quot;):</font>
<font color="red"> 173.                     return self._parser.GetInputContext()</font>
<font color="black"> 174.                 else:</font>
<font color="red"> 175.                     raise SAXNotRecognizedException(</font>
<font color="red"> 176.                         &quot;This version of expat does not support getting&quot;</font>
<font color="black"> 177.                         &quot; the XML string&quot;)</font>
<font color="black"> 178.             else:</font>
<font color="red"> 179.                 raise SAXNotSupportedException(</font>
<font color="red"> 180.                     &quot;XML string cannot be returned when not parsing&quot;)</font>
<font color="red"> 181.         raise SAXNotRecognizedException(&quot;Property '%s' not recognized&quot; % name)</font>
<font color="black"> 182. </font>
<font color="green"> 183.     def setProperty(self, name, value):</font>
<font color="red"> 184.         if name == handler.property_lexical_handler:</font>
<font color="red"> 185.             self._lex_handler_prop = value</font>
<font color="red"> 186.             if self._parsing:</font>
<font color="red"> 187.                 self._reset_lex_handler_prop()</font>
<font color="red"> 188.         elif name == property_interning_dict:</font>
<font color="red"> 189.             self._interning = value</font>
<font color="red"> 190.         elif name == property_xml_string:</font>
<font color="red"> 191.             raise SAXNotSupportedException(&quot;Property '%s' cannot be set&quot; %</font>
<font color="red"> 192.                                            name)</font>
<font color="black"> 193.         else:</font>
<font color="red"> 194.             raise SAXNotRecognizedException(&quot;Property '%s' not recognized&quot; %</font>
<font color="red"> 195.                                             name)</font>
<font color="black"> 196. </font>
<font color="black"> 197.     # IncrementalParser methods</font>
<font color="black"> 198. </font>
<font color="green"> 199.     def feed(self, data, isFinal = 0):</font>
<font color="red"> 200.         if not self._parsing:</font>
<font color="red"> 201.             self.reset()</font>
<font color="red"> 202.             self._parsing = 1</font>
<font color="red"> 203.             self._cont_handler.startDocument()</font>
<font color="black"> 204. </font>
<font color="red"> 205.         try:</font>
<font color="black"> 206.             # The isFinal parameter is internal to the expat reader.</font>
<font color="black"> 207.             # If it is set to true, expat will check validity of the entire</font>
<font color="black"> 208.             # document. When feeding chunks, they are not normally final -</font>
<font color="black"> 209.             # except when invoked from close.</font>
<font color="red"> 210.             self._parser.Parse(data, isFinal)</font>
<font color="red"> 211.         except expat.error, e:</font>
<font color="red"> 212.             exc = SAXParseException(expat.ErrorString(e.code), e, self)</font>
<font color="black"> 213.             # FIXME: when to invoke error()?</font>
<font color="red"> 214.             self._err_handler.fatalError(exc)</font>
<font color="black"> 215. </font>
<font color="green"> 216.     def close(self):</font>
<font color="red"> 217.         if self._entity_stack:</font>
<font color="black"> 218.             # If we are completing an external entity, do nothing here</font>
<font color="red"> 219.             return</font>
<font color="red"> 220.         self.feed(&quot;&quot;, isFinal = 1)</font>
<font color="red"> 221.         self._cont_handler.endDocument()</font>
<font color="red"> 222.         self._parsing = 0</font>
<font color="black"> 223.         # break cycle created by expat handlers pointing to our methods</font>
<font color="red"> 224.         self._parser = None</font>
<font color="black"> 225. </font>
<font color="green"> 226.     def _reset_cont_handler(self):</font>
<font color="black"> 227.         self._parser.ProcessingInstructionHandler = \</font>
<font color="red"> 228.                                     self._cont_handler.processingInstruction</font>
<font color="red"> 229.         self._parser.CharacterDataHandler = self._cont_handler.characters</font>
<font color="black"> 230. </font>
<font color="green"> 231.     def _reset_lex_handler_prop(self):</font>
<font color="red"> 232.         lex = self._lex_handler_prop</font>
<font color="red"> 233.         parser = self._parser</font>
<font color="red"> 234.         if lex is None:</font>
<font color="red"> 235.             parser.CommentHandler = None</font>
<font color="red"> 236.             parser.StartCdataSectionHandler = None</font>
<font color="red"> 237.             parser.EndCdataSectionHandler = None</font>
<font color="red"> 238.             parser.StartDoctypeDeclHandler = None</font>
<font color="red"> 239.             parser.EndDoctypeDeclHandler = None</font>
<font color="black"> 240.         else:</font>
<font color="red"> 241.             parser.CommentHandler = lex.comment</font>
<font color="red"> 242.             parser.StartCdataSectionHandler = lex.startCDATA</font>
<font color="red"> 243.             parser.EndCdataSectionHandler = lex.endCDATA</font>
<font color="red"> 244.             parser.StartDoctypeDeclHandler = self.start_doctype_decl</font>
<font color="red"> 245.             parser.EndDoctypeDeclHandler = lex.endDTD</font>
<font color="black"> 246. </font>
<font color="green"> 247.     def reset(self):</font>
<font color="red"> 248.         if self._namespaces:</font>
<font color="red"> 249.             self._parser = expat.ParserCreate(self._source.getEncoding(), &quot; &quot;,</font>
<font color="red"> 250.                                               intern=self._interning)</font>
<font color="red"> 251.             self._parser.namespace_prefixes = 1</font>
<font color="red"> 252.             self._parser.StartElementHandler = self.start_element_ns</font>
<font color="red"> 253.             self._parser.EndElementHandler = self.end_element_ns</font>
<font color="black"> 254.         else:</font>
<font color="red"> 255.             self._parser = expat.ParserCreate(self._source.getEncoding(),</font>
<font color="red"> 256.                                               intern = self._interning)</font>
<font color="red"> 257.             self._parser.StartElementHandler = self.start_element</font>
<font color="red"> 258.             self._parser.EndElementHandler = self.end_element</font>
<font color="black"> 259. </font>
<font color="red"> 260.         self._reset_cont_handler()</font>
<font color="red"> 261.         self._parser.UnparsedEntityDeclHandler = self.unparsed_entity_decl</font>
<font color="red"> 262.         self._parser.NotationDeclHandler = self.notation_decl</font>
<font color="red"> 263.         self._parser.StartNamespaceDeclHandler = self.start_namespace_decl</font>
<font color="red"> 264.         self._parser.EndNamespaceDeclHandler = self.end_namespace_decl</font>
<font color="black"> 265. </font>
<font color="red"> 266.         self._decl_handler_prop = None</font>
<font color="red"> 267.         if self._lex_handler_prop:</font>
<font color="red"> 268.             self._reset_lex_handler_prop()</font>
<font color="black"> 269. #         self._parser.DefaultHandler =</font>
<font color="black"> 270. #         self._parser.DefaultHandlerExpand =</font>
<font color="black"> 271. #         self._parser.NotStandaloneHandler =</font>
<font color="red"> 272.         self._parser.ExternalEntityRefHandler = self.external_entity_ref</font>
<font color="red"> 273.         try:</font>
<font color="red"> 274.             self._parser.SkippedEntityHandler = self.skipped_entity_handler</font>
<font color="red"> 275.         except AttributeError:</font>
<font color="black"> 276.             # This pyexpat does not support SkippedEntity</font>
<font color="red"> 277.             pass</font>
<font color="red"> 278.         self._parser.SetParamEntityParsing(</font>
<font color="red"> 279.             expat.XML_PARAM_ENTITY_PARSING_UNLESS_STANDALONE)</font>
<font color="black"> 280. </font>
<font color="red"> 281.         self._parsing = 0</font>
<font color="red"> 282.         self._entity_stack = []</font>
<font color="black"> 283. </font>
<font color="black"> 284.     # Locator methods</font>
<font color="black"> 285. </font>
<font color="green"> 286.     def getColumnNumber(self):</font>
<font color="red"> 287.         if self._parser is None:</font>
<font color="red"> 288.             return None</font>
<font color="red"> 289.         return self._parser.ErrorColumnNumber</font>
<font color="black"> 290. </font>
<font color="green"> 291.     def getLineNumber(self):</font>
<font color="red"> 292.         if self._parser is None:</font>
<font color="red"> 293.             return 1</font>
<font color="red"> 294.         return self._parser.ErrorLineNumber</font>
<font color="black"> 295. </font>
<font color="green"> 296.     def getPublicId(self):</font>
<font color="red"> 297.         return self._source.getPublicId()</font>
<font color="black"> 298. </font>
<font color="green"> 299.     def getSystemId(self):</font>
<font color="red"> 300.         return self._source.getSystemId()</font>
<font color="black"> 301. </font>
<font color="black"> 302.     # event handlers</font>
<font color="green"> 303.     def start_element(self, name, attrs):</font>
<font color="red"> 304.         self._cont_handler.startElement(name, AttributesImpl(attrs))</font>
<font color="black"> 305. </font>
<font color="green"> 306.     def end_element(self, name):</font>
<font color="red"> 307.         self._cont_handler.endElement(name)</font>
<font color="black"> 308. </font>
<font color="green"> 309.     def start_element_ns(self, name, attrs):</font>
<font color="red"> 310.         pair = name.split()</font>
<font color="red"> 311.         if len(pair) == 1:</font>
<font color="black"> 312.             # no namespace</font>
<font color="red"> 313.             pair = (None, name)</font>
<font color="red"> 314.         elif len(pair) == 3:</font>
<font color="red"> 315.             pair = pair[0], pair[1]</font>
<font color="black"> 316.         else:</font>
<font color="black"> 317.             # default namespace</font>
<font color="red"> 318.             pair = tuple(pair)</font>
<font color="black"> 319. </font>
<font color="red"> 320.         newattrs = {}</font>
<font color="red"> 321.         qnames = {}</font>
<font color="red"> 322.         for (aname, value) in attrs.items():</font>
<font color="red"> 323.             parts = aname.split()</font>
<font color="red"> 324.             length = len(parts)</font>
<font color="red"> 325.             if length == 1:</font>
<font color="black"> 326.                 # no namespace</font>
<font color="red"> 327.                 qname = aname</font>
<font color="red"> 328.                 apair = (None, aname)</font>
<font color="red"> 329.             elif length == 3:</font>
<font color="red"> 330.                 qname = &quot;%s:%s&quot; % (parts[2], parts[1])</font>
<font color="red"> 331.                 apair = parts[0], parts[1]</font>
<font color="black"> 332.             else:</font>
<font color="black"> 333.                 # default namespace</font>
<font color="red"> 334.                 qname = parts[1]</font>
<font color="red"> 335.                 apair = tuple(parts)</font>
<font color="black"> 336. </font>
<font color="red"> 337.             newattrs[apair] = value</font>
<font color="red"> 338.             qnames[apair] = qname</font>
<font color="black"> 339. </font>
<font color="red"> 340.         self._cont_handler.startElementNS(pair, None,</font>
<font color="red"> 341.                                           AttributesNSImpl(newattrs, qnames))</font>
<font color="black"> 342. </font>
<font color="green"> 343.     def end_element_ns(self, name):</font>
<font color="red"> 344.         pair = name.split()</font>
<font color="red"> 345.         if len(pair) == 1:</font>
<font color="red"> 346.             pair = (None, name)</font>
<font color="red"> 347.         elif len(pair) == 3:</font>
<font color="red"> 348.             pair = pair[0], pair[1]</font>
<font color="black"> 349.         else:</font>
<font color="red"> 350.             pair = tuple(pair)</font>
<font color="black"> 351. </font>
<font color="red"> 352.         self._cont_handler.endElementNS(pair, None)</font>
<font color="black"> 353. </font>
<font color="black"> 354.     # this is not used (call directly to ContentHandler)</font>
<font color="green"> 355.     def processing_instruction(self, target, data):</font>
<font color="red"> 356.         self._cont_handler.processingInstruction(target, data)</font>
<font color="black"> 357. </font>
<font color="black"> 358.     # this is not used (call directly to ContentHandler)</font>
<font color="green"> 359.     def character_data(self, data):</font>
<font color="red"> 360.         self._cont_handler.characters(data)</font>
<font color="black"> 361. </font>
<font color="green"> 362.     def start_namespace_decl(self, prefix, uri):</font>
<font color="red"> 363.         self._cont_handler.startPrefixMapping(prefix, uri)</font>
<font color="black"> 364. </font>
<font color="green"> 365.     def end_namespace_decl(self, prefix):</font>
<font color="red"> 366.         self._cont_handler.endPrefixMapping(prefix)</font>
<font color="black"> 367. </font>
<font color="green"> 368.     def start_doctype_decl(self, name, sysid, pubid, has_internal_subset):</font>
<font color="red"> 369.         self._lex_handler_prop.startDTD(name, pubid, sysid)</font>
<font color="black"> 370. </font>
<font color="green"> 371.     def unparsed_entity_decl(self, name, base, sysid, pubid, notation_name):</font>
<font color="red"> 372.         self._dtd_handler.unparsedEntityDecl(name, pubid, sysid, notation_name)</font>
<font color="black"> 373. </font>
<font color="green"> 374.     def notation_decl(self, name, base, sysid, pubid):</font>
<font color="red"> 375.         self._dtd_handler.notationDecl(name, pubid, sysid)</font>
<font color="black"> 376. </font>
<font color="green"> 377.     def external_entity_ref(self, context, base, sysid, pubid):</font>
<font color="red"> 378.         if not self._external_ges:</font>
<font color="red"> 379.             return 1</font>
<font color="black"> 380. </font>
<font color="red"> 381.         source = self._ent_handler.resolveEntity(pubid, sysid)</font>
<font color="red"> 382.         source = saxutils.prepare_input_source(source,</font>
<font color="red"> 383.                                                self._source.getSystemId() or</font>
<font color="red"> 384.                                                &quot;&quot;)</font>
<font color="black"> 385. </font>
<font color="red"> 386.         self._entity_stack.append((self._parser, self._source))</font>
<font color="red"> 387.         self._parser = self._parser.ExternalEntityParserCreate(context)</font>
<font color="red"> 388.         self._source = source</font>
<font color="black"> 389. </font>
<font color="red"> 390.         try:</font>
<font color="red"> 391.             xmlreader.IncrementalParser.parse(self, source)</font>
<font color="red"> 392.         except:</font>
<font color="red"> 393.             return 0  # FIXME: save error info here?</font>
<font color="black"> 394. </font>
<font color="red"> 395.         (self._parser, self._source) = self._entity_stack[-1]</font>
<font color="red"> 396.         del self._entity_stack[-1]</font>
<font color="red"> 397.         return 1</font>
<font color="black"> 398. </font>
<font color="green"> 399.     def skipped_entity_handler(self, name, is_pe):</font>
<font color="red"> 400.         if is_pe:</font>
<font color="black"> 401.             # The SAX spec requires to report skipped PEs with a '%'</font>
<font color="red"> 402.             name = '%'+name</font>
<font color="red"> 403.         self._cont_handler.skippedEntity(name)</font>
<font color="black"> 404. </font>
<font color="black"> 405. # ---</font>
<font color="black"> 406. </font>
<font color="green"> 407. def create_parser(*args, **kwargs):</font>
<font color="red"> 408.     return ExpatParser(*args, **kwargs)</font>
<font color="black"> 409. </font>
<font color="black"> 410. # ---</font>
<font color="black"> 411. </font>
<font color="green"> 412. if __name__ == &quot;__main__&quot;:</font>
<font color="red"> 413.     import xml.sax.saxutils</font>
<font color="red"> 414.     p = create_parser()</font>
<font color="red"> 415.     p.setContentHandler(xml.sax.saxutils.XMLGenerator())</font>
<font color="red"> 416.     p.setErrorHandler(xml.sax.ErrorHandler())</font>
<font color="red"> 417.     p.parse(&quot;http://www.ibiblio.org/xml/examples/shakespeare/hamlet.xml&quot;)</font>
</pre>

