source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/contrib/admin/checks.py</b><br>


file stats: <b>582 lines, 216 executed: 37.1% covered</b>
<pre>
<font color="black">   1. # -*- coding: utf-8 -*-</font>
<font color="green">   2. from __future__ import unicode_literals</font>
<font color="black">   3. </font>
<font color="green">   4. from itertools import chain</font>
<font color="black">   5. </font>
<font color="green">   6. from django.contrib.admin.utils import (</font>
<font color="black">   7.     NotRelationField, flatten, get_fields_from_path,</font>
<font color="black">   8. )</font>
<font color="green">   9. from django.core import checks</font>
<font color="green">  10. from django.core.exceptions import FieldDoesNotExist</font>
<font color="green">  11. from django.db import models</font>
<font color="green">  12. from django.forms.models import (</font>
<font color="black">  13.     BaseModelForm, BaseModelFormSet, _get_foreign_key,</font>
<font color="black">  14. )</font>
<font color="black">  15. </font>
<font color="black">  16. </font>
<font color="green">  17. def check_admin_app(**kwargs):</font>
<font color="red">  18.     from django.contrib.admin.sites import system_check_errors</font>
<font color="black">  19. </font>
<font color="red">  20.     return system_check_errors</font>
<font color="black">  21. </font>
<font color="black">  22. </font>
<font color="green">  23. class BaseModelAdminChecks(object):</font>
<font color="black">  24. </font>
<font color="green">  25.     def check(self, admin_obj, **kwargs):</font>
<font color="green">  26.         errors = []</font>
<font color="green">  27.         errors.extend(self._check_raw_id_fields(admin_obj))</font>
<font color="green">  28.         errors.extend(self._check_fields(admin_obj))</font>
<font color="green">  29.         errors.extend(self._check_fieldsets(admin_obj))</font>
<font color="green">  30.         errors.extend(self._check_exclude(admin_obj))</font>
<font color="green">  31.         errors.extend(self._check_form(admin_obj))</font>
<font color="green">  32.         errors.extend(self._check_filter_vertical(admin_obj))</font>
<font color="green">  33.         errors.extend(self._check_filter_horizontal(admin_obj))</font>
<font color="green">  34.         errors.extend(self._check_radio_fields(admin_obj))</font>
<font color="green">  35.         errors.extend(self._check_prepopulated_fields(admin_obj))</font>
<font color="green">  36.         errors.extend(self._check_view_on_site_url(admin_obj))</font>
<font color="green">  37.         errors.extend(self._check_ordering(admin_obj))</font>
<font color="green">  38.         errors.extend(self._check_readonly_fields(admin_obj))</font>
<font color="green">  39.         return errors</font>
<font color="black">  40. </font>
<font color="green">  41.     def _check_raw_id_fields(self, obj):</font>
<font color="black">  42.         &quot;&quot;&quot; Check that `raw_id_fields` only contains field names that are listed</font>
<font color="black">  43.         on the model. &quot;&quot;&quot;</font>
<font color="black">  44. </font>
<font color="green">  45.         if not isinstance(obj.raw_id_fields, (list, tuple)):</font>
<font color="red">  46.             return must_be('a list or tuple', option='raw_id_fields', obj=obj, id='admin.E001')</font>
<font color="black">  47.         else:</font>
<font color="green">  48.             return list(chain(*[</font>
<font color="green">  49.                 self._check_raw_id_fields_item(obj, obj.model, field_name, 'raw_id_fields[%d]' % index)</font>
<font color="green">  50.                 for index, field_name in enumerate(obj.raw_id_fields)</font>
<font color="black">  51.             ]))</font>
<font color="black">  52. </font>
<font color="green">  53.     def _check_raw_id_fields_item(self, obj, model, field_name, label):</font>
<font color="black">  54.         &quot;&quot;&quot; Check an item of `raw_id_fields`, i.e. check that field named</font>
<font color="black">  55.         `field_name` exists in model `model` and is a ForeignKey or a</font>
<font color="black">  56.         ManyToManyField. &quot;&quot;&quot;</font>
<font color="black">  57. </font>
<font color="red">  58.         try:</font>
<font color="red">  59.             field = model._meta.get_field(field_name)</font>
<font color="red">  60.         except FieldDoesNotExist:</font>
<font color="red">  61.             return refer_to_missing_field(field=field_name, option=label,</font>
<font color="red">  62.                                           model=model, obj=obj, id='admin.E002')</font>
<font color="black">  63.         else:</font>
<font color="red">  64.             if not isinstance(field, (models.ForeignKey, models.ManyToManyField)):</font>
<font color="red">  65.                 return must_be('a ForeignKey or ManyToManyField',</font>
<font color="red">  66.                                option=label, obj=obj, id='admin.E003')</font>
<font color="black">  67.             else:</font>
<font color="red">  68.                 return []</font>
<font color="black">  69. </font>
<font color="green">  70.     def _check_fields(self, obj):</font>
<font color="black">  71.         &quot;&quot;&quot; Check that `fields` only refer to existing fields, doesn't contain</font>
<font color="black">  72.         duplicates. Check if at most one of `fields` and `fieldsets` is defined.</font>
<font color="black">  73.         &quot;&quot;&quot;</font>
<font color="black">  74. </font>
<font color="green">  75.         if obj.fields is None:</font>
<font color="green">  76.             return []</font>
<font color="red">  77.         elif not isinstance(obj.fields, (list, tuple)):</font>
<font color="red">  78.             return must_be('a list or tuple', option='fields', obj=obj, id='admin.E004')</font>
<font color="red">  79.         elif obj.fieldsets:</font>
<font color="black">  80.             return [</font>
<font color="red">  81.                 checks.Error(</font>
<font color="red">  82.                     &quot;Both 'fieldsets' and 'fields' are specified.&quot;,</font>
<font color="red">  83.                     hint=None,</font>
<font color="red">  84.                     obj=obj.__class__,</font>
<font color="red">  85.                     id='admin.E005',</font>
<font color="black">  86.                 )</font>
<font color="black">  87.             ]</font>
<font color="red">  88.         fields = flatten(obj.fields)</font>
<font color="red">  89.         if len(fields) != len(set(fields)):</font>
<font color="black">  90.             return [</font>
<font color="red">  91.                 checks.Error(</font>
<font color="red">  92.                     &quot;The value of 'fields' contains duplicate field(s).&quot;,</font>
<font color="red">  93.                     hint=None,</font>
<font color="red">  94.                     obj=obj.__class__,</font>
<font color="red">  95.                     id='admin.E006',</font>
<font color="black">  96.                 )</font>
<font color="black">  97.             ]</font>
<font color="black">  98. </font>
<font color="red">  99.         return list(chain(*[</font>
<font color="red"> 100.             self._check_field_spec(obj, obj.model, field_name, 'fields')</font>
<font color="red"> 101.             for field_name in obj.fields</font>
<font color="black"> 102.         ]))</font>
<font color="black"> 103. </font>
<font color="green"> 104.     def _check_fieldsets(self, obj):</font>
<font color="black"> 105.         &quot;&quot;&quot; Check that fieldsets is properly formatted and doesn't contain</font>
<font color="black"> 106.         duplicates. &quot;&quot;&quot;</font>
<font color="black"> 107. </font>
<font color="green"> 108.         if obj.fieldsets is None:</font>
<font color="green"> 109.             return []</font>
<font color="green"> 110.         elif not isinstance(obj.fieldsets, (list, tuple)):</font>
<font color="red"> 111.             return must_be('a list or tuple', option='fieldsets', obj=obj, id='admin.E007')</font>
<font color="black"> 112.         else:</font>
<font color="green"> 113.             return list(chain(*[</font>
<font color="green"> 114.                 self._check_fieldsets_item(obj, obj.model, fieldset, 'fieldsets[%d]' % index)</font>
<font color="green"> 115.                 for index, fieldset in enumerate(obj.fieldsets)</font>
<font color="black"> 116.             ]))</font>
<font color="black"> 117. </font>
<font color="green"> 118.     def _check_fieldsets_item(self, obj, model, fieldset, label):</font>
<font color="black"> 119.         &quot;&quot;&quot; Check an item of `fieldsets`, i.e. check that this is a pair of a</font>
<font color="black"> 120.         set name and a dictionary containing &quot;fields&quot; key. &quot;&quot;&quot;</font>
<font color="black"> 121. </font>
<font color="green"> 122.         if not isinstance(fieldset, (list, tuple)):</font>
<font color="red"> 123.             return must_be('a list or tuple', option=label, obj=obj, id='admin.E008')</font>
<font color="green"> 124.         elif len(fieldset) != 2:</font>
<font color="red"> 125.             return must_be('of length 2', option=label, obj=obj, id='admin.E009')</font>
<font color="green"> 126.         elif not isinstance(fieldset[1], dict):</font>
<font color="red"> 127.             return must_be('a dictionary', option='%s[1]' % label, obj=obj, id='admin.E010')</font>
<font color="green"> 128.         elif 'fields' not in fieldset[1]:</font>
<font color="black"> 129.             return [</font>
<font color="red"> 130.                 checks.Error(</font>
<font color="red"> 131.                     &quot;The value of '%s[1]' must contain the key 'fields'.&quot; % label,</font>
<font color="red"> 132.                     hint=None,</font>
<font color="red"> 133.                     obj=obj.__class__,</font>
<font color="red"> 134.                     id='admin.E011',</font>
<font color="black"> 135.                 )</font>
<font color="black"> 136.             ]</font>
<font color="green"> 137.         elif not isinstance(fieldset[1]['fields'], (list, tuple)):</font>
<font color="red"> 138.             return must_be('a list or tuple', option=&quot;%s[1]['fields']&quot; % label, obj=obj, id='admin.E008')</font>
<font color="black"> 139. </font>
<font color="green"> 140.         fields = flatten(fieldset[1]['fields'])</font>
<font color="green"> 141.         if len(fields) != len(set(fields)):</font>
<font color="black"> 142.             return [</font>
<font color="red"> 143.                 checks.Error(</font>
<font color="red"> 144.                     &quot;There are duplicate field(s) in '%s[1]'.&quot; % label,</font>
<font color="red"> 145.                     hint=None,</font>
<font color="red"> 146.                     obj=obj.__class__,</font>
<font color="red"> 147.                     id='admin.E012',</font>
<font color="black"> 148.                 )</font>
<font color="black"> 149.             ]</font>
<font color="green"> 150.         return list(chain(*[</font>
<font color="green"> 151.             self._check_field_spec(obj, model, fieldset_fields, '%s[1][&quot;fields&quot;]' % label)</font>
<font color="green"> 152.             for fieldset_fields in fieldset[1]['fields']</font>
<font color="black"> 153.         ]))</font>
<font color="black"> 154. </font>
<font color="green"> 155.     def _check_field_spec(self, obj, model, fields, label):</font>
<font color="black"> 156.         &quot;&quot;&quot; `fields` should be an item of `fields` or an item of</font>
<font color="black"> 157.         fieldset[1]['fields'] for any `fieldset` in `fieldsets`. It should be a</font>
<font color="black"> 158.         field name or a tuple of field names. &quot;&quot;&quot;</font>
<font color="black"> 159. </font>
<font color="green"> 160.         if isinstance(fields, tuple):</font>
<font color="red"> 161.             return list(chain(*[</font>
<font color="red"> 162.                 self._check_field_spec_item(obj, model, field_name, &quot;%s[%d]&quot; % (label, index))</font>
<font color="red"> 163.                 for index, field_name in enumerate(fields)</font>
<font color="black"> 164.             ]))</font>
<font color="black"> 165.         else:</font>
<font color="green"> 166.             return self._check_field_spec_item(obj, model, fields, label)</font>
<font color="black"> 167. </font>
<font color="green"> 168.     def _check_field_spec_item(self, obj, model, field_name, label):</font>
<font color="green"> 169.         if field_name in obj.readonly_fields:</font>
<font color="black"> 170.             # Stuff can be put in fields that isn't actually a model field if</font>
<font color="black"> 171.             # it's in readonly_fields, readonly_fields will handle the</font>
<font color="black"> 172.             # validation of such things.</font>
<font color="red"> 173.             return []</font>
<font color="black"> 174.         else:</font>
<font color="green"> 175.             try:</font>
<font color="green"> 176.                 field = model._meta.get_field(field_name)</font>
<font color="red"> 177.             except FieldDoesNotExist:</font>
<font color="black"> 178.                 # If we can't find a field on the model that matches, it could</font>
<font color="black"> 179.                 # be an extra field on the form.</font>
<font color="red"> 180.                 return []</font>
<font color="black"> 181.             else:</font>
<font color="green"> 182.                 if (isinstance(field, models.ManyToManyField) and</font>
<font color="green"> 183.                         not field.remote_field.through._meta.auto_created):</font>
<font color="black"> 184.                     return [</font>
<font color="red"> 185.                         checks.Error(</font>
<font color="red"> 186.                             (&quot;The value of '%s' cannot include the ManyToManyField '%s', &quot;</font>
<font color="black"> 187.                              &quot;because that field manually specifies a relationship model.&quot;)</font>
<font color="red"> 188.                             % (label, field_name),</font>
<font color="red"> 189.                             hint=None,</font>
<font color="red"> 190.                             obj=obj.__class__,</font>
<font color="red"> 191.                             id='admin.E013',</font>
<font color="black"> 192.                         )</font>
<font color="black"> 193.                     ]</font>
<font color="black"> 194.                 else:</font>
<font color="green"> 195.                     return []</font>
<font color="black"> 196. </font>
<font color="green"> 197.     def _check_exclude(self, obj):</font>
<font color="black"> 198.         &quot;&quot;&quot; Check that exclude is a sequence without duplicates. &quot;&quot;&quot;</font>
<font color="black"> 199. </font>
<font color="green"> 200.         if obj.exclude is None:  # default value is None</font>
<font color="green"> 201.             return []</font>
<font color="red"> 202.         elif not isinstance(obj.exclude, (list, tuple)):</font>
<font color="red"> 203.             return must_be('a list or tuple', option='exclude', obj=obj, id='admin.E014')</font>
<font color="red"> 204.         elif len(obj.exclude) &gt; len(set(obj.exclude)):</font>
<font color="black"> 205.             return [</font>
<font color="red"> 206.                 checks.Error(</font>
<font color="red"> 207.                     &quot;The value of 'exclude' contains duplicate field(s).&quot;,</font>
<font color="red"> 208.                     hint=None,</font>
<font color="red"> 209.                     obj=obj.__class__,</font>
<font color="red"> 210.                     id='admin.E015',</font>
<font color="black"> 211.                 )</font>
<font color="black"> 212.             ]</font>
<font color="black"> 213.         else:</font>
<font color="red"> 214.             return []</font>
<font color="black"> 215. </font>
<font color="green"> 216.     def _check_form(self, obj):</font>
<font color="black"> 217.         &quot;&quot;&quot; Check that form subclasses BaseModelForm. &quot;&quot;&quot;</font>
<font color="black"> 218. </font>
<font color="green"> 219.         if hasattr(obj, 'form') and not issubclass(obj.form, BaseModelForm):</font>
<font color="red"> 220.             return must_inherit_from(parent='BaseModelForm', option='form',</font>
<font color="red"> 221.                                      obj=obj, id='admin.E016')</font>
<font color="black"> 222.         else:</font>
<font color="green"> 223.             return []</font>
<font color="black"> 224. </font>
<font color="green"> 225.     def _check_filter_vertical(self, obj):</font>
<font color="black"> 226.         &quot;&quot;&quot; Check that filter_vertical is a sequence of field names. &quot;&quot;&quot;</font>
<font color="black"> 227. </font>
<font color="green"> 228.         if not hasattr(obj, 'filter_vertical'):</font>
<font color="red"> 229.             return []</font>
<font color="green"> 230.         elif not isinstance(obj.filter_vertical, (list, tuple)):</font>
<font color="red"> 231.             return must_be('a list or tuple', option='filter_vertical', obj=obj, id='admin.E017')</font>
<font color="black"> 232.         else:</font>
<font color="green"> 233.             return list(chain(*[</font>
<font color="green"> 234.                 self._check_filter_item(obj, obj.model, field_name, &quot;filter_vertical[%d]&quot; % index)</font>
<font color="green"> 235.                 for index, field_name in enumerate(obj.filter_vertical)</font>
<font color="black"> 236.             ]))</font>
<font color="black"> 237. </font>
<font color="green"> 238.     def _check_filter_horizontal(self, obj):</font>
<font color="black"> 239.         &quot;&quot;&quot; Check that filter_horizontal is a sequence of field names. &quot;&quot;&quot;</font>
<font color="black"> 240. </font>
<font color="green"> 241.         if not hasattr(obj, 'filter_horizontal'):</font>
<font color="red"> 242.             return []</font>
<font color="green"> 243.         elif not isinstance(obj.filter_horizontal, (list, tuple)):</font>
<font color="red"> 244.             return must_be('a list or tuple', option='filter_horizontal', obj=obj, id='admin.E018')</font>
<font color="black"> 245.         else:</font>
<font color="green"> 246.             return list(chain(*[</font>
<font color="green"> 247.                 self._check_filter_item(obj, obj.model, field_name, &quot;filter_horizontal[%d]&quot; % index)</font>
<font color="green"> 248.                 for index, field_name in enumerate(obj.filter_horizontal)</font>
<font color="black"> 249.             ]))</font>
<font color="black"> 250. </font>
<font color="green"> 251.     def _check_filter_item(self, obj, model, field_name, label):</font>
<font color="black"> 252.         &quot;&quot;&quot; Check one item of `filter_vertical` or `filter_horizontal`, i.e.</font>
<font color="black"> 253.         check that given field exists and is a ManyToManyField. &quot;&quot;&quot;</font>
<font color="black"> 254. </font>
<font color="green"> 255.         try:</font>
<font color="green"> 256.             field = model._meta.get_field(field_name)</font>
<font color="red"> 257.         except FieldDoesNotExist:</font>
<font color="red"> 258.             return refer_to_missing_field(field=field_name, option=label,</font>
<font color="red"> 259.                                           model=model, obj=obj, id='admin.E019')</font>
<font color="black"> 260.         else:</font>
<font color="green"> 261.             if not isinstance(field, models.ManyToManyField):</font>
<font color="red"> 262.                 return must_be('a ManyToManyField', option=label, obj=obj, id='admin.E020')</font>
<font color="black"> 263.             else:</font>
<font color="green"> 264.                 return []</font>
<font color="black"> 265. </font>
<font color="green"> 266.     def _check_radio_fields(self, obj):</font>
<font color="black"> 267.         &quot;&quot;&quot; Check that `radio_fields` is a dictionary. &quot;&quot;&quot;</font>
<font color="black"> 268. </font>
<font color="green"> 269.         if not hasattr(obj, 'radio_fields'):</font>
<font color="red"> 270.             return []</font>
<font color="green"> 271.         elif not isinstance(obj.radio_fields, dict):</font>
<font color="red"> 272.             return must_be('a dictionary', option='radio_fields', obj=obj, id='admin.E021')</font>
<font color="black"> 273.         else:</font>
<font color="green"> 274.             return list(chain(*[</font>
<font color="green"> 275.                 self._check_radio_fields_key(obj, obj.model, field_name, 'radio_fields') +</font>
<font color="black"> 276.                 self._check_radio_fields_value(obj, val, 'radio_fields[&quot;%s&quot;]' % field_name)</font>
<font color="green"> 277.                 for field_name, val in obj.radio_fields.items()</font>
<font color="black"> 278.             ]))</font>
<font color="black"> 279. </font>
<font color="green"> 280.     def _check_radio_fields_key(self, obj, model, field_name, label):</font>
<font color="black"> 281.         &quot;&quot;&quot; Check that a key of `radio_fields` dictionary is name of existing</font>
<font color="black"> 282.         field and that the field is a ForeignKey or has `choices` defined. &quot;&quot;&quot;</font>
<font color="black"> 283. </font>
<font color="red"> 284.         try:</font>
<font color="red"> 285.             field = model._meta.get_field(field_name)</font>
<font color="red"> 286.         except FieldDoesNotExist:</font>
<font color="red"> 287.             return refer_to_missing_field(field=field_name, option=label,</font>
<font color="red"> 288.                                           model=model, obj=obj, id='admin.E022')</font>
<font color="black"> 289.         else:</font>
<font color="red"> 290.             if not (isinstance(field, models.ForeignKey) or field.choices):</font>
<font color="black"> 291.                 return [</font>
<font color="red"> 292.                     checks.Error(</font>
<font color="red"> 293.                         &quot;The value of '%s' refers to '%s', which is not an &quot;</font>
<font color="black"> 294.                         &quot;instance of ForeignKey, and does not have a 'choices' definition.&quot; % (</font>
<font color="red"> 295.                             label, field_name</font>
<font color="black"> 296.                         ),</font>
<font color="red"> 297.                         hint=None,</font>
<font color="red"> 298.                         obj=obj.__class__,</font>
<font color="red"> 299.                         id='admin.E023',</font>
<font color="black"> 300.                     )</font>
<font color="black"> 301.                 ]</font>
<font color="black"> 302.             else:</font>
<font color="red"> 303.                 return []</font>
<font color="black"> 304. </font>
<font color="green"> 305.     def _check_radio_fields_value(self, obj, val, label):</font>
<font color="black"> 306.         &quot;&quot;&quot; Check type of a value of `radio_fields` dictionary. &quot;&quot;&quot;</font>
<font color="black"> 307. </font>
<font color="red"> 308.         from django.contrib.admin.options import HORIZONTAL, VERTICAL</font>
<font color="black"> 309. </font>
<font color="red"> 310.         if val not in (HORIZONTAL, VERTICAL):</font>
<font color="black"> 311.             return [</font>
<font color="red"> 312.                 checks.Error(</font>
<font color="red"> 313.                     &quot;The value of '%s' must be either admin.HORIZONTAL or admin.VERTICAL.&quot; % label,</font>
<font color="red"> 314.                     hint=None,</font>
<font color="red"> 315.                     obj=obj.__class__,</font>
<font color="red"> 316.                     id='admin.E024',</font>
<font color="black"> 317.                 )</font>
<font color="black"> 318.             ]</font>
<font color="black"> 319.         else:</font>
<font color="red"> 320.             return []</font>
<font color="black"> 321. </font>
<font color="green"> 322.     def _check_view_on_site_url(self, obj):</font>
<font color="green"> 323.         if hasattr(obj, 'view_on_site'):</font>
<font color="green"> 324.             if not callable(obj.view_on_site) and not isinstance(obj.view_on_site, bool):</font>
<font color="black"> 325.                 return [</font>
<font color="red"> 326.                     checks.Error(</font>
<font color="red"> 327.                         &quot;The value of 'view_on_site' must be a callable or a boolean value.&quot;,</font>
<font color="red"> 328.                         hint=None,</font>
<font color="red"> 329.                         obj=obj.__class__,</font>
<font color="red"> 330.                         id='admin.E025',</font>
<font color="black"> 331.                     )</font>
<font color="black"> 332.                 ]</font>
<font color="black"> 333.             else:</font>
<font color="green"> 334.                 return []</font>
<font color="black"> 335.         else:</font>
<font color="red"> 336.             return []</font>
<font color="black"> 337. </font>
<font color="green"> 338.     def _check_prepopulated_fields(self, obj):</font>
<font color="black"> 339.         &quot;&quot;&quot; Check that `prepopulated_fields` is a dictionary containing allowed</font>
<font color="black"> 340.         field types. &quot;&quot;&quot;</font>
<font color="black"> 341. </font>
<font color="green"> 342.         if not hasattr(obj, 'prepopulated_fields'):</font>
<font color="red"> 343.             return []</font>
<font color="green"> 344.         elif not isinstance(obj.prepopulated_fields, dict):</font>
<font color="red"> 345.             return must_be('a dictionary', option='prepopulated_fields', obj=obj, id='admin.E026')</font>
<font color="black"> 346.         else:</font>
<font color="green"> 347.             return list(chain(*[</font>
<font color="green"> 348.                 self._check_prepopulated_fields_key(obj, obj.model, field_name, 'prepopulated_fields') +</font>
<font color="black"> 349.                 self._check_prepopulated_fields_value(obj, obj.model, val, 'prepopulated_fields[&quot;%s&quot;]' % field_name)</font>
<font color="green"> 350.                 for field_name, val in obj.prepopulated_fields.items()</font>
<font color="black"> 351.             ]))</font>
<font color="black"> 352. </font>
<font color="green"> 353.     def _check_prepopulated_fields_key(self, obj, model, field_name, label):</font>
<font color="black"> 354.         &quot;&quot;&quot; Check a key of `prepopulated_fields` dictionary, i.e. check that it</font>
<font color="black"> 355.         is a name of existing field and the field is one of the allowed types.</font>
<font color="black"> 356.         &quot;&quot;&quot;</font>
<font color="black"> 357. </font>
<font color="black"> 358.         forbidden_field_types = (</font>
<font color="red"> 359.             models.DateTimeField,</font>
<font color="red"> 360.             models.ForeignKey,</font>
<font color="red"> 361.             models.ManyToManyField</font>
<font color="black"> 362.         )</font>
<font color="black"> 363. </font>
<font color="red"> 364.         try:</font>
<font color="red"> 365.             field = model._meta.get_field(field_name)</font>
<font color="red"> 366.         except FieldDoesNotExist:</font>
<font color="red"> 367.             return refer_to_missing_field(field=field_name, option=label,</font>
<font color="red"> 368.                                           model=model, obj=obj, id='admin.E027')</font>
<font color="black"> 369.         else:</font>
<font color="red"> 370.             if isinstance(field, forbidden_field_types):</font>
<font color="black"> 371.                 return [</font>
<font color="red"> 372.                     checks.Error(</font>
<font color="red"> 373.                         &quot;The value of '%s' refers to '%s', which must not be a DateTimeField, &quot;</font>
<font color="black"> 374.                         &quot;ForeignKey or ManyToManyField.&quot; % (</font>
<font color="red"> 375.                             label, field_name</font>
<font color="black"> 376.                         ),</font>
<font color="red"> 377.                         hint=None,</font>
<font color="red"> 378.                         obj=obj.__class__,</font>
<font color="red"> 379.                         id='admin.E028',</font>
<font color="black"> 380.                     )</font>
<font color="black"> 381.                 ]</font>
<font color="black"> 382.             else:</font>
<font color="red"> 383.                 return []</font>
<font color="black"> 384. </font>
<font color="green"> 385.     def _check_prepopulated_fields_value(self, obj, model, val, label):</font>
<font color="black"> 386.         &quot;&quot;&quot; Check a value of `prepopulated_fields` dictionary, i.e. it's an</font>
<font color="black"> 387.         iterable of existing fields. &quot;&quot;&quot;</font>
<font color="black"> 388. </font>
<font color="red"> 389.         if not isinstance(val, (list, tuple)):</font>
<font color="red"> 390.             return must_be('a list or tuple', option=label, obj=obj, id='admin.E029')</font>
<font color="black"> 391.         else:</font>
<font color="red"> 392.             return list(chain(*[</font>
<font color="red"> 393.                 self._check_prepopulated_fields_value_item(obj, model, subfield_name, &quot;%s[%r]&quot; % (label, index))</font>
<font color="red"> 394.                 for index, subfield_name in enumerate(val)</font>
<font color="black"> 395.             ]))</font>
<font color="black"> 396. </font>
<font color="green"> 397.     def _check_prepopulated_fields_value_item(self, obj, model, field_name, label):</font>
<font color="black"> 398.         &quot;&quot;&quot; For `prepopulated_fields` equal to {&quot;slug&quot;: (&quot;title&quot;,)},</font>
<font color="black"> 399.         `field_name` is &quot;title&quot;. &quot;&quot;&quot;</font>
<font color="black"> 400. </font>
<font color="red"> 401.         try:</font>
<font color="red"> 402.             model._meta.get_field(field_name)</font>
<font color="red"> 403.         except FieldDoesNotExist:</font>
<font color="red"> 404.             return refer_to_missing_field(field=field_name, option=label,</font>
<font color="red"> 405.                                           model=model, obj=obj, id='admin.E030')</font>
<font color="black"> 406.         else:</font>
<font color="red"> 407.             return []</font>
<font color="black"> 408. </font>
<font color="green"> 409.     def _check_ordering(self, obj):</font>
<font color="black"> 410.         &quot;&quot;&quot; Check that ordering refers to existing fields or is random. &quot;&quot;&quot;</font>
<font color="black"> 411. </font>
<font color="black"> 412.         # ordering = None</font>
<font color="green"> 413.         if obj.ordering is None:  # The default value is None</font>
<font color="red"> 414.             return []</font>
<font color="green"> 415.         elif not isinstance(obj.ordering, (list, tuple)):</font>
<font color="red"> 416.             return must_be('a list or tuple', option='ordering', obj=obj, id='admin.E031')</font>
<font color="black"> 417.         else:</font>
<font color="green"> 418.             return list(chain(*[</font>
<font color="green"> 419.                 self._check_ordering_item(obj, obj.model, field_name, 'ordering[%d]' % index)</font>
<font color="green"> 420.                 for index, field_name in enumerate(obj.ordering)</font>
<font color="black"> 421.             ]))</font>
<font color="black"> 422. </font>
<font color="green"> 423.     def _check_ordering_item(self, obj, model, field_name, label):</font>
<font color="black"> 424.         &quot;&quot;&quot; Check that `ordering` refers to existing fields. &quot;&quot;&quot;</font>
<font color="black"> 425. </font>
<font color="green"> 426.         if field_name == '?' and len(obj.ordering) != 1:</font>
<font color="black"> 427.             return [</font>
<font color="red"> 428.                 checks.Error(</font>
<font color="red"> 429.                     (&quot;The value of 'ordering' has the random ordering marker '?', &quot;</font>
<font color="black"> 430.                      &quot;but contains other fields as well.&quot;),</font>
<font color="red"> 431.                     hint='Either remove the &quot;?&quot;, or remove the other fields.',</font>
<font color="red"> 432.                     obj=obj.__class__,</font>
<font color="red"> 433.                     id='admin.E032',</font>
<font color="black"> 434.                 )</font>
<font color="black"> 435.             ]</font>
<font color="green"> 436.         elif field_name == '?':</font>
<font color="red"> 437.             return []</font>
<font color="green"> 438.         elif '__' in field_name:</font>
<font color="black"> 439.             # Skip ordering in the format field1__field2 (FIXME: checking</font>
<font color="black"> 440.             # this format would be nice, but it's a little fiddly).</font>
<font color="red"> 441.             return []</font>
<font color="black"> 442.         else:</font>
<font color="green"> 443.             if field_name.startswith('-'):</font>
<font color="red"> 444.                 field_name = field_name[1:]</font>
<font color="black"> 445. </font>
<font color="green"> 446.             try:</font>
<font color="green"> 447.                 model._meta.get_field(field_name)</font>
<font color="red"> 448.             except FieldDoesNotExist:</font>
<font color="red"> 449.                 return refer_to_missing_field(field=field_name, option=label,</font>
<font color="red"> 450.                                               model=model, obj=obj, id='admin.E033')</font>
<font color="black"> 451.             else:</font>
<font color="green"> 452.                 return []</font>
<font color="black"> 453. </font>
<font color="green"> 454.     def _check_readonly_fields(self, obj):</font>
<font color="black"> 455.         &quot;&quot;&quot; Check that readonly_fields refers to proper attribute or field. &quot;&quot;&quot;</font>
<font color="black"> 456. </font>
<font color="green"> 457.         if obj.readonly_fields == ():</font>
<font color="green"> 458.             return []</font>
<font color="red"> 459.         elif not isinstance(obj.readonly_fields, (list, tuple)):</font>
<font color="red"> 460.             return must_be('a list or tuple', option='readonly_fields', obj=obj, id='admin.E034')</font>
<font color="black"> 461.         else:</font>
<font color="red"> 462.             return list(chain(*[</font>
<font color="red"> 463.                 self._check_readonly_fields_item(obj, obj.model, field_name, &quot;readonly_fields[%d]&quot; % index)</font>
<font color="red"> 464.                 for index, field_name in enumerate(obj.readonly_fields)</font>
<font color="black"> 465.             ]))</font>
<font color="black"> 466. </font>
<font color="green"> 467.     def _check_readonly_fields_item(self, obj, model, field_name, label):</font>
<font color="red"> 468.         if callable(field_name):</font>
<font color="red"> 469.             return []</font>
<font color="red"> 470.         elif hasattr(obj, field_name):</font>
<font color="red"> 471.             return []</font>
<font color="red"> 472.         elif hasattr(model, field_name):</font>
<font color="red"> 473.             return []</font>
<font color="black"> 474.         else:</font>
<font color="red"> 475.             try:</font>
<font color="red"> 476.                 model._meta.get_field(field_name)</font>
<font color="red"> 477.             except FieldDoesNotExist:</font>
<font color="black"> 478.                 return [</font>
<font color="red"> 479.                     checks.Error(</font>
<font color="red"> 480.                         &quot;The value of '%s' is not a callable, an attribute of '%s', or an attribute of '%s.%s'.&quot; % (</font>
<font color="red"> 481.                             label, obj.__class__.__name__, model._meta.app_label, model._meta.object_name</font>
<font color="black"> 482.                         ),</font>
<font color="red"> 483.                         hint=None,</font>
<font color="red"> 484.                         obj=obj.__class__,</font>
<font color="red"> 485.                         id='admin.E035',</font>
<font color="black"> 486.                     )</font>
<font color="black"> 487.                 ]</font>
<font color="black"> 488.             else:</font>
<font color="red"> 489.                 return []</font>
<font color="black"> 490. </font>
<font color="black"> 491. </font>
<font color="green"> 492. class ModelAdminChecks(BaseModelAdminChecks):</font>
<font color="black"> 493. </font>
<font color="green"> 494.     def check(self, admin_obj, **kwargs):</font>
<font color="green"> 495.         errors = super(ModelAdminChecks, self).check(admin_obj)</font>
<font color="green"> 496.         errors.extend(self._check_save_as(admin_obj))</font>
<font color="green"> 497.         errors.extend(self._check_save_on_top(admin_obj))</font>
<font color="green"> 498.         errors.extend(self._check_inlines(admin_obj))</font>
<font color="green"> 499.         errors.extend(self._check_list_display(admin_obj))</font>
<font color="green"> 500.         errors.extend(self._check_list_display_links(admin_obj))</font>
<font color="green"> 501.         errors.extend(self._check_list_filter(admin_obj))</font>
<font color="green"> 502.         errors.extend(self._check_list_select_related(admin_obj))</font>
<font color="green"> 503.         errors.extend(self._check_list_per_page(admin_obj))</font>
<font color="green"> 504.         errors.extend(self._check_list_max_show_all(admin_obj))</font>
<font color="green"> 505.         errors.extend(self._check_list_editable(admin_obj))</font>
<font color="green"> 506.         errors.extend(self._check_search_fields(admin_obj))</font>
<font color="green"> 507.         errors.extend(self._check_date_hierarchy(admin_obj))</font>
<font color="green"> 508.         return errors</font>
<font color="black"> 509. </font>
<font color="green"> 510.     def _check_save_as(self, obj):</font>
<font color="black"> 511.         &quot;&quot;&quot; Check save_as is a boolean. &quot;&quot;&quot;</font>
<font color="black"> 512. </font>
<font color="green"> 513.         if not isinstance(obj.save_as, bool):</font>
<font color="red"> 514.             return must_be('a boolean', option='save_as',</font>
<font color="red"> 515.                            obj=obj, id='admin.E101')</font>
<font color="black"> 516.         else:</font>
<font color="green"> 517.             return []</font>
<font color="black"> 518. </font>
<font color="green"> 519.     def _check_save_on_top(self, obj):</font>
<font color="black"> 520.         &quot;&quot;&quot; Check save_on_top is a boolean. &quot;&quot;&quot;</font>
<font color="black"> 521. </font>
<font color="green"> 522.         if not isinstance(obj.save_on_top, bool):</font>
<font color="red"> 523.             return must_be('a boolean', option='save_on_top',</font>
<font color="red"> 524.                            obj=obj, id='admin.E102')</font>
<font color="black"> 525.         else:</font>
<font color="green"> 526.             return []</font>
<font color="black"> 527. </font>
<font color="green"> 528.     def _check_inlines(self, obj):</font>
<font color="black"> 529.         &quot;&quot;&quot; Check all inline model admin classes. &quot;&quot;&quot;</font>
<font color="black"> 530. </font>
<font color="green"> 531.         if not isinstance(obj.inlines, (list, tuple)):</font>
<font color="red"> 532.             return must_be('a list or tuple', option='inlines', obj=obj, id='admin.E103')</font>
<font color="black"> 533.         else:</font>
<font color="green"> 534.             return list(chain(*[</font>
<font color="green"> 535.                 self._check_inlines_item(obj, obj.model, item, &quot;inlines[%d]&quot; % index)</font>
<font color="green"> 536.                 for index, item in enumerate(obj.inlines)</font>
<font color="black"> 537.             ]))</font>
<font color="black"> 538. </font>
<font color="green"> 539.     def _check_inlines_item(self, obj, model, inline, label):</font>
<font color="black"> 540.         &quot;&quot;&quot; Check one inline model admin. &quot;&quot;&quot;</font>
<font color="red"> 541.         inline_label = '.'.join([inline.__module__, inline.__name__])</font>
<font color="black"> 542. </font>
<font color="red"> 543.         from django.contrib.admin.options import BaseModelAdmin</font>
<font color="black"> 544. </font>
<font color="red"> 545.         if not issubclass(inline, BaseModelAdmin):</font>
<font color="black"> 546.             return [</font>
<font color="red"> 547.                 checks.Error(</font>
<font color="red"> 548.                     &quot;'%s' must inherit from 'BaseModelAdmin'.&quot; % inline_label,</font>
<font color="red"> 549.                     hint=None,</font>
<font color="red"> 550.                     obj=obj.__class__,</font>
<font color="red"> 551.                     id='admin.E104',</font>
<font color="black"> 552.                 )</font>
<font color="black"> 553.             ]</font>
<font color="red"> 554.         elif not inline.model:</font>
<font color="black"> 555.             return [</font>
<font color="red"> 556.                 checks.Error(</font>
<font color="red"> 557.                     &quot;'%s' must have a 'model' attribute.&quot; % inline_label,</font>
<font color="red"> 558.                     hint=None,</font>
<font color="red"> 559.                     obj=obj.__class__,</font>
<font color="red"> 560.                     id='admin.E105',</font>
<font color="black"> 561.                 )</font>
<font color="black"> 562.             ]</font>
<font color="red"> 563.         elif not issubclass(inline.model, models.Model):</font>
<font color="red"> 564.             return must_be('a Model', option='%s.model' % inline_label,</font>
<font color="red"> 565.                            obj=obj, id='admin.E106')</font>
<font color="black"> 566.         else:</font>
<font color="red"> 567.             return inline(model, obj.admin_site).check()</font>
<font color="black"> 568. </font>
<font color="green"> 569.     def _check_list_display(self, obj):</font>
<font color="black"> 570.         &quot;&quot;&quot; Check that list_display only contains fields or usable attributes.</font>
<font color="black"> 571.         &quot;&quot;&quot;</font>
<font color="black"> 572. </font>
<font color="green"> 573.         if not isinstance(obj.list_display, (list, tuple)):</font>
<font color="red"> 574.             return must_be('a list or tuple', option='list_display', obj=obj, id='admin.E107')</font>
<font color="black"> 575.         else:</font>
<font color="green"> 576.             return list(chain(*[</font>
<font color="green"> 577.                 self._check_list_display_item(obj, obj.model, item, &quot;list_display[%d]&quot; % index)</font>
<font color="green"> 578.                 for index, item in enumerate(obj.list_display)</font>
<font color="black"> 579.             ]))</font>
<font color="black"> 580. </font>
<font color="green"> 581.     def _check_list_display_item(self, obj, model, item, label):</font>
<font color="green"> 582.         if callable(item):</font>
<font color="red"> 583.             return []</font>
<font color="green"> 584.         elif hasattr(obj, item):</font>
<font color="green"> 585.             return []</font>
<font color="green"> 586.         elif hasattr(model, item):</font>
<font color="black"> 587.             # getattr(model, item) could be an X_RelatedObjectsDescriptor</font>
<font color="red"> 588.             try:</font>
<font color="red"> 589.                 field = model._meta.get_field(item)</font>
<font color="red"> 590.             except FieldDoesNotExist:</font>
<font color="red"> 591.                 try:</font>
<font color="red"> 592.                     field = getattr(model, item)</font>
<font color="red"> 593.                 except AttributeError:</font>
<font color="red"> 594.                     field = None</font>
<font color="black"> 595. </font>
<font color="red"> 596.             if field is None:</font>
<font color="black"> 597.                 return [</font>
<font color="red"> 598.                     checks.Error(</font>
<font color="red"> 599.                         &quot;The value of '%s' refers to '%s', which is not a &quot;</font>
<font color="black"> 600.                         &quot;callable, an attribute of '%s', or an attribute or method on '%s.%s'.&quot; % (</font>
<font color="red"> 601.                             label, item, obj.__class__.__name__, model._meta.app_label, model._meta.object_name</font>
<font color="black"> 602.                         ),</font>
<font color="red"> 603.                         hint=None,</font>
<font color="red"> 604.                         obj=obj.__class__,</font>
<font color="red"> 605.                         id='admin.E108',</font>
<font color="black"> 606.                     )</font>
<font color="black"> 607.                 ]</font>
<font color="red"> 608.             elif isinstance(field, models.ManyToManyField):</font>
<font color="black"> 609.                 return [</font>
<font color="red"> 610.                     checks.Error(</font>
<font color="red"> 611.                         &quot;The value of '%s' must not be a ManyToManyField.&quot; % label,</font>
<font color="red"> 612.                         hint=None,</font>
<font color="red"> 613.                         obj=obj.__class__,</font>
<font color="red"> 614.                         id='admin.E109',</font>
<font color="black"> 615.                     )</font>
<font color="black"> 616.                 ]</font>
<font color="black"> 617.             else:</font>
<font color="red"> 618.                 return []</font>
<font color="black"> 619.         else:</font>
<font color="green"> 620.             try:</font>
<font color="green"> 621.                 model._meta.get_field(item)</font>
<font color="red"> 622.             except FieldDoesNotExist:</font>
<font color="black"> 623.                 return [</font>
<font color="black"> 624.                     # This is a deliberate repeat of E108; there's more than one path</font>
<font color="black"> 625.                     # required to test this condition.</font>
<font color="red"> 626.                     checks.Error(</font>
<font color="red"> 627.                         &quot;The value of '%s' refers to '%s', which is not a callable, &quot;</font>
<font color="black"> 628.                         &quot;an attribute of '%s', or an attribute or method on '%s.%s'.&quot; % (</font>
<font color="red"> 629.                             label, item, obj.__class__.__name__, model._meta.app_label, model._meta.object_name</font>
<font color="black"> 630.                         ),</font>
<font color="red"> 631.                         hint=None,</font>
<font color="red"> 632.                         obj=obj.__class__,</font>
<font color="red"> 633.                         id='admin.E108',</font>
<font color="black"> 634.                     )</font>
<font color="black"> 635.                 ]</font>
<font color="black"> 636.             else:</font>
<font color="green"> 637.                 return []</font>
<font color="black"> 638. </font>
<font color="green"> 639.     def _check_list_display_links(self, obj):</font>
<font color="black"> 640.         &quot;&quot;&quot; Check that list_display_links is a unique subset of list_display.</font>
<font color="black"> 641.         &quot;&quot;&quot;</font>
<font color="black"> 642. </font>
<font color="green"> 643.         if obj.list_display_links is None:</font>
<font color="red"> 644.             return []</font>
<font color="green"> 645.         elif not isinstance(obj.list_display_links, (list, tuple)):</font>
<font color="red"> 646.             return must_be('a list, a tuple, or None', option='list_display_links', obj=obj, id='admin.E110')</font>
<font color="black"> 647.         else:</font>
<font color="green"> 648.             return list(chain(*[</font>
<font color="green"> 649.                 self._check_list_display_links_item(obj, field_name, &quot;list_display_links[%d]&quot; % index)</font>
<font color="green"> 650.                 for index, field_name in enumerate(obj.list_display_links)</font>
<font color="black"> 651.             ]))</font>
<font color="black"> 652. </font>
<font color="green"> 653.     def _check_list_display_links_item(self, obj, field_name, label):</font>
<font color="red"> 654.         if field_name not in obj.list_display:</font>
<font color="black"> 655.             return [</font>
<font color="red"> 656.                 checks.Error(</font>
<font color="red"> 657.                     &quot;The value of '%s' refers to '%s', which is not defined in 'list_display'.&quot; % (</font>
<font color="red"> 658.                         label, field_name</font>
<font color="black"> 659.                     ),</font>
<font color="red"> 660.                     hint=None,</font>
<font color="red"> 661.                     obj=obj.__class__,</font>
<font color="red"> 662.                     id='admin.E111',</font>
<font color="black"> 663.                 )</font>
<font color="black"> 664.             ]</font>
<font color="black"> 665.         else:</font>
<font color="red"> 666.             return []</font>
<font color="black"> 667. </font>
<font color="green"> 668.     def _check_list_filter(self, obj):</font>
<font color="green"> 669.         if not isinstance(obj.list_filter, (list, tuple)):</font>
<font color="red"> 670.             return must_be('a list or tuple', option='list_filter', obj=obj, id='admin.E112')</font>
<font color="black"> 671.         else:</font>
<font color="green"> 672.             return list(chain(*[</font>
<font color="green"> 673.                 self._check_list_filter_item(obj, obj.model, item, &quot;list_filter[%d]&quot; % index)</font>
<font color="green"> 674.                 for index, item in enumerate(obj.list_filter)</font>
<font color="black"> 675.             ]))</font>
<font color="black"> 676. </font>
<font color="green"> 677.     def _check_list_filter_item(self, obj, model, item, label):</font>
<font color="black"> 678.         &quot;&quot;&quot;</font>
<font color="black"> 679.         Check one item of `list_filter`, i.e. check if it is one of three options:</font>
<font color="black"> 680.         1. 'field' -- a basic field filter, possibly w/ relationships (e.g.</font>
<font color="black"> 681.            'field__rel')</font>
<font color="black"> 682.         2. ('field', SomeFieldListFilter) - a field-based list filter class</font>
<font color="black"> 683.         3. SomeListFilter - a non-field list filter class</font>
<font color="black"> 684.         &quot;&quot;&quot;</font>
<font color="black"> 685. </font>
<font color="green"> 686.         from django.contrib.admin import ListFilter, FieldListFilter</font>
<font color="black"> 687. </font>
<font color="green"> 688.         if callable(item) and not isinstance(item, models.Field):</font>
<font color="black"> 689.             # If item is option 3, it should be a ListFilter...</font>
<font color="red"> 690.             if not issubclass(item, ListFilter):</font>
<font color="red"> 691.                 return must_inherit_from(parent='ListFilter', option=label,</font>
<font color="red"> 692.                                          obj=obj, id='admin.E113')</font>
<font color="black"> 693.             # ...  but not a FieldListFilter.</font>
<font color="red"> 694.             elif issubclass(item, FieldListFilter):</font>
<font color="black"> 695.                 return [</font>
<font color="red"> 696.                     checks.Error(</font>
<font color="red"> 697.                         &quot;The value of '%s' must not inherit from 'FieldListFilter'.&quot; % label,</font>
<font color="red"> 698.                         hint=None,</font>
<font color="red"> 699.                         obj=obj.__class__,</font>
<font color="red"> 700.                         id='admin.E114',</font>
<font color="black"> 701.                     )</font>
<font color="black"> 702.                 ]</font>
<font color="black"> 703.             else:</font>
<font color="red"> 704.                 return []</font>
<font color="green"> 705.         elif isinstance(item, (tuple, list)):</font>
<font color="black"> 706.             # item is option #2</font>
<font color="red"> 707.             field, list_filter_class = item</font>
<font color="red"> 708.             if not issubclass(list_filter_class, FieldListFilter):</font>
<font color="red"> 709.                 return must_inherit_from(parent='FieldListFilter', option='%s[1]' % label,</font>
<font color="red"> 710.                                          obj=obj, id='admin.E115')</font>
<font color="black"> 711.             else:</font>
<font color="red"> 712.                 return []</font>
<font color="black"> 713.         else:</font>
<font color="black"> 714.             # item is option #1</font>
<font color="green"> 715.             field = item</font>
<font color="black"> 716. </font>
<font color="black"> 717.             # Validate the field string</font>
<font color="green"> 718.             try:</font>
<font color="green"> 719.                 get_fields_from_path(model, field)</font>
<font color="red"> 720.             except (NotRelationField, FieldDoesNotExist):</font>
<font color="black"> 721.                 return [</font>
<font color="red"> 722.                     checks.Error(</font>
<font color="red"> 723.                         &quot;The value of '%s' refers to '%s', which does not refer to a Field.&quot; % (label, field),</font>
<font color="red"> 724.                         hint=None,</font>
<font color="red"> 725.                         obj=obj.__class__,</font>
<font color="red"> 726.                         id='admin.E116',</font>
<font color="black"> 727.                     )</font>
<font color="black"> 728.                 ]</font>
<font color="black"> 729.             else:</font>
<font color="green"> 730.                 return []</font>
<font color="black"> 731. </font>
<font color="green"> 732.     def _check_list_select_related(self, obj):</font>
<font color="black"> 733.         &quot;&quot;&quot; Check that list_select_related is a boolean, a list or a tuple. &quot;&quot;&quot;</font>
<font color="black"> 734. </font>
<font color="green"> 735.         if not isinstance(obj.list_select_related, (bool, list, tuple)):</font>
<font color="red"> 736.             return must_be('a boolean, tuple or list', option='list_select_related',</font>
<font color="red"> 737.                            obj=obj, id='admin.E117')</font>
<font color="black"> 738.         else:</font>
<font color="green"> 739.             return []</font>
<font color="black"> 740. </font>
<font color="green"> 741.     def _check_list_per_page(self, obj):</font>
<font color="black"> 742.         &quot;&quot;&quot; Check that list_per_page is an integer. &quot;&quot;&quot;</font>
<font color="black"> 743. </font>
<font color="green"> 744.         if not isinstance(obj.list_per_page, int):</font>
<font color="red"> 745.             return must_be('an integer', option='list_per_page', obj=obj, id='admin.E118')</font>
<font color="black"> 746.         else:</font>
<font color="green"> 747.             return []</font>
<font color="black"> 748. </font>
<font color="green"> 749.     def _check_list_max_show_all(self, obj):</font>
<font color="black"> 750.         &quot;&quot;&quot; Check that list_max_show_all is an integer. &quot;&quot;&quot;</font>
<font color="black"> 751. </font>
<font color="green"> 752.         if not isinstance(obj.list_max_show_all, int):</font>
<font color="red"> 753.             return must_be('an integer', option='list_max_show_all', obj=obj, id='admin.E119')</font>
<font color="black"> 754.         else:</font>
<font color="green"> 755.             return []</font>
<font color="black"> 756. </font>
<font color="green"> 757.     def _check_list_editable(self, obj):</font>
<font color="black"> 758.         &quot;&quot;&quot; Check that list_editable is a sequence of editable fields from</font>
<font color="black"> 759.         list_display without first element. &quot;&quot;&quot;</font>
<font color="black"> 760. </font>
<font color="green"> 761.         if not isinstance(obj.list_editable, (list, tuple)):</font>
<font color="red"> 762.             return must_be('a list or tuple', option='list_editable', obj=obj, id='admin.E120')</font>
<font color="black"> 763.         else:</font>
<font color="green"> 764.             return list(chain(*[</font>
<font color="green"> 765.                 self._check_list_editable_item(obj, obj.model, item, &quot;list_editable[%d]&quot; % index)</font>
<font color="green"> 766.                 for index, item in enumerate(obj.list_editable)</font>
<font color="black"> 767.             ]))</font>
<font color="black"> 768. </font>
<font color="green"> 769.     def _check_list_editable_item(self, obj, model, field_name, label):</font>
<font color="red"> 770.         try:</font>
<font color="red"> 771.             field = model._meta.get_field(field_name)</font>
<font color="red"> 772.         except FieldDoesNotExist:</font>
<font color="red"> 773.             return refer_to_missing_field(field=field_name, option=label,</font>
<font color="red"> 774.                                           model=model, obj=obj, id='admin.E121')</font>
<font color="black"> 775.         else:</font>
<font color="red"> 776.             if field_name not in obj.list_display:</font>
<font color="black"> 777.                 return [</font>
<font color="red"> 778.                     checks.Error(</font>
<font color="red"> 779.                         &quot;The value of '%s' refers to '%s', which is not &quot;</font>
<font color="red"> 780.                         &quot;contained in 'list_display'.&quot; % (label, field_name),</font>
<font color="red"> 781.                         hint=None,</font>
<font color="red"> 782.                         obj=obj.__class__,</font>
<font color="red"> 783.                         id='admin.E122',</font>
<font color="black"> 784.                     )</font>
<font color="black"> 785.                 ]</font>
<font color="red"> 786.             elif obj.list_display_links and field_name in obj.list_display_links:</font>
<font color="black"> 787.                 return [</font>
<font color="red"> 788.                     checks.Error(</font>
<font color="red"> 789.                         &quot;The value of '%s' cannot be in both 'list_editable' and 'list_display_links'.&quot; % field_name,</font>
<font color="red"> 790.                         hint=None,</font>
<font color="red"> 791.                         obj=obj.__class__,</font>
<font color="red"> 792.                         id='admin.E123',</font>
<font color="black"> 793.                     )</font>
<font color="black"> 794.                 ]</font>
<font color="black"> 795.             # Check that list_display_links is set, and that the first values of list_editable and list_display are</font>
<font color="black"> 796.             # not the same. See ticket #22792 for the use case relating to this.</font>
<font color="red"> 797.             elif (obj.list_display[0] in obj.list_editable and obj.list_display[0] != obj.list_editable[0] and</font>
<font color="red"> 798.                   obj.list_display_links is not None):</font>
<font color="black"> 799.                 return [</font>
<font color="red"> 800.                     checks.Error(</font>
<font color="red"> 801.                         &quot;The value of '%s' refers to the first field in 'list_display' ('%s'), &quot;</font>
<font color="black"> 802.                         &quot;which cannot be used unless 'list_display_links' is set.&quot; % (</font>
<font color="red"> 803.                             label, obj.list_display[0]</font>
<font color="black"> 804.                         ),</font>
<font color="red"> 805.                         hint=None,</font>
<font color="red"> 806.                         obj=obj.__class__,</font>
<font color="red"> 807.                         id='admin.E124',</font>
<font color="black"> 808.                     )</font>
<font color="black"> 809.                 ]</font>
<font color="red"> 810.             elif not field.editable:</font>
<font color="black"> 811.                 return [</font>
<font color="red"> 812.                     checks.Error(</font>
<font color="red"> 813.                         &quot;The value of '%s' refers to '%s', which is not editable through the admin.&quot; % (</font>
<font color="red"> 814.                             label, field_name</font>
<font color="black"> 815.                         ),</font>
<font color="red"> 816.                         hint=None,</font>
<font color="red"> 817.                         obj=obj.__class__,</font>
<font color="red"> 818.                         id='admin.E125',</font>
<font color="black"> 819.                     )</font>
<font color="black"> 820.                 ]</font>
<font color="black"> 821.             else:</font>
<font color="red"> 822.                 return []</font>
<font color="black"> 823. </font>
<font color="green"> 824.     def _check_search_fields(self, obj):</font>
<font color="black"> 825.         &quot;&quot;&quot; Check search_fields is a sequence. &quot;&quot;&quot;</font>
<font color="black"> 826. </font>
<font color="green"> 827.         if not isinstance(obj.search_fields, (list, tuple)):</font>
<font color="red"> 828.             return must_be('a list or tuple', option='search_fields', obj=obj, id='admin.E126')</font>
<font color="black"> 829.         else:</font>
<font color="green"> 830.             return []</font>
<font color="black"> 831. </font>
<font color="green"> 832.     def _check_date_hierarchy(self, obj):</font>
<font color="black"> 833.         &quot;&quot;&quot; Check that date_hierarchy refers to DateField or DateTimeField. &quot;&quot;&quot;</font>
<font color="black"> 834. </font>
<font color="green"> 835.         if obj.date_hierarchy is None:</font>
<font color="green"> 836.             return []</font>
<font color="black"> 837.         else:</font>
<font color="red"> 838.             try:</font>
<font color="red"> 839.                 field = obj.model._meta.get_field(obj.date_hierarchy)</font>
<font color="red"> 840.             except FieldDoesNotExist:</font>
<font color="red"> 841.                 return refer_to_missing_field(option='date_hierarchy',</font>
<font color="red"> 842.                                               field=obj.date_hierarchy,</font>
<font color="red"> 843.                                               model=obj.model, obj=obj, id='admin.E127')</font>
<font color="black"> 844.             else:</font>
<font color="red"> 845.                 if not isinstance(field, (models.DateField, models.DateTimeField)):</font>
<font color="red"> 846.                     return must_be('a DateField or DateTimeField', option='date_hierarchy',</font>
<font color="red"> 847.                                    obj=obj, id='admin.E128')</font>
<font color="black"> 848.                 else:</font>
<font color="red"> 849.                     return []</font>
<font color="black"> 850. </font>
<font color="black"> 851. </font>
<font color="green"> 852. class InlineModelAdminChecks(BaseModelAdminChecks):</font>
<font color="black"> 853. </font>
<font color="green"> 854.     def check(self, inline_obj, **kwargs):</font>
<font color="red"> 855.         errors = super(InlineModelAdminChecks, self).check(inline_obj)</font>
<font color="red"> 856.         parent_model = inline_obj.parent_model</font>
<font color="red"> 857.         errors.extend(self._check_relation(inline_obj, parent_model))</font>
<font color="red"> 858.         errors.extend(self._check_exclude_of_parent_model(inline_obj, parent_model))</font>
<font color="red"> 859.         errors.extend(self._check_extra(inline_obj))</font>
<font color="red"> 860.         errors.extend(self._check_max_num(inline_obj))</font>
<font color="red"> 861.         errors.extend(self._check_min_num(inline_obj))</font>
<font color="red"> 862.         errors.extend(self._check_formset(inline_obj))</font>
<font color="red"> 863.         return errors</font>
<font color="black"> 864. </font>
<font color="green"> 865.     def _check_exclude_of_parent_model(self, obj, parent_model):</font>
<font color="black"> 866.         # Do not perform more specific checks if the base checks result in an</font>
<font color="black"> 867.         # error.</font>
<font color="red"> 868.         errors = super(InlineModelAdminChecks, self)._check_exclude(obj)</font>
<font color="red"> 869.         if errors:</font>
<font color="red"> 870.             return []</font>
<font color="black"> 871. </font>
<font color="black"> 872.         # Skip if `fk_name` is invalid.</font>
<font color="red"> 873.         if self._check_relation(obj, parent_model):</font>
<font color="red"> 874.             return []</font>
<font color="black"> 875. </font>
<font color="red"> 876.         if obj.exclude is None:</font>
<font color="red"> 877.             return []</font>
<font color="black"> 878. </font>
<font color="red"> 879.         fk = _get_foreign_key(parent_model, obj.model, fk_name=obj.fk_name)</font>
<font color="red"> 880.         if fk.name in obj.exclude:</font>
<font color="black"> 881.             return [</font>
<font color="red"> 882.                 checks.Error(</font>
<font color="red"> 883.                     &quot;Cannot exclude the field '%s', because it is the foreign key &quot;</font>
<font color="black"> 884.                     &quot;to the parent model '%s.%s'.&quot; % (</font>
<font color="red"> 885.                         fk.name, parent_model._meta.app_label, parent_model._meta.object_name</font>
<font color="black"> 886.                     ),</font>
<font color="red"> 887.                     hint=None,</font>
<font color="red"> 888.                     obj=obj.__class__,</font>
<font color="red"> 889.                     id='admin.E201',</font>
<font color="black"> 890.                 )</font>
<font color="black"> 891.             ]</font>
<font color="black"> 892.         else:</font>
<font color="red"> 893.             return []</font>
<font color="black"> 894. </font>
<font color="green"> 895.     def _check_relation(self, obj, parent_model):</font>
<font color="red"> 896.         try:</font>
<font color="red"> 897.             _get_foreign_key(parent_model, obj.model, fk_name=obj.fk_name)</font>
<font color="red"> 898.         except ValueError as e:</font>
<font color="red"> 899.             return [checks.Error(e.args[0], hint=None, obj=obj.__class__, id='admin.E202')]</font>
<font color="black"> 900.         else:</font>
<font color="red"> 901.             return []</font>
<font color="black"> 902. </font>
<font color="green"> 903.     def _check_extra(self, obj):</font>
<font color="black"> 904.         &quot;&quot;&quot; Check that extra is an integer. &quot;&quot;&quot;</font>
<font color="black"> 905. </font>
<font color="red"> 906.         if not isinstance(obj.extra, int):</font>
<font color="red"> 907.             return must_be('an integer', option='extra', obj=obj, id='admin.E203')</font>
<font color="black"> 908.         else:</font>
<font color="red"> 909.             return []</font>
<font color="black"> 910. </font>
<font color="green"> 911.     def _check_max_num(self, obj):</font>
<font color="black"> 912.         &quot;&quot;&quot; Check that max_num is an integer. &quot;&quot;&quot;</font>
<font color="black"> 913. </font>
<font color="red"> 914.         if obj.max_num is None:</font>
<font color="red"> 915.             return []</font>
<font color="red"> 916.         elif not isinstance(obj.max_num, int):</font>
<font color="red"> 917.             return must_be('an integer', option='max_num', obj=obj, id='admin.E204')</font>
<font color="black"> 918.         else:</font>
<font color="red"> 919.             return []</font>
<font color="black"> 920. </font>
<font color="green"> 921.     def _check_min_num(self, obj):</font>
<font color="black"> 922.         &quot;&quot;&quot; Check that min_num is an integer. &quot;&quot;&quot;</font>
<font color="black"> 923. </font>
<font color="red"> 924.         if obj.min_num is None:</font>
<font color="red"> 925.             return []</font>
<font color="red"> 926.         elif not isinstance(obj.min_num, int):</font>
<font color="red"> 927.             return must_be('an integer', option='min_num', obj=obj, id='admin.E205')</font>
<font color="black"> 928.         else:</font>
<font color="red"> 929.             return []</font>
<font color="black"> 930. </font>
<font color="green"> 931.     def _check_formset(self, obj):</font>
<font color="black"> 932.         &quot;&quot;&quot; Check formset is a subclass of BaseModelFormSet. &quot;&quot;&quot;</font>
<font color="black"> 933. </font>
<font color="red"> 934.         if not issubclass(obj.formset, BaseModelFormSet):</font>
<font color="red"> 935.             return must_inherit_from(parent='BaseModelFormSet', option='formset',</font>
<font color="red"> 936.                                      obj=obj, id='admin.E206')</font>
<font color="black"> 937.         else:</font>
<font color="red"> 938.             return []</font>
<font color="black"> 939. </font>
<font color="black"> 940. </font>
<font color="green"> 941. def must_be(type, option, obj, id):</font>
<font color="black"> 942.     return [</font>
<font color="red"> 943.         checks.Error(</font>
<font color="red"> 944.             &quot;The value of '%s' must be %s.&quot; % (option, type),</font>
<font color="red"> 945.             hint=None,</font>
<font color="red"> 946.             obj=obj.__class__,</font>
<font color="red"> 947.             id=id,</font>
<font color="black"> 948.         ),</font>
<font color="black"> 949.     ]</font>
<font color="black"> 950. </font>
<font color="black"> 951. </font>
<font color="green"> 952. def must_inherit_from(parent, option, obj, id):</font>
<font color="black"> 953.     return [</font>
<font color="red"> 954.         checks.Error(</font>
<font color="red"> 955.             &quot;The value of '%s' must inherit from '%s'.&quot; % (option, parent),</font>
<font color="red"> 956.             hint=None,</font>
<font color="red"> 957.             obj=obj.__class__,</font>
<font color="red"> 958.             id=id,</font>
<font color="black"> 959.         ),</font>
<font color="black"> 960.     ]</font>
<font color="black"> 961. </font>
<font color="black"> 962. </font>
<font color="green"> 963. def refer_to_missing_field(field, option, model, obj, id):</font>
<font color="black"> 964.     return [</font>
<font color="red"> 965.         checks.Error(</font>
<font color="red"> 966.             &quot;The value of '%s' refers to '%s', which is not an attribute of '%s.%s'.&quot; % (</font>
<font color="red"> 967.                 option, field, model._meta.app_label, model._meta.object_name</font>
<font color="black"> 968.             ),</font>
<font color="red"> 969.             hint=None,</font>
<font color="red"> 970.             obj=obj.__class__,</font>
<font color="red"> 971.             id=id,</font>
<font color="black"> 972.         ),</font>
<font color="black"> 973.     ]</font>
</pre>

