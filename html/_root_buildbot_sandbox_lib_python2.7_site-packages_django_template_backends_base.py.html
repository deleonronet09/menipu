source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/template/backends/base.py</b><br>


file stats: <b>35 lines, 12 executed: 34.3% covered</b>
<pre>
<font color="black">   1. # Since this package contains a &quot;django&quot; module, this is required on Python 2.</font>
<font color="green">   2. from __future__ import absolute_import</font>
<font color="black">   3. </font>
<font color="green">   4. from django.core.exceptions import (</font>
<font color="black">   5.     ImproperlyConfigured, SuspiciousFileOperation,</font>
<font color="black">   6. )</font>
<font color="green">   7. from django.template.utils import get_app_template_dirs</font>
<font color="green">   8. from django.utils._os import safe_join</font>
<font color="green">   9. from django.utils.functional import cached_property</font>
<font color="black">  10. </font>
<font color="black">  11. </font>
<font color="green">  12. class BaseEngine(object):</font>
<font color="black">  13. </font>
<font color="black">  14.     # Core methods: engines have to provide their own implementation</font>
<font color="black">  15.     #               (except for from_string which is optional).</font>
<font color="black">  16. </font>
<font color="green">  17.     def __init__(self, params):</font>
<font color="black">  18.         &quot;&quot;&quot;</font>
<font color="black">  19.         Initializes the template engine.</font>
<font color="black">  20. </font>
<font color="black">  21.         Receives the configuration settings as a dict.</font>
<font color="black">  22.         &quot;&quot;&quot;</font>
<font color="red">  23.         params = params.copy()</font>
<font color="red">  24.         self.name = params.pop('NAME')</font>
<font color="red">  25.         self.dirs = list(params.pop('DIRS'))</font>
<font color="red">  26.         self.app_dirs = bool(params.pop('APP_DIRS'))</font>
<font color="red">  27.         if params:</font>
<font color="red">  28.             raise ImproperlyConfigured(</font>
<font color="red">  29.                 &quot;Unknown parameters: {}&quot;.format(&quot;, &quot;.join(params)))</font>
<font color="black">  30. </font>
<font color="green">  31.     @property</font>
<font color="black">  32.     def app_dirname(self):</font>
<font color="red">  33.         raise ImproperlyConfigured(</font>
<font color="red">  34.             &quot;{} doesn't support loading templates from installed &quot;</font>
<font color="red">  35.             &quot;applications.&quot;.format(self.__class__.__name__))</font>
<font color="black">  36. </font>
<font color="green">  37.     def from_string(self, template_code):</font>
<font color="black">  38.         &quot;&quot;&quot;</font>
<font color="black">  39.         Creates and returns a template for the given source code.</font>
<font color="black">  40. </font>
<font color="black">  41.         This method is optional.</font>
<font color="black">  42.         &quot;&quot;&quot;</font>
<font color="red">  43.         raise NotImplementedError(</font>
<font color="red">  44.             &quot;subclasses of BaseEngine should provide &quot;</font>
<font color="black">  45.             &quot;a from_string() method&quot;)</font>
<font color="black">  46. </font>
<font color="green">  47.     def get_template(self, template_name):</font>
<font color="black">  48.         &quot;&quot;&quot;</font>
<font color="black">  49.         Loads and returns a template for the given name.</font>
<font color="black">  50. </font>
<font color="black">  51.         Raises TemplateDoesNotExist if no such template exists.</font>
<font color="black">  52.         &quot;&quot;&quot;</font>
<font color="red">  53.         raise NotImplementedError(</font>
<font color="red">  54.             &quot;subclasses of BaseEngine must provide &quot;</font>
<font color="black">  55.             &quot;a get_template() method&quot;)</font>
<font color="black">  56. </font>
<font color="black">  57.     # Utility methods: they are provided to minimize code duplication and</font>
<font color="black">  58.     #                  security issues in third-party backends.</font>
<font color="black">  59. </font>
<font color="green">  60.     @cached_property</font>
<font color="black">  61.     def template_dirs(self):</font>
<font color="black">  62.         &quot;&quot;&quot;</font>
<font color="black">  63.         Returns a list of directories to search for templates.</font>
<font color="black">  64.         &quot;&quot;&quot;</font>
<font color="black">  65.         # Immutable return value because it's cached and shared by callers.</font>
<font color="red">  66.         template_dirs = tuple(self.dirs)</font>
<font color="red">  67.         if self.app_dirs:</font>
<font color="red">  68.             template_dirs += get_app_template_dirs(self.app_dirname)</font>
<font color="red">  69.         return template_dirs</font>
<font color="black">  70. </font>
<font color="green">  71.     def iter_template_filenames(self, template_name):</font>
<font color="black">  72.         &quot;&quot;&quot;</font>
<font color="black">  73.         Iterates over candidate files for template_name.</font>
<font color="black">  74. </font>
<font color="black">  75.         Ignores files that don't lie inside configured template dirs to avoid</font>
<font color="black">  76.         directory traversal attacks.</font>
<font color="black">  77.         &quot;&quot;&quot;</font>
<font color="red">  78.         for template_dir in self.template_dirs:</font>
<font color="red">  79.             try:</font>
<font color="red">  80.                 yield safe_join(template_dir, template_name)</font>
<font color="red">  81.             except SuspiciousFileOperation:</font>
<font color="black">  82.                 # The joined path was located outside of this template_dir</font>
<font color="black">  83.                 # (it might be inside another one, so this isn't fatal).</font>
<font color="red">  84.                 pass</font>
</pre>

