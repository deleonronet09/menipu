source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/core/checks/security/base.py</b><br>


file stats: <b>84 lines, 53 executed: 63.1% covered</b>
<pre>
<font color="green">   1. from django.conf import settings</font>
<font color="black">   2. </font>
<font color="green">   3. from .. import Tags, Warning, register</font>
<font color="black">   4. </font>
<font color="green">   5. SECRET_KEY_MIN_LENGTH = 50</font>
<font color="green">   6. SECRET_KEY_MIN_UNIQUE_CHARACTERS = 5</font>
<font color="black">   7. </font>
<font color="green">   8. W001 = Warning(</font>
<font color="green">   9.     &quot;You do not have 'django.middleware.security.SecurityMiddleware' &quot;</font>
<font color="black">  10.     &quot;in your MIDDLEWARE_CLASSES so the SECURE_HSTS_SECONDS, &quot;</font>
<font color="black">  11.     &quot;SECURE_CONTENT_TYPE_NOSNIFF, &quot;</font>
<font color="black">  12.     &quot;SECURE_BROWSER_XSS_FILTER, and SECURE_SSL_REDIRECT settings &quot;</font>
<font color="black">  13.     &quot;will have no effect.&quot;,</font>
<font color="green">  14.     id='security.W001',</font>
<font color="black">  15. )</font>
<font color="black">  16. </font>
<font color="green">  17. W002 = Warning(</font>
<font color="green">  18.     &quot;You do not have &quot;</font>
<font color="black">  19.     &quot;'django.middleware.clickjacking.XFrameOptionsMiddleware' in your &quot;</font>
<font color="black">  20.     &quot;MIDDLEWARE_CLASSES, so your pages will not be served with an &quot;</font>
<font color="black">  21.     &quot;'x-frame-options' header. Unless there is a good reason for your &quot;</font>
<font color="black">  22.     &quot;site to be served in a frame, you should consider enabling this &quot;</font>
<font color="black">  23.     &quot;header to help prevent clickjacking attacks.&quot;,</font>
<font color="green">  24.     id='security.W002',</font>
<font color="black">  25. )</font>
<font color="black">  26. </font>
<font color="green">  27. W004 = Warning(</font>
<font color="green">  28.     &quot;You have not set a value for the SECURE_HSTS_SECONDS setting. &quot;</font>
<font color="black">  29.     &quot;If your entire site is served only over SSL, you may want to consider &quot;</font>
<font color="black">  30.     &quot;setting a value and enabling HTTP Strict Transport Security. &quot;</font>
<font color="black">  31.     &quot;Be sure to read the documentation first; enabling HSTS carelessly &quot;</font>
<font color="black">  32.     &quot;can cause serious, irreversible problems.&quot;,</font>
<font color="green">  33.     id='security.W004',</font>
<font color="black">  34. )</font>
<font color="black">  35. </font>
<font color="green">  36. W005 = Warning(</font>
<font color="green">  37.     &quot;You have not set the SECURE_HSTS_INCLUDE_SUBDOMAINS setting to True. &quot;</font>
<font color="black">  38.     &quot;Without this, your site is potentially vulnerable to attack &quot;</font>
<font color="black">  39.     &quot;via an insecure connection to a subdomain. Only set this to True if &quot;</font>
<font color="black">  40.     &quot;you are certain that all subdomains of your domain should be served &quot;</font>
<font color="black">  41.     &quot;exclusively via SSL.&quot;,</font>
<font color="green">  42.     id='security.W005',</font>
<font color="black">  43. )</font>
<font color="black">  44. </font>
<font color="green">  45. W006 = Warning(</font>
<font color="green">  46.     &quot;Your SECURE_CONTENT_TYPE_NOSNIFF setting is not set to True, &quot;</font>
<font color="black">  47.     &quot;so your pages will not be served with an &quot;</font>
<font color="black">  48.     &quot;'x-content-type-options: nosniff' header. &quot;</font>
<font color="black">  49.     &quot;You should consider enabling this header to prevent the &quot;</font>
<font color="black">  50.     &quot;browser from identifying content types incorrectly.&quot;,</font>
<font color="green">  51.     id='security.W006',</font>
<font color="black">  52. )</font>
<font color="black">  53. </font>
<font color="green">  54. W007 = Warning(</font>
<font color="green">  55.     &quot;Your SECURE_BROWSER_XSS_FILTER setting is not set to True, &quot;</font>
<font color="black">  56.     &quot;so your pages will not be served with an &quot;</font>
<font color="black">  57.     &quot;'x-xss-protection: 1; mode=block' header. &quot;</font>
<font color="black">  58.     &quot;You should consider enabling this header to activate the &quot;</font>
<font color="black">  59.     &quot;browser's XSS filtering and help prevent XSS attacks.&quot;,</font>
<font color="green">  60.     id='security.W007',</font>
<font color="black">  61. )</font>
<font color="black">  62. </font>
<font color="green">  63. W008 = Warning(</font>
<font color="green">  64.     &quot;Your SECURE_SSL_REDIRECT setting is not set to True. &quot;</font>
<font color="black">  65.     &quot;Unless your site should be available over both SSL and non-SSL &quot;</font>
<font color="black">  66.     &quot;connections, you may want to either set this setting True &quot;</font>
<font color="black">  67.     &quot;or configure a load balancer or reverse-proxy server &quot;</font>
<font color="black">  68.     &quot;to redirect all connections to HTTPS.&quot;,</font>
<font color="green">  69.     id='security.W008',</font>
<font color="black">  70. )</font>
<font color="black">  71. </font>
<font color="green">  72. W009 = Warning(</font>
<font color="green">  73.     &quot;Your SECRET_KEY has less than %(min_length)s characters or less than &quot;</font>
<font color="black">  74.     &quot;%(min_unique_chars)s unique characters. Please generate a long and random &quot;</font>
<font color="black">  75.     &quot;SECRET_KEY, otherwise many of Django's security-critical features will be &quot;</font>
<font color="green">  76.     &quot;vulnerable to attack.&quot; % {</font>
<font color="green">  77.         'min_length': SECRET_KEY_MIN_LENGTH,</font>
<font color="green">  78.         'min_unique_chars': SECRET_KEY_MIN_UNIQUE_CHARACTERS,</font>
<font color="black">  79.     },</font>
<font color="green">  80.     id='security.W009',</font>
<font color="black">  81. )</font>
<font color="black">  82. </font>
<font color="green">  83. W018 = Warning(</font>
<font color="green">  84.     &quot;You should not have DEBUG set to True in deployment.&quot;,</font>
<font color="green">  85.     id='security.W018',</font>
<font color="black">  86. )</font>
<font color="black">  87. </font>
<font color="green">  88. W019 = Warning(</font>
<font color="green">  89.     &quot;You have &quot;</font>
<font color="black">  90.     &quot;'django.middleware.clickjacking.XFrameOptionsMiddleware' in your &quot;</font>
<font color="black">  91.     &quot;MIDDLEWARE_CLASSES, but X_FRAME_OPTIONS is not set to 'DENY'. &quot;</font>
<font color="black">  92.     &quot;The default is 'SAMEORIGIN', but unless there is a good reason for &quot;</font>
<font color="black">  93.     &quot;your site to serve other parts of itself in a frame, you should &quot;</font>
<font color="black">  94.     &quot;change it to 'DENY'.&quot;,</font>
<font color="green">  95.     id='security.W019',</font>
<font color="black">  96. )</font>
<font color="black">  97. </font>
<font color="green">  98. W020 = Warning(</font>
<font color="green">  99.     &quot;ALLOWED_HOSTS must not be empty in deployment.&quot;,</font>
<font color="green"> 100.     id='security.W020',</font>
<font color="black"> 101. )</font>
<font color="black"> 102. </font>
<font color="black"> 103. </font>
<font color="green"> 104. def _security_middleware():</font>
<font color="red"> 105.     return &quot;django.middleware.security.SecurityMiddleware&quot; in settings.MIDDLEWARE_CLASSES</font>
<font color="black"> 106. </font>
<font color="black"> 107. </font>
<font color="green"> 108. def _xframe_middleware():</font>
<font color="red"> 109.     return &quot;django.middleware.clickjacking.XFrameOptionsMiddleware&quot; in settings.MIDDLEWARE_CLASSES</font>
<font color="black"> 110. </font>
<font color="black"> 111. </font>
<font color="green"> 112. @register(Tags.security, deploy=True)</font>
<font color="black"> 113. def check_security_middleware(app_configs, **kwargs):</font>
<font color="red"> 114.     passed_check = _security_middleware()</font>
<font color="red"> 115.     return [] if passed_check else [W001]</font>
<font color="black"> 116. </font>
<font color="black"> 117. </font>
<font color="green"> 118. @register(Tags.security, deploy=True)</font>
<font color="black"> 119. def check_xframe_options_middleware(app_configs, **kwargs):</font>
<font color="red"> 120.     passed_check = _xframe_middleware()</font>
<font color="red"> 121.     return [] if passed_check else [W002]</font>
<font color="black"> 122. </font>
<font color="black"> 123. </font>
<font color="green"> 124. @register(Tags.security, deploy=True)</font>
<font color="black"> 125. def check_sts(app_configs, **kwargs):</font>
<font color="red"> 126.     passed_check = not _security_middleware() or settings.SECURE_HSTS_SECONDS</font>
<font color="red"> 127.     return [] if passed_check else [W004]</font>
<font color="black"> 128. </font>
<font color="black"> 129. </font>
<font color="green"> 130. @register(Tags.security, deploy=True)</font>
<font color="black"> 131. def check_sts_include_subdomains(app_configs, **kwargs):</font>
<font color="black"> 132.     passed_check = (</font>
<font color="red"> 133.         not _security_middleware() or</font>
<font color="red"> 134.         not settings.SECURE_HSTS_SECONDS or</font>
<font color="red"> 135.         settings.SECURE_HSTS_INCLUDE_SUBDOMAINS is True</font>
<font color="black"> 136.     )</font>
<font color="red"> 137.     return [] if passed_check else [W005]</font>
<font color="black"> 138. </font>
<font color="black"> 139. </font>
<font color="green"> 140. @register(Tags.security, deploy=True)</font>
<font color="black"> 141. def check_content_type_nosniff(app_configs, **kwargs):</font>
<font color="black"> 142.     passed_check = (</font>
<font color="red"> 143.         not _security_middleware() or</font>
<font color="red"> 144.         settings.SECURE_CONTENT_TYPE_NOSNIFF is True</font>
<font color="black"> 145.     )</font>
<font color="red"> 146.     return [] if passed_check else [W006]</font>
<font color="black"> 147. </font>
<font color="black"> 148. </font>
<font color="green"> 149. @register(Tags.security, deploy=True)</font>
<font color="black"> 150. def check_xss_filter(app_configs, **kwargs):</font>
<font color="black"> 151.     passed_check = (</font>
<font color="red"> 152.         not _security_middleware() or</font>
<font color="red"> 153.         settings.SECURE_BROWSER_XSS_FILTER is True</font>
<font color="black"> 154.     )</font>
<font color="red"> 155.     return [] if passed_check else [W007]</font>
<font color="black"> 156. </font>
<font color="black"> 157. </font>
<font color="green"> 158. @register(Tags.security, deploy=True)</font>
<font color="black"> 159. def check_ssl_redirect(app_configs, **kwargs):</font>
<font color="black"> 160.     passed_check = (</font>
<font color="red"> 161.         not _security_middleware() or</font>
<font color="red"> 162.         settings.SECURE_SSL_REDIRECT is True</font>
<font color="black"> 163.     )</font>
<font color="red"> 164.     return [] if passed_check else [W008]</font>
<font color="black"> 165. </font>
<font color="black"> 166. </font>
<font color="green"> 167. @register(Tags.security, deploy=True)</font>
<font color="black"> 168. def check_secret_key(app_configs, **kwargs):</font>
<font color="black"> 169.     passed_check = (</font>
<font color="red"> 170.         getattr(settings, 'SECRET_KEY', None) and</font>
<font color="red"> 171.         len(set(settings.SECRET_KEY)) &gt;= SECRET_KEY_MIN_UNIQUE_CHARACTERS and</font>
<font color="red"> 172.         len(settings.SECRET_KEY) &gt;= SECRET_KEY_MIN_LENGTH</font>
<font color="black"> 173.     )</font>
<font color="red"> 174.     return [] if passed_check else [W009]</font>
<font color="black"> 175. </font>
<font color="black"> 176. </font>
<font color="green"> 177. @register(Tags.security, deploy=True)</font>
<font color="black"> 178. def check_debug(app_configs, **kwargs):</font>
<font color="red"> 179.     passed_check = not settings.DEBUG</font>
<font color="red"> 180.     return [] if passed_check else [W018]</font>
<font color="black"> 181. </font>
<font color="black"> 182. </font>
<font color="green"> 183. @register(Tags.security, deploy=True)</font>
<font color="black"> 184. def check_xframe_deny(app_configs, **kwargs):</font>
<font color="black"> 185.     passed_check = (</font>
<font color="red"> 186.         not _xframe_middleware() or</font>
<font color="red"> 187.         settings.X_FRAME_OPTIONS == 'DENY'</font>
<font color="black"> 188.     )</font>
<font color="red"> 189.     return [] if passed_check else [W019]</font>
<font color="black"> 190. </font>
<font color="black"> 191. </font>
<font color="green"> 192. @register(Tags.security, deploy=True)</font>
<font color="black"> 193. def check_allowed_hosts(app_configs, **kwargs):</font>
<font color="red"> 194.     return [] if settings.ALLOWED_HOSTS else [W020]</font>
</pre>

