source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/contrib/admin/models.py</b><br>


file stats: <b>75 lines, 47 executed: 62.7% covered</b>
<pre>
<font color="green">   1. from __future__ import unicode_literals</font>
<font color="black">   2. </font>
<font color="green">   3. from django.conf import settings</font>
<font color="green">   4. from django.contrib.admin.utils import quote</font>
<font color="green">   5. from django.contrib.contenttypes.models import ContentType</font>
<font color="green">   6. from django.core.urlresolvers import NoReverseMatch, reverse</font>
<font color="green">   7. from django.db import models</font>
<font color="green">   8. from django.utils import timezone</font>
<font color="green">   9. from django.utils.encoding import python_2_unicode_compatible, smart_text</font>
<font color="green">  10. from django.utils.translation import ugettext, ugettext_lazy as _</font>
<font color="black">  11. </font>
<font color="green">  12. ADDITION = 1</font>
<font color="green">  13. CHANGE = 2</font>
<font color="green">  14. DELETION = 3</font>
<font color="black">  15. </font>
<font color="black">  16. </font>
<font color="green">  17. class LogEntryManager(models.Manager):</font>
<font color="green">  18.     use_in_migrations = True</font>
<font color="black">  19. </font>
<font color="green">  20.     def log_action(self, user_id, content_type_id, object_id, object_repr, action_flag, change_message=''):</font>
<font color="red">  21.         self.model.objects.create(</font>
<font color="red">  22.             user_id=user_id,</font>
<font color="red">  23.             content_type_id=content_type_id,</font>
<font color="red">  24.             object_id=smart_text(object_id),</font>
<font color="red">  25.             object_repr=object_repr[:200],</font>
<font color="red">  26.             action_flag=action_flag,</font>
<font color="red">  27.             change_message=change_message,</font>
<font color="black">  28.         )</font>
<font color="black">  29. </font>
<font color="black">  30. </font>
<font color="green">  31. @python_2_unicode_compatible</font>
<font color="green">  32. class LogEntry(models.Model):</font>
<font color="green">  33.     action_time = models.DateTimeField(</font>
<font color="green">  34.         _('action time'),</font>
<font color="green">  35.         default=timezone.now,</font>
<font color="green">  36.         editable=False,</font>
<font color="black">  37.     )</font>
<font color="green">  38.     user = models.ForeignKey(</font>
<font color="green">  39.         settings.AUTH_USER_MODEL,</font>
<font color="green">  40.         models.CASCADE,</font>
<font color="green">  41.         verbose_name=_('user'),</font>
<font color="black">  42.     )</font>
<font color="green">  43.     content_type = models.ForeignKey(</font>
<font color="green">  44.         ContentType,</font>
<font color="green">  45.         models.SET_NULL,</font>
<font color="green">  46.         verbose_name=_('content type'),</font>
<font color="green">  47.         blank=True, null=True,</font>
<font color="black">  48.     )</font>
<font color="green">  49.     object_id = models.TextField(_('object id'), blank=True, null=True)</font>
<font color="green">  50.     object_repr = models.CharField(_('object repr'), max_length=200)</font>
<font color="green">  51.     action_flag = models.PositiveSmallIntegerField(_('action flag'))</font>
<font color="green">  52.     change_message = models.TextField(_('change message'), blank=True)</font>
<font color="black">  53. </font>
<font color="green">  54.     objects = LogEntryManager()</font>
<font color="black">  55. </font>
<font color="green">  56.     class Meta:</font>
<font color="green">  57.         verbose_name = _('log entry')</font>
<font color="green">  58.         verbose_name_plural = _('log entries')</font>
<font color="green">  59.         db_table = 'django_admin_log'</font>
<font color="green">  60.         ordering = ('-action_time',)</font>
<font color="black">  61. </font>
<font color="green">  62.     def __repr__(self):</font>
<font color="red">  63.         return smart_text(self.action_time)</font>
<font color="black">  64. </font>
<font color="green">  65.     def __str__(self):</font>
<font color="red">  66.         if self.is_addition():</font>
<font color="red">  67.             return ugettext('Added &quot;%(object)s&quot;.') % {'object': self.object_repr}</font>
<font color="red">  68.         elif self.is_change():</font>
<font color="red">  69.             return ugettext('Changed &quot;%(object)s&quot; - %(changes)s') % {</font>
<font color="red">  70.                 'object': self.object_repr,</font>
<font color="red">  71.                 'changes': self.change_message,</font>
<font color="black">  72.             }</font>
<font color="red">  73.         elif self.is_deletion():</font>
<font color="red">  74.             return ugettext('Deleted &quot;%(object)s.&quot;') % {'object': self.object_repr}</font>
<font color="black">  75. </font>
<font color="red">  76.         return ugettext('LogEntry Object')</font>
<font color="black">  77. </font>
<font color="green">  78.     def is_addition(self):</font>
<font color="red">  79.         return self.action_flag == ADDITION</font>
<font color="black">  80. </font>
<font color="green">  81.     def is_change(self):</font>
<font color="red">  82.         return self.action_flag == CHANGE</font>
<font color="black">  83. </font>
<font color="green">  84.     def is_deletion(self):</font>
<font color="red">  85.         return self.action_flag == DELETION</font>
<font color="black">  86. </font>
<font color="green">  87.     def get_edited_object(self):</font>
<font color="black">  88.         &quot;Returns the edited object represented by this log entry&quot;</font>
<font color="red">  89.         return self.content_type.get_object_for_this_type(pk=self.object_id)</font>
<font color="black">  90. </font>
<font color="green">  91.     def get_admin_url(self):</font>
<font color="black">  92.         &quot;&quot;&quot;</font>
<font color="black">  93.         Returns the admin URL to edit the object represented by this log entry.</font>
<font color="black">  94.         &quot;&quot;&quot;</font>
<font color="red">  95.         if self.content_type and self.object_id:</font>
<font color="red">  96.             url_name = 'admin:%s_%s_change' % (self.content_type.app_label, self.content_type.model)</font>
<font color="red">  97.             try:</font>
<font color="red">  98.                 return reverse(url_name, args=(quote(self.object_id),))</font>
<font color="red">  99.             except NoReverseMatch:</font>
<font color="red"> 100.                 pass</font>
<font color="red"> 101.         return None</font>
</pre>

