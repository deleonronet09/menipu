source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/utils/deprecation.py</b><br>


file stats: <b>52 lines, 37 executed: 71.2% covered</b>
<pre>
<font color="green">   1. from __future__ import absolute_import</font>
<font color="black">   2. </font>
<font color="green">   3. import inspect</font>
<font color="green">   4. import warnings</font>
<font color="black">   5. </font>
<font color="black">   6. </font>
<font color="green">   7. class RemovedInDjango20Warning(PendingDeprecationWarning):</font>
<font color="green">   8.     pass</font>
<font color="black">   9. </font>
<font color="black">  10. </font>
<font color="green">  11. class RemovedInDjango110Warning(DeprecationWarning):</font>
<font color="green">  12.     pass</font>
<font color="black">  13. </font>
<font color="black">  14. </font>
<font color="green">  15. RemovedInNextVersionWarning = RemovedInDjango110Warning</font>
<font color="black">  16. </font>
<font color="black">  17. </font>
<font color="green">  18. class warn_about_renamed_method(object):</font>
<font color="green">  19.     def __init__(self, class_name, old_method_name, new_method_name, deprecation_warning):</font>
<font color="green">  20.         self.class_name = class_name</font>
<font color="green">  21.         self.old_method_name = old_method_name</font>
<font color="green">  22.         self.new_method_name = new_method_name</font>
<font color="green">  23.         self.deprecation_warning = deprecation_warning</font>
<font color="black">  24. </font>
<font color="green">  25.     def __call__(self, f):</font>
<font color="green">  26.         def wrapped(*args, **kwargs):</font>
<font color="red">  27.             warnings.warn(</font>
<font color="red">  28.                 &quot;`%s.%s` is deprecated, use `%s` instead.&quot; %</font>
<font color="red">  29.                 (self.class_name, self.old_method_name, self.new_method_name),</font>
<font color="red">  30.                 self.deprecation_warning, 2)</font>
<font color="red">  31.             return f(*args, **kwargs)</font>
<font color="green">  32.         return wrapped</font>
<font color="black">  33. </font>
<font color="black">  34. </font>
<font color="green">  35. class RenameMethodsBase(type):</font>
<font color="black">  36.     &quot;&quot;&quot;</font>
<font color="black">  37.     Handles the deprecation paths when renaming a method.</font>
<font color="black">  38. </font>
<font color="black">  39.     It does the following:</font>
<font color="black">  40.         1) Define the new method if missing and complain about it.</font>
<font color="black">  41.         2) Define the old method if missing.</font>
<font color="black">  42.         3) Complain whenever an old method is called.</font>
<font color="black">  43. </font>
<font color="black">  44.     See #15363 for more details.</font>
<font color="green">  45.     &quot;&quot;&quot;</font>
<font color="black">  46. </font>
<font color="green">  47.     renamed_methods = ()</font>
<font color="black">  48. </font>
<font color="green">  49.     def __new__(cls, name, bases, attrs):</font>
<font color="green">  50.         new_class = super(RenameMethodsBase, cls).__new__(cls, name, bases, attrs)</font>
<font color="black">  51. </font>
<font color="green">  52.         for base in inspect.getmro(new_class):</font>
<font color="green">  53.             class_name = base.__name__</font>
<font color="green">  54.             for renamed_method in cls.renamed_methods:</font>
<font color="green">  55.                 old_method_name = renamed_method[0]</font>
<font color="green">  56.                 old_method = base.__dict__.get(old_method_name)</font>
<font color="green">  57.                 new_method_name = renamed_method[1]</font>
<font color="green">  58.                 new_method = base.__dict__.get(new_method_name)</font>
<font color="green">  59.                 deprecation_warning = renamed_method[2]</font>
<font color="green">  60.                 wrapper = warn_about_renamed_method(class_name, *renamed_method)</font>
<font color="black">  61. </font>
<font color="black">  62.                 # Define the new method if missing and complain about it</font>
<font color="green">  63.                 if not new_method and old_method:</font>
<font color="red">  64.                     warnings.warn(</font>
<font color="red">  65.                         &quot;`%s.%s` method should be renamed `%s`.&quot; %</font>
<font color="red">  66.                         (class_name, old_method_name, new_method_name),</font>
<font color="red">  67.                         deprecation_warning, 2)</font>
<font color="red">  68.                     setattr(base, new_method_name, old_method)</font>
<font color="red">  69.                     setattr(base, old_method_name, wrapper(old_method))</font>
<font color="black">  70. </font>
<font color="black">  71.                 # Define the old method as a wrapped call to the new method.</font>
<font color="green">  72.                 if not old_method and new_method:</font>
<font color="green">  73.                     setattr(base, old_method_name, wrapper(new_method))</font>
<font color="black">  74. </font>
<font color="green">  75.         return new_class</font>
<font color="black">  76. </font>
<font color="black">  77. </font>
<font color="green">  78. class DeprecationInstanceCheck(type):</font>
<font color="green">  79.     def __instancecheck__(self, instance):</font>
<font color="red">  80.         warnings.warn(</font>
<font color="red">  81.             &quot;`%s` is deprecated, use `%s` instead.&quot; % (self.__name__, self.alternative),</font>
<font color="red">  82.             self.deprecation_warning, 2</font>
<font color="black">  83.         )</font>
<font color="red">  84.         return super(DeprecationInstanceCheck, self).__instancecheck__(instance)</font>
</pre>

