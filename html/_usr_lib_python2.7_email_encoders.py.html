source file: <b>/usr/lib/python2.7/email/encoders.py</b><br>


file stats: <b>39 lines, 13 executed: 33.3% covered</b>
<pre>
<font color="black">   1. # Copyright (C) 2001-2006 Python Software Foundation</font>
<font color="black">   2. # Author: Barry Warsaw</font>
<font color="black">   3. # Contact: email-sig@python.org</font>
<font color="black">   4. </font>
<font color="green">   5. &quot;&quot;&quot;Encodings and related functions.&quot;&quot;&quot;</font>
<font color="black">   6. </font>
<font color="black">   7. __all__ = [</font>
<font color="green">   8.     'encode_7or8bit',</font>
<font color="green">   9.     'encode_base64',</font>
<font color="green">  10.     'encode_noop',</font>
<font color="green">  11.     'encode_quopri',</font>
<font color="black">  12.     ]</font>
<font color="black">  13. </font>
<font color="green">  14. import base64</font>
<font color="black">  15. </font>
<font color="green">  16. from quopri import encodestring as _encodestring</font>
<font color="black">  17. </font>
<font color="black">  18. </font>
<font color="black">  19. </font>
<font color="green">  20. def _qencode(s):</font>
<font color="red">  21.     enc = _encodestring(s, quotetabs=True)</font>
<font color="black">  22.     # Must encode spaces, which quopri.encodestring() doesn't do</font>
<font color="red">  23.     return enc.replace(' ', '=20')</font>
<font color="black">  24. </font>
<font color="black">  25. </font>
<font color="green">  26. def _bencode(s):</font>
<font color="black">  27.     # We can't quite use base64.encodestring() since it tacks on a &quot;courtesy</font>
<font color="black">  28.     # newline&quot;.  Blech!</font>
<font color="red">  29.     if not s:</font>
<font color="red">  30.         return s</font>
<font color="red">  31.     hasnewline = (s[-1] == '\n')</font>
<font color="red">  32.     value = base64.encodestring(s)</font>
<font color="red">  33.     if not hasnewline and value[-1] == '\n':</font>
<font color="red">  34.         return value[:-1]</font>
<font color="red">  35.     return value</font>
<font color="black">  36. </font>
<font color="black">  37. </font>
<font color="black">  38. </font>
<font color="green">  39. def encode_base64(msg):</font>
<font color="black">  40.     &quot;&quot;&quot;Encode the message's payload in Base64.</font>
<font color="black">  41. </font>
<font color="black">  42.     Also, add an appropriate Content-Transfer-Encoding header.</font>
<font color="black">  43.     &quot;&quot;&quot;</font>
<font color="red">  44.     orig = msg.get_payload()</font>
<font color="red">  45.     encdata = _bencode(orig)</font>
<font color="red">  46.     msg.set_payload(encdata)</font>
<font color="red">  47.     msg['Content-Transfer-Encoding'] = 'base64'</font>
<font color="black">  48. </font>
<font color="black">  49. </font>
<font color="black">  50. </font>
<font color="green">  51. def encode_quopri(msg):</font>
<font color="black">  52.     &quot;&quot;&quot;Encode the message's payload in quoted-printable.</font>
<font color="black">  53. </font>
<font color="black">  54.     Also, add an appropriate Content-Transfer-Encoding header.</font>
<font color="black">  55.     &quot;&quot;&quot;</font>
<font color="red">  56.     orig = msg.get_payload()</font>
<font color="red">  57.     encdata = _qencode(orig)</font>
<font color="red">  58.     msg.set_payload(encdata)</font>
<font color="red">  59.     msg['Content-Transfer-Encoding'] = 'quoted-printable'</font>
<font color="black">  60. </font>
<font color="black">  61. </font>
<font color="black">  62. </font>
<font color="green">  63. def encode_7or8bit(msg):</font>
<font color="black">  64.     &quot;&quot;&quot;Set the Content-Transfer-Encoding header to 7bit or 8bit.&quot;&quot;&quot;</font>
<font color="red">  65.     orig = msg.get_payload()</font>
<font color="red">  66.     if orig is None:</font>
<font color="black">  67.         # There's no payload.  For backwards compatibility we use 7bit</font>
<font color="red">  68.         msg['Content-Transfer-Encoding'] = '7bit'</font>
<font color="red">  69.         return</font>
<font color="black">  70.     # We play a trick to make this go fast.  If encoding to ASCII succeeds, we</font>
<font color="black">  71.     # know the data must be 7bit, otherwise treat it as 8bit.</font>
<font color="red">  72.     try:</font>
<font color="red">  73.         orig.encode('ascii')</font>
<font color="red">  74.     except UnicodeError:</font>
<font color="red">  75.         msg['Content-Transfer-Encoding'] = '8bit'</font>
<font color="black">  76.     else:</font>
<font color="red">  77.         msg['Content-Transfer-Encoding'] = '7bit'</font>
<font color="black">  78. </font>
<font color="black">  79. </font>
<font color="black">  80. </font>
<font color="green">  81. def encode_noop(msg):</font>
<font color="black">  82.     &quot;&quot;&quot;Do nothing.&quot;&quot;&quot;</font>
</pre>

