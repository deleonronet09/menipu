source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/template/loader.py</b><br>


file stats: <b>98 lines, 23 executed: 23.5% covered</b>
<pre>
<font color="green">   1. import warnings</font>
<font color="black">   2. </font>
<font color="green">   3. from django.utils import six</font>
<font color="green">   4. from django.utils.deprecation import (</font>
<font color="black">   5.     DeprecationInstanceCheck, RemovedInDjango20Warning,</font>
<font color="black">   6.     RemovedInDjango110Warning,</font>
<font color="black">   7. )</font>
<font color="black">   8. </font>
<font color="green">   9. from . import engines</font>
<font color="green">  10. from .backends.django import DjangoTemplates</font>
<font color="green">  11. from .base import Origin</font>
<font color="green">  12. from .engine import (</font>
<font color="black">  13.     _context_instance_undefined, _dictionary_undefined, _dirs_undefined,</font>
<font color="black">  14. )</font>
<font color="green">  15. from .exceptions import TemplateDoesNotExist</font>
<font color="green">  16. from .loaders import base</font>
<font color="black">  17. </font>
<font color="black">  18. </font>
<font color="green">  19. def get_template(template_name, dirs=_dirs_undefined, using=None):</font>
<font color="black">  20.     &quot;&quot;&quot;</font>
<font color="black">  21.     Loads and returns a template for the given name.</font>
<font color="black">  22. </font>
<font color="black">  23.     Raises TemplateDoesNotExist if no such template exists.</font>
<font color="black">  24.     &quot;&quot;&quot;</font>
<font color="red">  25.     chain = []</font>
<font color="red">  26.     engines = _engine_list(using)</font>
<font color="red">  27.     for engine in engines:</font>
<font color="red">  28.         try:</font>
<font color="black">  29.             # This is required for deprecating the dirs argument. Simply</font>
<font color="black">  30.             # return engine.get_template(template_name) in Django 1.10.</font>
<font color="red">  31.             if isinstance(engine, DjangoTemplates):</font>
<font color="red">  32.                 return engine.get_template(template_name, dirs)</font>
<font color="red">  33.             elif dirs is not _dirs_undefined:</font>
<font color="red">  34.                 warnings.warn(</font>
<font color="red">  35.                     &quot;Skipping template backend %s because its get_template &quot;</font>
<font color="red">  36.                     &quot;method doesn't support the dirs argument.&quot; % engine.name,</font>
<font color="red">  37.                     stacklevel=2)</font>
<font color="black">  38.             else:</font>
<font color="red">  39.                 return engine.get_template(template_name)</font>
<font color="red">  40.         except TemplateDoesNotExist as e:</font>
<font color="red">  41.             chain.append(e)</font>
<font color="black">  42. </font>
<font color="red">  43.     raise TemplateDoesNotExist(template_name, chain=chain)</font>
<font color="black">  44. </font>
<font color="black">  45. </font>
<font color="green">  46. def select_template(template_name_list, dirs=_dirs_undefined, using=None):</font>
<font color="black">  47.     &quot;&quot;&quot;</font>
<font color="black">  48.     Loads and returns a template for one of the given names.</font>
<font color="black">  49. </font>
<font color="black">  50.     Tries names in order and returns the first template found.</font>
<font color="black">  51. </font>
<font color="black">  52.     Raises TemplateDoesNotExist if no such template exists.</font>
<font color="black">  53.     &quot;&quot;&quot;</font>
<font color="red">  54.     chain = []</font>
<font color="red">  55.     engines = _engine_list(using)</font>
<font color="red">  56.     for template_name in template_name_list:</font>
<font color="red">  57.         for engine in engines:</font>
<font color="red">  58.             try:</font>
<font color="black">  59.                 # This is required for deprecating the dirs argument. Simply</font>
<font color="black">  60.                 # use engine.get_template(template_name) in Django 1.10.</font>
<font color="red">  61.                 if isinstance(engine, DjangoTemplates):</font>
<font color="red">  62.                     return engine.get_template(template_name, dirs)</font>
<font color="red">  63.                 elif dirs is not _dirs_undefined:</font>
<font color="red">  64.                     warnings.warn(</font>
<font color="red">  65.                         &quot;Skipping template backend %s because its get_template &quot;</font>
<font color="red">  66.                         &quot;method doesn't support the dirs argument.&quot; % engine.name,</font>
<font color="red">  67.                         stacklevel=2)</font>
<font color="black">  68.                 else:</font>
<font color="red">  69.                     return engine.get_template(template_name)</font>
<font color="red">  70.             except TemplateDoesNotExist as e:</font>
<font color="red">  71.                 chain.append(e)</font>
<font color="black">  72. </font>
<font color="red">  73.     if template_name_list:</font>
<font color="red">  74.         raise TemplateDoesNotExist(', '.join(template_name_list), chain=chain)</font>
<font color="black">  75.     else:</font>
<font color="red">  76.         raise TemplateDoesNotExist(&quot;No template names provided&quot;)</font>
<font color="black">  77. </font>
<font color="black">  78. </font>
<font color="green">  79. def render_to_string(template_name, context=None,</font>
<font color="green">  80.                      context_instance=_context_instance_undefined,</font>
<font color="green">  81.                      dirs=_dirs_undefined,</font>
<font color="green">  82.                      dictionary=_dictionary_undefined,</font>
<font color="green">  83.                      request=None, using=None):</font>
<font color="black">  84.     &quot;&quot;&quot;</font>
<font color="black">  85.     Loads a template and renders it with a context. Returns a string.</font>
<font color="black">  86. </font>
<font color="black">  87.     template_name may be a string or a list of strings.</font>
<font color="black">  88.     &quot;&quot;&quot;</font>
<font color="red">  89.     if (context_instance is _context_instance_undefined</font>
<font color="red">  90.             and dirs is _dirs_undefined</font>
<font color="red">  91.             and dictionary is _dictionary_undefined):</font>
<font color="black">  92.         # No deprecated arguments were passed - use the new code path</font>
<font color="red">  93.         if isinstance(template_name, (list, tuple)):</font>
<font color="red">  94.             template = select_template(template_name, using=using)</font>
<font color="black">  95.         else:</font>
<font color="red">  96.             template = get_template(template_name, using=using)</font>
<font color="red">  97.         return template.render(context, request)</font>
<font color="black">  98. </font>
<font color="black">  99.     else:</font>
<font color="red"> 100.         chain = []</font>
<font color="black"> 101.         # Some deprecated arguments were passed - use the legacy code path</font>
<font color="red"> 102.         for engine in _engine_list(using):</font>
<font color="red"> 103.             try:</font>
<font color="black"> 104.                 # This is required for deprecating properly arguments specific</font>
<font color="black"> 105.                 # to Django templates. Remove Engine.render_to_string() at the</font>
<font color="black"> 106.                 # same time as this code path in Django 1.10.</font>
<font color="red"> 107.                 if isinstance(engine, DjangoTemplates):</font>
<font color="red"> 108.                     if request is not None:</font>
<font color="red"> 109.                         raise ValueError(</font>
<font color="red"> 110.                             &quot;render_to_string doesn't support the request argument &quot;</font>
<font color="black"> 111.                             &quot;when some deprecated arguments are passed.&quot;)</font>
<font color="black"> 112.                     # Hack -- use the internal Engine instance of DjangoTemplates.</font>
<font color="red"> 113.                     return engine.engine.render_to_string(</font>
<font color="red"> 114.                         template_name, context, context_instance, dirs, dictionary)</font>
<font color="red"> 115.                 elif context_instance is not _context_instance_undefined:</font>
<font color="red"> 116.                     warnings.warn(</font>
<font color="red"> 117.                         &quot;Skipping template backend %s because its render_to_string &quot;</font>
<font color="black"> 118.                         &quot;method doesn't support the context_instance argument.&quot; %</font>
<font color="red"> 119.                         engine.name, stacklevel=2)</font>
<font color="red"> 120.                 elif dirs is not _dirs_undefined:</font>
<font color="red"> 121.                     warnings.warn(</font>
<font color="red"> 122.                         &quot;Skipping template backend %s because its render_to_string &quot;</font>
<font color="red"> 123.                         &quot;method doesn't support the dirs argument.&quot; % engine.name,</font>
<font color="red"> 124.                         stacklevel=2)</font>
<font color="red"> 125.                 elif dictionary is not _dictionary_undefined:</font>
<font color="red"> 126.                     warnings.warn(</font>
<font color="red"> 127.                         &quot;Skipping template backend %s because its render_to_string &quot;</font>
<font color="black"> 128.                         &quot;method doesn't support the dictionary argument.&quot; %</font>
<font color="red"> 129.                         engine.name, stacklevel=2)</font>
<font color="red"> 130.             except TemplateDoesNotExist as e:</font>
<font color="red"> 131.                 chain.append(e)</font>
<font color="red"> 132.                 continue</font>
<font color="black"> 133. </font>
<font color="red"> 134.         if template_name:</font>
<font color="red"> 135.             if isinstance(template_name, (list, tuple)):</font>
<font color="red"> 136.                 template_name = ', '.join(template_name)</font>
<font color="red"> 137.             raise TemplateDoesNotExist(template_name, chain=chain)</font>
<font color="black"> 138.         else:</font>
<font color="red"> 139.             raise TemplateDoesNotExist(&quot;No template names provided&quot;)</font>
<font color="black"> 140. </font>
<font color="black"> 141. </font>
<font color="green"> 142. def _engine_list(using=None):</font>
<font color="red"> 143.     return engines.all() if using is None else [engines[using]]</font>
<font color="black"> 144. </font>
<font color="black"> 145. </font>
<font color="green"> 146. class BaseLoader(base.Loader):</font>
<font color="green"> 147.     _accepts_engine_in_init = False</font>
<font color="black"> 148. </font>
<font color="green"> 149.     def __init__(self, *args, **kwargs):</font>
<font color="red"> 150.         warnings.warn(</font>
<font color="red"> 151.             &quot;django.template.loader.BaseLoader was superseded by &quot;</font>
<font color="black"> 152.             &quot;django.template.loaders.base.Loader.&quot;,</font>
<font color="red"> 153.             RemovedInDjango110Warning, stacklevel=2)</font>
<font color="red"> 154.         super(BaseLoader, self).__init__(*args, **kwargs)</font>
<font color="black"> 155. </font>
<font color="black"> 156. </font>
<font color="green"> 157. class LoaderOrigin(six.with_metaclass(DeprecationInstanceCheck, Origin)):</font>
<font color="green"> 158.     alternative = 'django.template.Origin'</font>
<font color="green"> 159.     deprecation_warning = RemovedInDjango20Warning</font>
</pre>

