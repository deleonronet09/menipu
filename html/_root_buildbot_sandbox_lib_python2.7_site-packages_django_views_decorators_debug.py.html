source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/views/decorators/debug.py</b><br>


file stats: <b>22 lines, 8 executed: 36.4% covered</b>
<pre>
<font color="green">   1. import functools</font>
<font color="black">   2. </font>
<font color="green">   3. from django.http import HttpRequest</font>
<font color="black">   4. </font>
<font color="black">   5. </font>
<font color="green">   6. def sensitive_variables(*variables):</font>
<font color="black">   7.     &quot;&quot;&quot;</font>
<font color="black">   8.     Indicates which variables used in the decorated function are sensitive, so</font>
<font color="black">   9.     that those variables can later be treated in a special way, for example</font>
<font color="black">  10.     by hiding them when logging unhandled exceptions.</font>
<font color="black">  11. </font>
<font color="black">  12.     Two forms are accepted:</font>
<font color="black">  13. </font>
<font color="black">  14.     * with specified variable names:</font>
<font color="black">  15. </font>
<font color="black">  16.         @sensitive_variables('user', 'password', 'credit_card')</font>
<font color="black">  17.         def my_function(user):</font>
<font color="black">  18.             password = user.pass_word</font>
<font color="black">  19.             credit_card = user.credit_card_number</font>
<font color="black">  20.             ...</font>
<font color="black">  21. </font>
<font color="black">  22.     * without any specified variable names, in which case it is assumed that</font>
<font color="black">  23.       all variables are considered sensitive:</font>
<font color="black">  24. </font>
<font color="black">  25.         @sensitive_variables()</font>
<font color="black">  26.         def my_function()</font>
<font color="black">  27.             ...</font>
<font color="black">  28.     &quot;&quot;&quot;</font>
<font color="red">  29.     def decorator(func):</font>
<font color="red">  30.         @functools.wraps(func)</font>
<font color="black">  31.         def sensitive_variables_wrapper(*func_args, **func_kwargs):</font>
<font color="red">  32.             if variables:</font>
<font color="red">  33.                 sensitive_variables_wrapper.sensitive_variables = variables</font>
<font color="black">  34.             else:</font>
<font color="red">  35.                 sensitive_variables_wrapper.sensitive_variables = '__ALL__'</font>
<font color="red">  36.             return func(*func_args, **func_kwargs)</font>
<font color="red">  37.         return sensitive_variables_wrapper</font>
<font color="red">  38.     return decorator</font>
<font color="black">  39. </font>
<font color="black">  40. </font>
<font color="green">  41. def sensitive_post_parameters(*parameters):</font>
<font color="black">  42.     &quot;&quot;&quot;</font>
<font color="black">  43.     Indicates which POST parameters used in the decorated view are sensitive,</font>
<font color="black">  44.     so that those parameters can later be treated in a special way, for example</font>
<font color="black">  45.     by hiding them when logging unhandled exceptions.</font>
<font color="black">  46. </font>
<font color="black">  47.     Two forms are accepted:</font>
<font color="black">  48. </font>
<font color="black">  49.     * with specified parameters:</font>
<font color="black">  50. </font>
<font color="black">  51.         @sensitive_post_parameters('password', 'credit_card')</font>
<font color="black">  52.         def my_view(request):</font>
<font color="black">  53.             pw = request.POST['password']</font>
<font color="black">  54.             cc = request.POST['credit_card']</font>
<font color="black">  55.             ...</font>
<font color="black">  56. </font>
<font color="black">  57.     * without any specified parameters, in which case it is assumed that</font>
<font color="black">  58.       all parameters are considered sensitive:</font>
<font color="black">  59. </font>
<font color="black">  60.         @sensitive_post_parameters()</font>
<font color="black">  61.         def my_view(request)</font>
<font color="black">  62.             ...</font>
<font color="black">  63.     &quot;&quot;&quot;</font>
<font color="green">  64.     def decorator(view):</font>
<font color="green">  65.         @functools.wraps(view)</font>
<font color="black">  66.         def sensitive_post_parameters_wrapper(request, *args, **kwargs):</font>
<font color="red">  67.             assert isinstance(request, HttpRequest), (</font>
<font color="red">  68.                 &quot;sensitive_post_parameters didn't receive an HttpRequest. &quot;</font>
<font color="black">  69.                 &quot;If you are decorating a classmethod, be sure to use &quot;</font>
<font color="black">  70.                 &quot;@method_decorator.&quot;</font>
<font color="black">  71.             )</font>
<font color="red">  72.             if parameters:</font>
<font color="red">  73.                 request.sensitive_post_parameters = parameters</font>
<font color="black">  74.             else:</font>
<font color="red">  75.                 request.sensitive_post_parameters = '__ALL__'</font>
<font color="red">  76.             return view(request, *args, **kwargs)</font>
<font color="green">  77.         return sensitive_post_parameters_wrapper</font>
<font color="green">  78.     return decorator</font>
</pre>

