source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/contrib/auth/checks.py</b><br>


file stats: <b>39 lines, 5 executed: 12.8% covered</b>
<pre>
<font color="black">   1. # -*- coding: utf-8 -*-</font>
<font color="green">   2. from __future__ import unicode_literals</font>
<font color="black">   3. </font>
<font color="green">   4. from django.apps import apps</font>
<font color="green">   5. from django.conf import settings</font>
<font color="green">   6. from django.core import checks</font>
<font color="black">   7. </font>
<font color="black">   8. </font>
<font color="green">   9. def check_user_model(**kwargs):</font>
<font color="red">  10.     errors = []</font>
<font color="black">  11. </font>
<font color="red">  12.     cls = apps.get_model(settings.AUTH_USER_MODEL)</font>
<font color="black">  13. </font>
<font color="black">  14.     # Check that REQUIRED_FIELDS is a list</font>
<font color="red">  15.     if not isinstance(cls.REQUIRED_FIELDS, (list, tuple)):</font>
<font color="red">  16.         errors.append(</font>
<font color="red">  17.             checks.Error(</font>
<font color="red">  18.                 &quot;'REQUIRED_FIELDS' must be a list or tuple.&quot;,</font>
<font color="red">  19.                 hint=None,</font>
<font color="red">  20.                 obj=cls,</font>
<font color="red">  21.                 id='auth.E001',</font>
<font color="black">  22.             )</font>
<font color="black">  23.         )</font>
<font color="black">  24. </font>
<font color="black">  25.     # Check that the USERNAME FIELD isn't included in REQUIRED_FIELDS.</font>
<font color="red">  26.     if cls.USERNAME_FIELD in cls.REQUIRED_FIELDS:</font>
<font color="red">  27.         errors.append(</font>
<font color="red">  28.             checks.Error(</font>
<font color="red">  29.                 (&quot;The field named as the 'USERNAME_FIELD' &quot;</font>
<font color="black">  30.                  &quot;for a custom user model must not be included in 'REQUIRED_FIELDS'.&quot;),</font>
<font color="red">  31.                 hint=None,</font>
<font color="red">  32.                 obj=cls,</font>
<font color="red">  33.                 id='auth.E002',</font>
<font color="black">  34.             )</font>
<font color="black">  35.         )</font>
<font color="black">  36. </font>
<font color="black">  37.     # Check that the username field is unique</font>
<font color="red">  38.     if not cls._meta.get_field(cls.USERNAME_FIELD).unique:</font>
<font color="red">  39.         if (settings.AUTHENTICATION_BACKENDS ==</font>
<font color="red">  40.                 ['django.contrib.auth.backends.ModelBackend']):</font>
<font color="red">  41.             errors.append(</font>
<font color="red">  42.                 checks.Error(</font>
<font color="red">  43.                     &quot;'%s.%s' must be unique because it is named as the 'USERNAME_FIELD'.&quot; % (</font>
<font color="red">  44.                         cls._meta.object_name, cls.USERNAME_FIELD</font>
<font color="black">  45.                     ),</font>
<font color="red">  46.                     hint=None,</font>
<font color="red">  47.                     obj=cls,</font>
<font color="red">  48.                     id='auth.E003',</font>
<font color="black">  49.                 )</font>
<font color="black">  50.             )</font>
<font color="black">  51.         else:</font>
<font color="red">  52.             errors.append(</font>
<font color="red">  53.                 checks.Warning(</font>
<font color="red">  54.                     &quot;'%s.%s' is named as the 'USERNAME_FIELD', but it is not unique.&quot; % (</font>
<font color="red">  55.                         cls._meta.object_name, cls.USERNAME_FIELD</font>
<font color="black">  56.                     ),</font>
<font color="red">  57.                     hint=('Ensure that your authentication backend(s) can handle '</font>
<font color="black">  58.                           'non-unique usernames.'),</font>
<font color="red">  59.                     obj=cls,</font>
<font color="red">  60.                     id='auth.W004',</font>
<font color="black">  61.                 )</font>
<font color="black">  62.             )</font>
<font color="black">  63. </font>
<font color="red">  64.     return errors</font>
</pre>

