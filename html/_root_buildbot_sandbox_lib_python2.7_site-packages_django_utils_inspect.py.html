source file: <b>/root/buildbot/sandbox/lib/python2.7/site-packages/django/utils/inspect.py</b><br>


file stats: <b>80 lines, 16 executed: 20.0% covered</b>
<pre>
<font color="green">   1. from __future__ import absolute_import</font>
<font color="black">   2. </font>
<font color="green">   3. import inspect</font>
<font color="black">   4. </font>
<font color="green">   5. from django.utils import six</font>
<font color="black">   6. </font>
<font color="black">   7. </font>
<font color="green">   8. def getargspec(func):</font>
<font color="green">   9.     if six.PY2:</font>
<font color="green">  10.         return inspect.getargspec(func)</font>
<font color="black">  11. </font>
<font color="red">  12.     sig = inspect.signature(func)</font>
<font color="black">  13.     args = [</font>
<font color="red">  14.         p.name for p in sig.parameters.values()</font>
<font color="red">  15.         if p.kind == inspect.Parameter.POSITIONAL_OR_KEYWORD</font>
<font color="black">  16.     ]</font>
<font color="black">  17.     varargs = [</font>
<font color="red">  18.         p.name for p in sig.parameters.values()</font>
<font color="red">  19.         if p.kind == inspect.Parameter.VAR_POSITIONAL</font>
<font color="black">  20.     ]</font>
<font color="red">  21.     varargs = varargs[0] if varargs else None</font>
<font color="black">  22.     varkw = [</font>
<font color="red">  23.         p.name for p in sig.parameters.values()</font>
<font color="red">  24.         if p.kind == inspect.Parameter.VAR_KEYWORD</font>
<font color="black">  25.     ]</font>
<font color="red">  26.     varkw = varkw[0] if varkw else None</font>
<font color="black">  27.     defaults = [</font>
<font color="red">  28.         p.default for p in sig.parameters.values()</font>
<font color="red">  29.         if p.kind == inspect.Parameter.POSITIONAL_OR_KEYWORD and p.default is not p.empty</font>
<font color="red">  30.     ] or None</font>
<font color="red">  31.     return args, varargs, varkw, defaults</font>
<font color="black">  32. </font>
<font color="black">  33. </font>
<font color="green">  34. def get_func_args(func):</font>
<font color="red">  35.     if six.PY2:</font>
<font color="red">  36.         argspec = inspect.getargspec(func)</font>
<font color="red">  37.         return argspec.args[1:]  # ignore 'self'</font>
<font color="black">  38. </font>
<font color="red">  39.     sig = inspect.signature(func)</font>
<font color="black">  40.     return [</font>
<font color="red">  41.         arg_name for arg_name, param in sig.parameters.items()</font>
<font color="red">  42.         if param.kind == inspect.Parameter.POSITIONAL_OR_KEYWORD</font>
<font color="black">  43.     ]</font>
<font color="black">  44. </font>
<font color="black">  45. </font>
<font color="green">  46. def get_func_full_args(func):</font>
<font color="black">  47.     &quot;&quot;&quot;</font>
<font color="black">  48.     Return a list of (argument name, default value) tuples. If the argument</font>
<font color="black">  49.     does not have a default value, omit it in the tuple. Arguments such as</font>
<font color="black">  50.     *args and **kwargs are also included.</font>
<font color="black">  51.     &quot;&quot;&quot;</font>
<font color="red">  52.     if six.PY2:</font>
<font color="red">  53.         argspec = inspect.getargspec(func)</font>
<font color="red">  54.         args = argspec.args[1:]  # ignore 'self'</font>
<font color="red">  55.         defaults = argspec.defaults or []</font>
<font color="black">  56.         # Split args into two lists depending on whether they have default value</font>
<font color="red">  57.         no_default = args[:len(args) - len(defaults)]</font>
<font color="red">  58.         with_default = args[len(args) - len(defaults):]</font>
<font color="black">  59.         # Join the two lists and combine it with default values</font>
<font color="red">  60.         args = [(arg,) for arg in no_default] + zip(with_default, defaults)</font>
<font color="black">  61.         # Add possible *args and **kwargs and prepend them with '*' or '**'</font>
<font color="red">  62.         varargs = [('*' + argspec.varargs,)] if argspec.varargs else []</font>
<font color="red">  63.         kwargs = [('**' + argspec.keywords,)] if argspec.keywords else []</font>
<font color="red">  64.         return args + varargs + kwargs</font>
<font color="black">  65. </font>
<font color="red">  66.     sig = inspect.signature(func)</font>
<font color="red">  67.     args = []</font>
<font color="red">  68.     for arg_name, param in sig.parameters.items():</font>
<font color="red">  69.         name = arg_name</font>
<font color="black">  70.         # Ignore 'self'</font>
<font color="red">  71.         if name == 'self':</font>
<font color="red">  72.             continue</font>
<font color="red">  73.         if param.kind == inspect.Parameter.VAR_POSITIONAL:</font>
<font color="red">  74.             name = '*' + name</font>
<font color="red">  75.         elif param.kind == inspect.Parameter.VAR_KEYWORD:</font>
<font color="red">  76.             name = '**' + name</font>
<font color="red">  77.         if param.default != inspect.Parameter.empty:</font>
<font color="red">  78.             args.append((name, param.default))</font>
<font color="black">  79.         else:</font>
<font color="red">  80.             args.append((name,))</font>
<font color="red">  81.     return args</font>
<font color="black">  82. </font>
<font color="black">  83. </font>
<font color="green">  84. def func_accepts_kwargs(func):</font>
<font color="green">  85.     if six.PY2:</font>
<font color="black">  86.         # Not all callables are inspectable with getargspec, so we'll</font>
<font color="black">  87.         # try a couple different ways but in the end fall back on assuming</font>
<font color="black">  88.         # it is -- we don't want to prevent registration of valid but weird</font>
<font color="black">  89.         # callables.</font>
<font color="green">  90.         try:</font>
<font color="green">  91.             argspec = inspect.getargspec(func)</font>
<font color="red">  92.         except TypeError:</font>
<font color="red">  93.             try:</font>
<font color="red">  94.                 argspec = inspect.getargspec(func.__call__)</font>
<font color="red">  95.             except (TypeError, AttributeError):</font>
<font color="red">  96.                 argspec = None</font>
<font color="green">  97.         return not argspec or argspec[2] is not None</font>
<font color="black">  98. </font>
<font color="red">  99.     return any(</font>
<font color="red"> 100.         p for p in inspect.signature(func).parameters.values()</font>
<font color="red"> 101.         if p.kind == p.VAR_KEYWORD</font>
<font color="black"> 102.     )</font>
<font color="black"> 103. </font>
<font color="black"> 104. </font>
<font color="green"> 105. def func_accepts_var_args(func):</font>
<font color="black"> 106.     &quot;&quot;&quot;</font>
<font color="black"> 107.     Return True if function 'func' accepts positional arguments *args.</font>
<font color="black"> 108.     &quot;&quot;&quot;</font>
<font color="red"> 109.     if six.PY2:</font>
<font color="red"> 110.         return inspect.getargspec(func)[1] is not None</font>
<font color="black"> 111. </font>
<font color="red"> 112.     return any(</font>
<font color="red"> 113.         p for p in inspect.signature(func).parameters.values()</font>
<font color="red"> 114.         if p.kind == p.VAR_POSITIONAL</font>
<font color="black"> 115.     )</font>
<font color="black"> 116. </font>
<font color="black"> 117. </font>
<font color="green"> 118. def func_has_no_args(func):</font>
<font color="red"> 119.     args = inspect.getargspec(func)[0] if six.PY2 else [</font>
<font color="red"> 120.         p for p in inspect.signature(func).parameters.values()</font>
<font color="red"> 121.         if p.kind == p.POSITIONAL_OR_KEYWORD</font>
<font color="black"> 122.     ]</font>
<font color="red"> 123.     return len(args) == 1</font>
<font color="black"> 124. </font>
<font color="black"> 125. </font>
<font color="green"> 126. def func_supports_parameter(func, parameter):</font>
<font color="red"> 127.     if six.PY3:</font>
<font color="red"> 128.         return parameter in inspect.signature(func).parameters</font>
<font color="black"> 129.     else:</font>
<font color="red"> 130.         args, varargs, varkw, defaults = inspect.getargspec(func)</font>
<font color="red"> 131.         return parameter in args</font>
</pre>

